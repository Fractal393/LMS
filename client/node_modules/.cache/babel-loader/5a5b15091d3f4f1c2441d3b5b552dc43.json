{"ast":null,"code":"import { Toolbar as BaseToolbar } from '@syncfusion/ej2-navigations';\nimport { select, isNullOrUndefined as isNOU, closest, selectAll } from '@syncfusion/ej2-base';\nimport { createDialog } from '../pop-up/dialog';\nimport * as events from '../base/constant';\nimport * as CLS from '../base/classes';\nimport { refresh, getPathObject, getLocaleText, getCssClass, sortbyClickHandler } from '../common/utility';\nimport { createDeniedDialog, updateLayout } from '../common/utility';\nimport { GetDetails } from '../common/operations';\nimport { DropDownButton } from '@syncfusion/ej2-splitbuttons';\nimport { cutFiles, copyFiles, pasteHandler, hasEditAccess } from '../common/index';\nimport { doDownload, createNewFolder, uploadItem } from '../common/index';\n/**\n * Toolbar module\n */\n\nvar Toolbar =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Toolbar module\n   * @hidden\n   */\n  function Toolbar(parent) {\n    this.default = ['Delete', 'Rename', 'Download', 'Cut', 'Copy', 'Paste'];\n    this.single = ['Delete', 'Rename', 'Download', 'Cut', 'Copy'];\n    this.multiple = ['Delete', 'Download', 'Cut', 'Copy', 'Refresh'];\n    this.selection = ['NewFolder', 'Upload', 'SortBy', 'Refresh'];\n    this.parent = parent;\n    this.render();\n    this.addEventListener();\n  }\n\n  Toolbar.prototype.render = function () {\n    var _this = this;\n\n    this.items = this.toolbarItemData(this.getItems(this.parent.toolbarSettings.items.map(function (item) {\n      return item.trim();\n    })));\n    var eventArgs = {\n      items: this.items\n    };\n    this.parent.trigger('toolbarCreate', eventArgs, function (toolbarCreateArgs) {\n      _this.items = toolbarCreateArgs.items;\n      _this.toolbarObj = new BaseToolbar({\n        items: _this.items,\n        created: _this.toolbarCreateHandler.bind(_this),\n        overflowMode: 'Popup',\n        clicked: _this.onClicked.bind(_this),\n        enableHtmlSanitizer: _this.parent.enableHtmlSanitizer,\n        enableRtl: _this.parent.enableRtl\n      });\n      _this.toolbarObj.isStringTemplate = true;\n\n      _this.toolbarObj.appendTo('#' + _this.parent.element.id + CLS.TOOLBAR_ID);\n    });\n  };\n\n  Toolbar.prototype.getItemIndex = function (item) {\n    var itemId = this.getId(item);\n\n    for (var i = 0; i < this.items.length; i++) {\n      if (this.items[i].id === itemId) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  Toolbar.prototype.getItems = function (items) {\n    var currItems = items.slice();\n\n    if (this.parent.isDevice && this.parent.allowMultiSelection) {\n      currItems.push('SelectAll');\n    }\n\n    return currItems;\n  };\n  /* istanbul ignore next */\n\n\n  Toolbar.prototype.onClicked = function (args) {\n    var _this = this;\n\n    if (isNOU(args.item) || !args.item.id) {\n      return;\n    }\n\n    var tool = args.item.id.substr((this.parent.element.id + '_tb_').length);\n    var details;\n\n    if (tool === 'refresh' || tool === 'newfolder' || tool === 'upload') {\n      details = [getPathObject(this.parent)];\n      this.parent.itemData = details;\n    } else {\n      this.parent.notify(events.selectedData, {});\n      details = this.parent.itemData;\n    }\n\n    var eventArgs = {\n      cancel: false,\n      fileDetails: details,\n      item: args.item\n    };\n    this.parent.trigger('toolbarClick', eventArgs, function (toolbarClickArgs) {\n      if (!toolbarClickArgs.cancel) {\n        switch (tool) {\n          case 'sortby':\n            var target = closest(args.originalEvent.target, '.' + CLS.TB_ITEM);\n\n            if (target && target.classList.contains('e-toolbar-popup')) {\n              args.cancel = true;\n            }\n\n            break;\n\n          case 'newfolder':\n            createNewFolder(_this.parent);\n            break;\n\n          case 'cut':\n            cutFiles(_this.parent);\n            break;\n\n          case 'copy':\n            copyFiles(_this.parent);\n            break;\n\n          case 'delete':\n            for (var i = 0; i < details.length; i++) {\n              if (!hasEditAccess(details[i])) {\n                createDeniedDialog(_this.parent, details[i], events.permissionEdit);\n                return;\n              }\n            }\n\n            createDialog(_this.parent, 'Delete');\n            break;\n\n          case 'details':\n            _this.parent.notify(events.detailsInit, {});\n\n            var sItems = _this.parent.selectedItems;\n\n            if (_this.parent.activeModule === 'navigationpane') {\n              sItems = [];\n            }\n\n            GetDetails(_this.parent, sItems, _this.parent.path, 'details');\n            break;\n\n          case 'paste':\n            _this.parent.folderPath = '';\n            pasteHandler(_this.parent);\n            break;\n\n          case 'refresh':\n            refresh(_this.parent);\n            break;\n\n          case 'download':\n            doDownload(_this.parent);\n            break;\n\n          case 'rename':\n            if (!hasEditAccess(details[0])) {\n              createDeniedDialog(_this.parent, details[0], events.permissionEdit);\n            } else {\n              _this.parent.notify(events.renameInit, {});\n\n              createDialog(_this.parent, 'Rename');\n            }\n\n            break;\n\n          case 'upload':\n            uploadItem(_this.parent);\n            break;\n\n          case 'selectall':\n            _this.parent.notify(events.selectAllInit, {});\n\n            break;\n\n          case 'selection':\n            _this.parent.notify(events.clearAllInit, {});\n\n            break;\n        }\n      }\n    });\n  };\n\n  Toolbar.prototype.toolbarCreateHandler = function () {\n    if (!isNOU(select('#' + this.getId('SortBy'), this.parent.element))) {\n      var items = [{\n        id: this.getPupupId('name'),\n        text: getLocaleText(this.parent, 'Name'),\n        iconCss: CLS.TB_OPTION_DOT\n      }, {\n        id: this.getPupupId('size'),\n        text: getLocaleText(this.parent, 'Size')\n      }, {\n        id: this.getPupupId('date'),\n        text: getLocaleText(this.parent, 'DateModified')\n      }, {\n        separator: true\n      }, {\n        id: this.getPupupId('ascending'),\n        text: getLocaleText(this.parent, 'Ascending'),\n        iconCss: this.parent.sortOrder === 'Ascending' ? CLS.TB_OPTION_TICK : ''\n      }, {\n        id: this.getPupupId('descending'),\n        text: getLocaleText(this.parent, 'Descending'),\n        iconCss: this.parent.sortOrder === 'Descending' ? CLS.TB_OPTION_TICK : ''\n      }, {\n        id: this.getPupupId('none'),\n        text: getLocaleText(this.parent, 'None'),\n        iconCss: this.parent.sortOrder === 'None' ? CLS.TB_OPTION_TICK : ''\n      }];\n      this.buttonObj = new DropDownButton({\n        items: items,\n        cssClass: getCssClass(this.parent, CLS.ROOT_POPUP),\n        select: sortbyClickHandler.bind(this, this.parent),\n        enableHtmlSanitizer: this.parent.enableHtmlSanitizer,\n        enableRtl: this.parent.enableRtl,\n        iconCss: CLS.ICON_SHORTBY\n      });\n      this.buttonObj.isStringTemplate = true;\n      this.buttonObj.appendTo('#' + this.getId('SortBy'));\n    }\n\n    if (!isNOU(select('#' + this.getId('View'), this.parent.element))) {\n      var gridSpan = '<span class=\"' + CLS.ICON_GRID + ' ' + CLS.MENU_ICON + '\"></span>';\n      var largeIconSpan = '<span class=\"' + CLS.ICON_LARGE + ' ' + CLS.MENU_ICON + '\"></span>';\n      var layoutItems = [{\n        id: this.getPupupId('large'),\n        text: largeIconSpan + getLocaleText(this.parent, 'View-LargeIcons'),\n        iconCss: this.parent.view === 'Details' ? '' : CLS.TB_OPTION_TICK\n      }, {\n        id: this.getPupupId('details'),\n        text: gridSpan + getLocaleText(this.parent, 'View-Details'),\n        iconCss: this.parent.view === 'Details' ? CLS.TB_OPTION_TICK : ''\n      }];\n      this.layoutBtnObj = new DropDownButton({\n        iconCss: this.parent.view === 'Details' ? CLS.ICON_GRID : CLS.ICON_LARGE,\n        cssClass: getCssClass(this.parent, 'e-caret-hide ' + CLS.ROOT_POPUP),\n        items: layoutItems,\n        select: this.layoutChange.bind(this),\n        enableRtl: this.parent.enableRtl,\n        enableHtmlSanitizer: this.parent.enableHtmlSanitizer,\n        content: '<span class=\"e-tbar-btn-text\">' + getLocaleText(this.parent, 'View') + '</span>'\n      });\n      this.layoutBtnObj.isStringTemplate = true;\n      this.layoutBtnObj.appendTo('#' + this.getId('View'));\n    }\n\n    this.hideItems(this.default, true);\n    this.hideStatus();\n    var btnElement = selectAll('.e-btn', this.toolbarObj.element);\n\n    var _loop_1 = function (btnCount) {\n      /* istanbul ignore next */\n      btnElement[btnCount].onkeydown = function (e) {\n        if (e.keyCode === 13 && !e.target.classList.contains('e-fe-popup')) {\n          e.preventDefault();\n        }\n      };\n\n      btnElement[btnCount].onkeyup = function (e) {\n        if (e.keyCode === 13 && !e.target.classList.contains('e-fe-popup')) {\n          btnElement[btnCount].click();\n        }\n      };\n    };\n\n    for (var btnCount = 0; btnCount < btnElement.length; btnCount++) {\n      _loop_1(btnCount);\n    }\n\n    this.parent.refreshLayout();\n  };\n\n  Toolbar.prototype.updateSortByButton = function () {\n    if (this.buttonObj) {\n      var items = this.buttonObj.items;\n\n      for (var itemCount = 0; itemCount < items.length; itemCount++) {\n        if (items[itemCount].id === this.getPupupId('name')) {\n          items[itemCount].iconCss = this.parent.sortBy === 'name' ? CLS.TB_OPTION_DOT : '';\n        } else if (items[itemCount].id === this.getPupupId('size')) {\n          items[itemCount].iconCss = this.parent.sortBy === 'size' ? CLS.TB_OPTION_DOT : '';\n        } else if (items[itemCount].id === this.getPupupId('date')) {\n          items[itemCount].iconCss = this.parent.sortBy === '_fm_modified' ? CLS.TB_OPTION_DOT : '';\n        } else if (items[itemCount].id === this.getPupupId('ascending')) {\n          items[itemCount].iconCss = this.parent.sortOrder === 'Ascending' ? CLS.TB_OPTION_TICK : '';\n        } else if (items[itemCount].id === this.getPupupId('descending')) {\n          items[itemCount].iconCss = this.parent.sortOrder === 'Descending' ? CLS.TB_OPTION_TICK : '';\n        } else if (items[itemCount].id === this.getPupupId('none')) {\n          items[itemCount].iconCss = this.parent.sortOrder === 'None' ? CLS.TB_OPTION_TICK : '';\n        }\n      }\n    }\n  };\n\n  Toolbar.prototype.getPupupId = function (id) {\n    return this.parent.element.id + '_ddl_' + id.toLowerCase();\n  };\n\n  Toolbar.prototype.layoutChange = function (args) {\n    if (this.parent.view === 'Details') {\n      if (args.item.id === this.getPupupId('large')) {\n        updateLayout(this.parent, 'LargeIcons');\n      }\n    } else {\n      if (args.item.id === this.getPupupId('details')) {\n        updateLayout(this.parent, 'Details');\n      }\n    }\n  };\n\n  Toolbar.prototype.toolbarItemData = function (data) {\n    var items = [];\n    var mode = 'Both';\n\n    if (this.parent.isMobile) {\n      mode = 'Overflow';\n    }\n\n    for (var i = 0; i < data.length; i++) {\n      var item = void 0;\n      var itemId = this.getId(data[i]);\n      var itemText = getLocaleText(this.parent, data[i]);\n      var itemTooltip = getLocaleText(this.parent, 'Tooltip-' + data[i]);\n\n      switch (data[i]) {\n        case '|':\n          item = {\n            type: 'Separator'\n          };\n          break;\n\n        case 'Upload':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_UPLOAD,\n            showTextOn: mode\n          };\n          break;\n\n        case 'SortBy':\n          var spanElement = '<span class=\"e-tbar-btn-text e-tbar-ddb-text\">' + itemText + '</span>';\n          item = {\n            id: itemId,\n            tooltipText: itemTooltip,\n            template: '<button id=\"' + itemId + '\" class=\"e-tbar-btn e-tbtn-txt\" tabindex=\"-1\">' + spanElement + '</button>'\n          };\n          break;\n\n        case 'Refresh':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_REFRESH,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Selection':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            suffixIcon: CLS.ICON_CLEAR,\n            overflow: 'Show',\n            align: 'Right'\n          };\n          break;\n\n        case 'View':\n          item = {\n            id: itemId,\n            tooltipText: itemTooltip,\n            prefixIcon: this.parent.view === 'Details' ? CLS.ICON_GRID : CLS.ICON_LARGE,\n            overflow: 'Show',\n            align: 'Right',\n            text: itemText,\n            showTextOn: 'Overflow',\n            template: '<button id=\"' + itemId + '\" class=\"e-tbar-btn e-tbtn-txt\" tabindex=\"-1\" aria-label=' + getLocaleText(this.parent, 'View') + '></button>'\n          };\n          break;\n\n        case 'Details':\n          item = {\n            id: itemId,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_DETAILS,\n            overflow: 'Show',\n            align: 'Right',\n            text: itemText,\n            showTextOn: 'Overflow'\n          };\n          break;\n\n        case 'NewFolder':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_NEWFOLDER,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Cut':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_CUT,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Copy':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_COPY,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Paste':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_PASTE,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Delete':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_DELETE,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Rename':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_RENAME,\n            showTextOn: mode\n          };\n          break;\n\n        case 'Download':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_DOWNLOAD,\n            showTextOn: mode\n          };\n          break;\n\n        case 'SelectAll':\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip,\n            prefixIcon: CLS.ICON_SELECTALL,\n            showTextOn: mode\n          };\n          break;\n\n        default:\n          item = {\n            id: itemId,\n            text: itemText,\n            tooltipText: itemTooltip\n          };\n          break;\n      }\n\n      items.push(item);\n    }\n\n    return items;\n  };\n\n  Toolbar.prototype.getId = function (id) {\n    return this.parent.element.id + '_tb_' + id.toLowerCase();\n  };\n\n  Toolbar.prototype.addEventListener = function () {\n    this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.selectionChanged, this.onSelectionChanged, this);\n    this.parent.on(events.layoutChange, this.onLayoutChange, this);\n    this.parent.on(events.showPaste, this.showPaste, this);\n    this.parent.on(events.hidePaste, this.hidePaste, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.sortByChange, this.updateSortByButton, this);\n  };\n\n  Toolbar.prototype.reRenderToolbar = function (e) {\n    var _this = this;\n\n    if (e.newProp.toolbarSettings.items !== undefined) {\n      this.items = this.toolbarItemData(this.getItems(e.newProp.toolbarSettings.items.map(function (item) {\n        return item.trim();\n      })));\n      var eventArgs = {\n        items: this.items\n      };\n      this.parent.trigger('toolbarCreate', eventArgs, function (toolbarCreateArgs) {\n        if (_this.buttonObj) {\n          _this.buttonObj.destroy();\n        }\n\n        if (_this.layoutBtnObj) {\n          _this.layoutBtnObj.destroy();\n        }\n\n        _this.items = toolbarCreateArgs.items;\n        _this.toolbarObj.items = _this.items;\n\n        _this.toolbarObj.dataBind();\n\n        _this.toolbarCreateHandler();\n      });\n    }\n  };\n\n  Toolbar.prototype.onSelectionChanged = function () {\n    this.hideStatus();\n    this.hideItems(this.single, true);\n    this.hideItems(this.selection, false);\n\n    if (this.parent.selectedItems.length === 1) {\n      this.hideItems(this.single, false);\n      this.hideItems(this.selection, true);\n    } else if (this.parent.selectedItems.length > 1) {\n      this.hideItems(this.multiple, false);\n      this.hideItems(this.selection, true);\n    }\n\n    var ele = select('#' + this.getId('Selection'), this.toolbarObj.element);\n\n    if (this.parent.selectedItems.length > 0 && ele) {\n      var txt = void 0;\n\n      if (this.parent.selectedItems.length === 1) {\n        txt = this.parent.selectedItems.length + ' ' + getLocaleText(this.parent, 'Item-Selection');\n      } else {\n        txt = this.parent.selectedItems.length + ' ' + getLocaleText(this.parent, 'Items-Selection');\n      }\n\n      select('.e-tbar-btn-text', ele).textContent = txt;\n      this.toolbarObj.hideItem(ele.parentElement, false);\n    }\n  };\n\n  Toolbar.prototype.hideItems = function (tools, toHide) {\n    for (var i = 0; i < tools.length; i++) {\n      var ele = select('#' + this.getId(tools[i]), this.parent.element);\n\n      if (ele) {\n        this.toolbarObj.hideItem(ele.parentElement, toHide);\n      }\n    }\n  };\n\n  Toolbar.prototype.hideStatus = function () {\n    var ele = select('#' + this.getId('Selection'), this.toolbarObj.element);\n\n    if (ele) {\n      this.toolbarObj.hideItem(ele.parentElement, true);\n    }\n  };\n\n  Toolbar.prototype.showPaste = function () {\n    this.hideItems(['Paste'], false);\n  };\n\n  Toolbar.prototype.hidePaste = function () {\n    this.hideItems(['Paste'], true);\n  };\n\n  Toolbar.prototype.onLayoutChange = function () {\n    if (this.layoutBtnObj) {\n      this.layoutBtnObj.iconCss = this.parent.view === 'Details' ? CLS.ICON_GRID : CLS.ICON_LARGE;\n      var items = this.layoutBtnObj.items;\n\n      for (var itemCount = 0; itemCount < items.length; itemCount++) {\n        if (items[itemCount].id === this.getPupupId('large')) {\n          items[itemCount].iconCss = this.parent.view === 'LargeIcons' ? CLS.TB_OPTION_TICK : '';\n        } else if (items[itemCount].id === this.getPupupId('details')) {\n          items[itemCount].iconCss = this.parent.view === 'Details' ? CLS.TB_OPTION_TICK : '';\n        }\n      }\n    }\n  };\n\n  Toolbar.prototype.removeEventListener = function () {\n    this.parent.off(events.modelChanged, this.onPropertyChanged);\n    this.parent.off(events.selectionChanged, this.onSelectionChanged);\n    this.parent.off(events.layoutChange, this.onLayoutChange);\n    this.parent.off(events.showPaste, this.showPaste);\n    this.parent.off(events.hidePaste, this.hidePaste);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.sortByChange, this.updateSortByButton);\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  Toolbar.prototype.getModuleName = function () {\n    return 'toolbar';\n  };\n\n  Toolbar.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName() && e.module !== 'common') {\n      /* istanbul ignore next */\n      return;\n    }\n\n    for (var _i = 0, _a = Object.keys(e.newProp); _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      switch (prop) {\n        case 'cssClass':\n          if (this.buttonObj) {\n            this.buttonObj.cssClass = getCssClass(this.parent, CLS.ROOT_POPUP);\n          }\n\n          if (this.layoutBtnObj) {\n            this.layoutBtnObj.cssClass = getCssClass(this.parent, 'e-caret-hide ' + CLS.ROOT_POPUP);\n          }\n\n          break;\n\n        case 'height':\n        case 'width':\n          this.toolbarObj.refreshOverflow();\n          break;\n\n        case 'toolbarSettings':\n          this.reRenderToolbar(e);\n          break;\n      }\n    }\n  };\n\n  Toolbar.prototype.destroy = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.removeEventListener();\n\n    if (this.buttonObj) {\n      this.buttonObj.destroy();\n    }\n\n    if (this.layoutBtnObj) {\n      this.layoutBtnObj.destroy();\n    }\n\n    this.toolbarObj.destroy();\n    this.parent.refreshLayout();\n  };\n\n  Toolbar.prototype.enableItems = function (items, isEnable) {\n    for (var i = 0; i < items.length; i++) {\n      var ele = select('#' + this.getId(items[i]), this.parent.element);\n\n      if (ele) {\n        this.toolbarObj.enableItems(ele.parentElement, isEnable);\n      }\n    }\n  };\n\n  return Toolbar;\n}();\n\nexport { Toolbar };","map":null,"metadata":{},"sourceType":"module"}