{"ast":null,"code":"import * as CLS from '../base/classes';\nimport * as events from '../base/constant';\nimport { read, paste, Search, filter, Download, Delete } from '../common/operations';\nimport { getValue, setValue, isNullOrUndefined as isNOU, matches, select, createElement } from '@syncfusion/ej2-base';\nimport { closest, detach, isBlazor } from '@syncfusion/ej2-base';\nimport { DataManager, Query } from '@syncfusion/ej2-data';\nimport { createDialog } from '../pop-up/dialog';\n/**\n * Utility file for common actions\n * @private\n */\n\nexport function updatePath(node, data, instance) {\n  var text = getValue('name', data);\n  var id = node.getAttribute('data-id');\n  var newText = isNOU(id) ? text : id;\n  instance.setProperties({\n    path: getPath(node, newText, instance.hasId)\n  }, true);\n  instance.pathId = getPathId(node);\n  instance.pathNames = getPathNames(node, text);\n}\nexport function getPath(element, text, hasId) {\n  var matched = getParents(element, text, false, hasId);\n  var path = hasId ? '' : '/';\n  var len = matched.length - (hasId ? 1 : 2);\n\n  for (var i = len; i >= 0; i--) {\n    path += matched[i] + '/';\n  }\n\n  return path;\n}\nexport function getPathId(node) {\n  var matched = getParents(node, node.getAttribute('data-uid'), true);\n  var ids = [];\n\n  for (var i = matched.length - 1; i >= 0; i--) {\n    ids.push(matched[i]);\n  }\n\n  return ids;\n}\nexport function getPathNames(element, text) {\n  var matched = getParents(element, text, false);\n  var names = [];\n\n  for (var i = matched.length - 1; i >= 0; i--) {\n    names.push(matched[i]);\n  }\n\n  return names;\n}\nexport function getParents(element, text, isId, hasId) {\n  var matched = [text];\n  var el = element.parentNode;\n\n  while (!isNOU(el)) {\n    if (matches(el, '.' + CLS.LIST_ITEM)) {\n      var parentText = isId ? el.getAttribute('data-uid') : hasId ? el.getAttribute('data-id') : select('.' + CLS.LIST_TEXT, el).textContent;\n      matched.push(parentText);\n    }\n\n    el = el.parentNode;\n\n    if (el.classList.contains(CLS.TREE_VIEW)) {\n      break;\n    }\n  }\n\n  return matched;\n}\nexport function generatePath(parent) {\n  var key = parent.hasId ? 'id' : 'name';\n  var newPath = parent.hasId ? '' : '/';\n  var i = parent.hasId ? 0 : 1;\n\n  for (i; i < parent.pathId.length; i++) {\n    var data = getValue(parent.pathId[i], parent.feParent);\n    newPath += getValue(key, data) + '/';\n  }\n\n  parent.setProperties({\n    path: newPath\n  }, true);\n}\nexport function removeActive(parent) {\n  if (parent.isCut) {\n    removeBlur(parent);\n    parent.selectedNodes = [];\n    parent.actionRecords = [];\n    parent.enablePaste = false;\n    parent.notify(events.hidePaste, {});\n  }\n} // Selects active element in File Manager\n\nexport function activeElement(action, parent) {\n  parent.isSearchCut = false;\n  parent.actionRecords = [];\n  parent.activeElements = [];\n  parent.notify(events.cutCopyInit, {});\n\n  if (parent.activeElements.length === 0) {\n    return false;\n  }\n\n  removeBlur(parent);\n  var blurEle = parent.activeElements;\n\n  if (parent.activeModule !== 'navigationpane') {\n    parent.targetPath = parent.path;\n  } else {\n    parent.targetPath = getParentPath(parent.path);\n  }\n\n  var i = 0;\n\n  if (blurEle) {\n    getModule(parent, blurEle[0]);\n\n    if (action === 'cut') {\n      while (i < blurEle.length) {\n        addBlur(blurEle[i]);\n        i++;\n      }\n    }\n  }\n\n  i = 0;\n  parent.selectedNodes = [];\n  parent.enablePaste = true;\n  parent.notify(events.showPaste, {});\n\n  while (i < parent.activeRecords.length) {\n    parent.actionRecords.push(parent.activeRecords[i]);\n    parent.selectedNodes.push(getValue('name', parent.activeRecords[i]));\n    i++;\n  }\n\n  if ((parent.breadcrumbbarModule.searchObj.element.value !== '' || parent.isFiltered) && parent.activeModule !== 'navigationpane') {\n    parent.selectedNodes = [];\n    parent.isSearchCut = true;\n    var i_1 = 0;\n\n    while (i_1 < parent.selectedItems.length) {\n      parent.selectedNodes.push(parent.selectedItems[i_1]);\n      i_1++;\n    }\n  }\n\n  return true;\n}\nexport function addBlur(nodes) {\n  nodes.classList.add(CLS.BLUR);\n} // Removes blur from elements\n\nexport function removeBlur(parent, hover) {\n  var blurEle = !hover ? parent.element.querySelectorAll('.' + CLS.BLUR) : parent.element.querySelectorAll('.' + CLS.HOVER);\n  var i = 0;\n\n  while (i < blurEle.length) {\n    !hover ? blurEle[i].classList.remove(CLS.BLUR) : blurEle[i].classList.remove(CLS.HOVER);\n    i++;\n  }\n} // Gets module name\n\nexport function getModule(parent, element) {\n  if (element) {\n    if (element.classList.contains(CLS.ROW)) {\n      parent.activeModule = 'detailsview';\n    } else if (closest(element, '.' + CLS.LARGE_ICON)) {\n      parent.activeModule = 'largeiconsview';\n    } else {\n      parent.activeModule = 'navigationpane';\n    }\n  }\n}\nexport function searchWordHandler(parent, value, isLayoutChange) {\n  var searchWord;\n\n  if (value.length === 0 && !parent.isFiltered) {\n    parent.notify(events.pathColumn, {\n      args: parent\n    });\n  }\n\n  if (parent.searchSettings.filterType === 'startsWith') {\n    searchWord = value + '*';\n  } else if (parent.searchSettings.filterType === 'endsWith') {\n    searchWord = '*' + value;\n  } else {\n    searchWord = '*' + value + '*';\n  }\n\n  parent.searchWord = searchWord;\n  parent.itemData = [getPathObject(parent)];\n\n  if (value.length > 0) {\n    var caseSensitive = parent.searchSettings.ignoreCase;\n    var hiddenItems = parent.showHiddenItems;\n    Search(parent, isLayoutChange ? events.layoutChange : events.search, parent.path, searchWord, hiddenItems, !caseSensitive);\n  } else {\n    if (!parent.isFiltered) {\n      read(parent, isLayoutChange ? events.layoutChange : events.search, parent.path);\n    } else {\n      filter(parent, events.layoutChange);\n    }\n  }\n}\nexport function updateLayout(parent, view) {\n  parent.setProperties({\n    view: view\n  }, true);\n\n  if (parent.breadcrumbbarModule.searchObj.element.value !== '' || parent.isFiltered) {\n    parent.layoutSelectedItems = parent.selectedItems;\n  }\n\n  var searchWord = '';\n\n  if (parent.breadcrumbbarModule.searchObj.element.value) {\n    searchWord = parent.breadcrumbbarModule.searchObj.element.value;\n  }\n\n  parent.isLayoutChange = true;\n  searchWordHandler(parent, searchWord, true);\n}\n/* istanbul ignore next */\n\nexport function getTargetModule(parent, element) {\n  var tartgetModule = '';\n\n  if (element) {\n    if (closest(element, '.e-gridcontent')) {\n      tartgetModule = 'detailsview';\n    } else if (closest(element, '.' + CLS.LARGE_ICONS)) {\n      tartgetModule = 'largeiconsview';\n    } else if (element.classList.contains('e-fullrow') || element.classList.contains('e-icon-expandable')) {\n      tartgetModule = 'navigationpane';\n    } else if (closest(element, '.e-address-list-item')) {\n      tartgetModule = 'breadcrumbbar';\n    } else {\n      tartgetModule = '';\n    }\n  }\n\n  parent.targetModule = tartgetModule;\n}\n/* istanbul ignore next */\n\nexport function refresh(parent) {\n  parent.itemData = [getPathObject(parent)];\n\n  if (!hasReadAccess(parent.itemData[0])) {\n    createDeniedDialog(parent, parent.itemData[0], events.permissionRead);\n  } else {\n    read(parent, events.refreshEnd, parent.path);\n  }\n}\nexport function openAction(parent) {\n  read(parent, events.openEnd, parent.path);\n}\nexport function getPathObject(parent) {\n  return getValue(parent.pathId[parent.pathId.length - 1], parent.feParent);\n} // Copy files\n\nexport function copyFiles(parent) {\n  if (!activeElement('copy', parent)) {\n    return;\n  } else {\n    parent.fileAction = 'copy';\n  }\n} // Cut files\n\nexport function cutFiles(parent) {\n  if (!activeElement('cut', parent)) {\n    return;\n  } else {\n    parent.isCut = true;\n    parent.fileAction = 'move';\n  }\n} // To add class for fileType\n\nexport function fileType(file) {\n  var isFile = getValue('isFile', file);\n\n  if (!isFile) {\n    return CLS.FOLDER;\n  }\n\n  var imageFormat = ['bmp', 'dib', 'jpg', 'jpeg', 'jpe', 'jfif', 'gif', 'tif', 'tiff', 'png', 'ico'];\n  var audioFormat = ['mp3', 'wav', 'aac', 'ogg', 'wma', 'aif', 'fla', 'm4a'];\n  var videoFormat = ['webm', 'mkv', 'flv', 'vob', 'ogv', 'ogg', 'avi', 'wmv', 'mp4', '3gp'];\n  var knownFormat = ['css', 'exe', 'html', 'js', 'msi', 'pdf', 'pptx', 'ppt', 'rar', 'zip', 'txt', 'docx', 'doc', 'xlsx', 'xls', 'xml', 'rtf', 'php'];\n  var filetype = getValue('type', file);\n  filetype = filetype.toLowerCase();\n\n  if (filetype.indexOf('.') !== -1) {\n    filetype = filetype.split('.').join('');\n  }\n\n  var iconType;\n\n  if (imageFormat.indexOf(filetype) !== -1) {\n    iconType = CLS.ICON_IMAGE;\n  } else if (audioFormat.indexOf(filetype) !== -1) {\n    iconType = CLS.ICON_MUSIC;\n  } else if (videoFormat.indexOf(filetype) !== -1) {\n    iconType = CLS.ICON_VIDEO;\n  } else if (knownFormat.indexOf(filetype) !== -1) {\n    iconType = 'e-fe-' + filetype;\n  } else {\n    iconType = 'e-fe-unknown e-fe-' + filetype;\n  }\n\n  return iconType;\n}\n/* istanbul ignore next */\n\nexport function getImageUrl(parent, item) {\n  var baseUrl = parent.ajaxSettings.getImageUrl ? parent.ajaxSettings.getImageUrl : parent.ajaxSettings.url;\n  var imgUrl;\n  var fileName = getValue('name', item);\n  var fPath = getValue('filterPath', item);\n\n  if (parent.hasId) {\n    var imgId = getValue('id', item);\n    imgUrl = baseUrl + '?path=' + parent.path + '&id=' + imgId;\n  } else if (!isNOU(fPath)) {\n    imgUrl = baseUrl + '?path=' + fPath.replace(/\\\\/g, '/') + fileName;\n  } else {\n    imgUrl = baseUrl + '?path=' + parent.path + fileName;\n  }\n\n  imgUrl = imgUrl + '&time=' + new Date().getTime().toString();\n  var eventArgs = {\n    fileDetails: [item],\n    imageUrl: imgUrl\n  };\n  parent.trigger('beforeImageLoad', eventArgs);\n  return eventArgs.imageUrl;\n}\n/* istanbul ignore next */\n\nexport function getFullPath(parent, data, path) {\n  var filePath = getValue(parent.hasId ? 'id' : 'name', data) + '/';\n  var fPath = getValue(parent.hasId ? 'filterId' : 'filterPath', data);\n\n  if (!isNOU(fPath)) {\n    return fPath.replace(/\\\\/g, '/') + filePath;\n  } else {\n    return path + filePath;\n  }\n}\nexport function getName(parent, data) {\n  var name = getValue('name', data);\n  var fPath = getValue('filterPath', data);\n\n  if ((parent.breadcrumbbarModule.searchObj.element.value !== '' || parent.isFiltered) && !isNOU(fPath)) {\n    fPath = fPath.replace(/\\\\/g, '/');\n    name = fPath.replace(parent.path, '') + name;\n  }\n\n  return name;\n}\nexport function getSortedData(parent, items) {\n  if (items.length === 0) {\n    return items;\n  }\n\n  var query;\n\n  if (parent.sortOrder !== 'None') {\n    query = new Query().sortBy(parent.sortBy, parent.sortOrder.toLowerCase(), true).group('isFile');\n  } else {\n    query = new Query().group('isFile');\n  }\n\n  var lists = new DataManager(items).executeLocal(query);\n  return getValue('records', lists);\n}\nexport function getObject(parent, key, value) {\n  var currFiles = getValue(parent.pathId[parent.pathId.length - 1], parent.feFiles);\n  var query = new Query().where(key, 'equal', value);\n  var lists = new DataManager(currFiles).executeLocal(query);\n  return lists[0];\n}\nexport function createEmptyElement(parent, element, args) {\n  var top;\n  var layoutElement = select('#' + parent.element.id + CLS.LAYOUT_ID, parent.element);\n  var addressBarHeight = select('#' + parent.element.id + CLS.BREADCRUMBBAR_ID, layoutElement).offsetHeight;\n  top = layoutElement.offsetHeight - addressBarHeight;\n\n  if (parent.view === 'Details') {\n    top = top - select('.' + CLS.GRID_HEADER, layoutElement).offsetHeight;\n  }\n\n  if (isNOU(element.querySelector('.' + CLS.EMPTY))) {\n    var emptyDiv = createElement('div', {\n      className: CLS.EMPTY\n    });\n    var emptyFolder = createElement('div', {\n      className: CLS.LARGE_EMPTY_FOLDER\n    });\n    var emptyEle = createElement('div', {\n      className: CLS.EMPTY_CONTENT\n    });\n    var dragFile = createElement('div', {\n      className: CLS.EMPTY_INNER_CONTENT\n    });\n\n    if (parent.view === 'Details') {\n      element.querySelector('.' + CLS.GRID_VIEW).appendChild(emptyDiv);\n    } else {\n      element.appendChild(emptyDiv);\n    }\n\n    emptyDiv.appendChild(emptyFolder);\n    emptyDiv.appendChild(emptyEle);\n    emptyDiv.appendChild(dragFile);\n  }\n\n  if (element.querySelector('.' + CLS.EMPTY)) {\n    if (!isNOU(args.error)) {\n      element.querySelector('.' + CLS.EMPTY_CONTENT).innerHTML = getLocaleText(parent, 'Access-Denied');\n      element.querySelector('.' + CLS.EMPTY_INNER_CONTENT).innerHTML = getLocaleText(parent, 'Access-Details');\n    } else if (parent.isFiltered) {\n      element.querySelector('.' + CLS.EMPTY_CONTENT).innerHTML = getLocaleText(parent, 'Filter-Empty');\n      element.querySelector('.' + CLS.EMPTY_INNER_CONTENT).innerHTML = getLocaleText(parent, 'Filter-Key');\n    } else if (parent.breadcrumbbarModule.searchObj.element.value !== '') {\n      element.querySelector('.' + CLS.EMPTY_CONTENT).innerHTML = getLocaleText(parent, 'Search-Empty');\n      element.querySelector('.' + CLS.EMPTY_INNER_CONTENT).innerHTML = getLocaleText(parent, 'Search-Key');\n    } else {\n      element.querySelector('.' + CLS.EMPTY_CONTENT).innerHTML = getLocaleText(parent, 'Folder-Empty');\n      element.querySelector('.' + CLS.EMPTY_INNER_CONTENT).innerHTML = getLocaleText(parent, 'File-Upload');\n    }\n  }\n\n  var eDiv = select('.' + CLS.EMPTY, element);\n  top = (top - eDiv.offsetHeight) / 2;\n  eDiv.style.marginTop = top + 'px';\n}\nexport function getDirectories(files) {\n  return new DataManager(files).executeLocal(new Query().where(events.isFile, 'equal', false, false));\n}\nexport function setNodeId(result, rootId) {\n  var dirs = getDirectories(result.files);\n\n  for (var i = 0, len = dirs.length; i < len; i++) {\n    setValue('_fm_id', rootId + '_' + i, dirs[i]);\n  }\n}\nexport function setDateObject(args) {\n  for (var i = 0; i < args.length; i++) {\n    setValue('_fm_created', new Date(getValue('dateCreated', args[i])), args[i]);\n    setValue('_fm_modified', new Date(getValue('dateModified', args[i])), args[i]);\n  }\n}\nexport function getLocaleText(parent, text) {\n  var locale = parent.localeObj.getConstant(text);\n  return locale === '' ? text : locale;\n}\nexport function getCssClass(parent, css) {\n  var cssClass = parent.cssClass;\n  cssClass = isNOU(cssClass) || cssClass === '' ? css : cssClass + ' ' + css;\n  return cssClass;\n}\nexport function sortbyClickHandler(parent, args) {\n  var tick;\n\n  if (args.item.id.indexOf('ascending') !== -1 || args.item.id.indexOf('descending') !== -1 || args.item.id.indexOf('none') !== -1) {\n    tick = true;\n  } else {\n    tick = false;\n  }\n\n  if (!tick) {\n    parent.sortBy = getSortField(args.item.id);\n  } else {\n    parent.sortOrder = getSortField(args.item.id);\n  }\n\n  parent.itemData = [getPathObject(parent)];\n\n  if (parent.view === 'Details') {\n    if (parent.isMobile) {\n      updateLayout(parent, 'Details');\n    } else {\n      parent.notify(events.sortColumn, {\n        module: 'detailsview'\n      });\n    }\n  }\n\n  if (parent.view === 'LargeIcons') {\n    updateLayout(parent, 'LargeIcons');\n  }\n\n  parent.notify(events.sortByChange, {});\n}\nexport function getSortField(id) {\n  var text = id.substring(id.lastIndexOf('_') + 1);\n  var field = text;\n\n  switch (text) {\n    case 'date':\n      field = '_fm_modified';\n      break;\n\n    case 'ascending':\n      field = 'Ascending';\n      break;\n\n    case 'descending':\n      field = 'Descending';\n      break;\n\n    case 'none':\n      field = 'None';\n      break;\n  }\n\n  return field;\n}\nexport function setNextPath(parent, path) {\n  var currfolders = path.split('/');\n  var folders = parent.originalPath.split('/');\n  var root = getValue(parent.pathId[0], parent.feParent);\n  var key = isNOU(getValue('id', root)) ? 'name' : 'id';\n\n  for (var i = currfolders.length - 1, len = folders.length - 1; i < len; i++) {\n    var eventName = folders[i + 1] === '' ? events.finalizeEnd : events.initialEnd;\n    var newPath = folders[i] === '' ? '/' : parent.path + folders[i] + '/';\n    var data = getObject(parent, key, folders[i]);\n    var id = getValue('_fm_id', data);\n    parent.setProperties({\n      path: newPath\n    }, true);\n    parent.pathId.push(id);\n    parent.itemData = [data];\n    parent.pathNames.push(getValue('name', data));\n    read(parent, eventName, parent.path);\n    break;\n  }\n}\nexport function openSearchFolder(parent, data) {\n  parent.notify(events.clearPathInit, {\n    selectedNode: parent.pathId[parent.pathId.length - 1]\n  });\n  parent.originalPath = getFullPath(parent, data, parent.path);\n  read(parent, parent.path !== parent.originalPath ? events.initialEnd : events.finalizeEnd, parent.path);\n}\nexport function pasteHandler(parent) {\n  parent.isDragDrop = false;\n\n  if (parent.selectedNodes.length !== 0 && parent.enablePaste) {\n    var path = parent.folderPath === '' ? parent.path : parent.folderPath;\n    var subFolder = validateSubFolder(parent, parent.actionRecords, path, parent.path);\n\n    if (!subFolder) {\n      if (parent.fileAction === 'move' && parent.targetPath !== path || parent.fileAction === 'copy') {\n        parent.notify(events.pasteInit, {});\n        paste(parent, parent.targetPath, parent.selectedNodes, path, parent.fileAction, [], parent.actionRecords);\n      } else {\n        parent.enablePaste = false;\n        parent.notify(events.hidePaste, {});\n        removeBlur(parent);\n      }\n    }\n  }\n}\nexport function validateSubFolder(parent, data, dropPath, dragPath) {\n  var subFolder = false;\n\n  for (var i = 0; i < data.length; i++) {\n    if (!getValue('isFile', data[i])) {\n      var tempTarget = getFullPath(parent, data[i], dragPath);\n\n      if (dropPath.indexOf(tempTarget) !== -1) {\n        var result = {\n          files: null,\n          error: {\n            code: '402',\n            message: getLocaleText(parent, 'Sub-Folder-Error'),\n            fileExists: null\n          }\n        };\n        createDialog(parent, 'Error', result);\n        subFolder = true;\n        break;\n      }\n    }\n  }\n\n  return subFolder;\n}\nexport function dropHandler(parent) {\n  parent.isDragDrop = true;\n\n  if (parent.dragData.length !== 0) {\n    parent.dragPath = parent.dragPath.replace(/\\\\/g, '/');\n    parent.dropPath = parent.dropPath.replace(/\\\\/g, '/');\n    var subFolder = validateSubFolder(parent, parent.dragData, parent.dropPath, parent.dragPath);\n\n    if (!subFolder && parent.dragPath !== parent.dropPath) {\n      parent.itemData = [parent.dropData];\n      paste(parent, parent.dragPath, parent.dragNodes, parent.dropPath, 'move', [], parent.dragData);\n      parent.notify(events.pasteInit, {});\n    }\n  }\n}\nexport function getParentPath(oldPath) {\n  var path = oldPath.split('/');\n  var newPath = path[0] + '/';\n\n  for (var i = 1; i < path.length - 2; i++) {\n    newPath += path[i] + '/';\n  }\n\n  return newPath;\n}\nexport function getDirectoryPath(parent, args) {\n  var filePath = getValue(parent.hasId ? 'id' : 'name', args.cwd) + '/';\n  var fPath = getValue(parent.hasId ? 'filterId' : 'filterPath', args.cwd);\n\n  if (!isNOU(fPath)) {\n    if (fPath === '') {\n      return parent.hasId ? filePath : '/';\n    }\n\n    return fPath.replace(/\\\\/g, '/') + filePath;\n  } else {\n    return parent.path + filePath;\n  }\n}\nexport function doPasteUpdate(parent, operation, result) {\n  if (operation === 'move') {\n    if (!parent.isDragDrop) {\n      parent.enablePaste = false;\n      parent.notify(events.hidePaste, {});\n      parent.notify(events.cutEnd, result);\n    } else {\n      parent.notify(events.dragEnd, result);\n    }\n  }\n\n  if (parent.duplicateItems.length === 0) {\n    parent.pasteNodes = [];\n  }\n\n  var flag = false;\n\n  for (var count = 0; count < result.files.length && !flag; count++) {\n    parent.pasteNodes.push(result.files[count][parent.hasId ? 'id' : 'name']);\n\n    if (parent.isDragDrop) {\n      parent.droppedObjects.push(result.files[count]);\n    }\n  }\n\n  parent.duplicateItems = [];\n  parent.duplicateRecords = [];\n\n  if (parent.isDragDrop && !parent.isPasteError) {\n    parent.isDropEnd = true;\n  } else {\n    parent.isDropEnd = false;\n  }\n\n  if (!parent.isDragDrop || parent.path === parent.dragPath || parent.path === parent.dropPath || parent.isSearchDrag) {\n    parent.isPathDrag = false;\n    read(parent, events.pasteEnd, parent.path);\n  } else {\n    readDropPath(parent);\n  }\n\n  parent.trigger('success', {\n    action: operation,\n    result: result\n  });\n}\nexport function readDropPath(parent) {\n  var pathId = getValue('_fm_id', parent.dropData);\n  parent.expandedId = pathId;\n  parent.itemData = [parent.dropData];\n\n  if (parent.isPathDrag) {\n    parent.notify(events.pathDrag, parent.itemData);\n  } else {\n    if (parent.navigationpaneModule) {\n      var node = select('[data-uid=\"' + pathId + '\"]', parent.navigationpaneModule.treeObj.element);\n      updatePath(node, parent.dropData, parent);\n    }\n\n    read(parent, events.dropPath, parent.dropPath);\n  }\n}\nexport function getDuplicateData(parent, name) {\n  var data = null;\n  var records = parent.isDragDrop ? parent.dragData : parent.actionRecords;\n\n  for (var i = 0; i < records.length; i++) {\n    if (getValue('name', records[i]) === name) {\n      data = records[i];\n      break;\n    }\n  }\n\n  return data;\n}\nexport function createVirtualDragElement(parent) {\n  parent.isSearchDrag = false;\n\n  if (parent.breadcrumbbarModule.searchObj.element.value !== '') {\n    parent.isSearchDrag = true;\n  }\n\n  if (parent.activeModule !== 'navigationpane') {\n    parent.dragNodes = [];\n    var i = 0;\n\n    while (i < parent.selectedItems.length) {\n      parent.dragNodes.push(parent.selectedItems[i]);\n      i++;\n    }\n  }\n\n  var cloneIcon = parent.createElement('div', {\n    className: 'e-fe-icon ' + fileType(parent.dragData[0])\n  });\n  var cloneName = parent.createElement('div', {\n    className: 'e-fe-name',\n    innerHTML: parent.dragData[0].name\n  });\n  var virtualEle = parent.createElement('div', {\n    className: 'e-fe-content'\n  });\n  virtualEle.appendChild(cloneIcon);\n  virtualEle.appendChild(cloneName);\n  var ele = parent.createElement('div', {\n    className: CLS.CLONE\n  });\n  ele.appendChild(virtualEle);\n\n  if (parent.dragNodes.length > 1) {\n    var badge = parent.createElement('span', {\n      className: 'e-fe-count',\n      innerHTML: parent.dragNodes.length.toString(10)\n    });\n    ele.appendChild(badge);\n  }\n\n  parent.virtualDragElement = ele;\n  parent.element.appendChild(parent.virtualDragElement);\n}\nexport function dragStopHandler(parent, args) {\n  var dragArgs = args;\n  dragArgs.cancel = false;\n\n  if (parent.treeExpandTimer != null) {\n    window.clearTimeout(parent.treeExpandTimer);\n    parent.treeExpandTimer = null;\n  }\n\n  removeDropTarget(parent);\n  parent.element.classList.remove('e-fe-drop', 'e-no-drop');\n  removeBlur(parent);\n  parent.uploadObj.dropArea = select('#' + parent.element.id + CLS.CONTENT_ID, parent.element);\n  var virtualEle = select('.' + CLS.CLONE, parent.element);\n\n  if (virtualEle) {\n    detach(virtualEle);\n  }\n\n  getTargetModule(parent, args.target);\n  parent.notify(events.dropInit, args);\n  removeBlur(parent, 'hover');\n  dragArgs.fileDetails = parent.dragData;\n  parent.trigger('fileDragStop', dragArgs, function (dragArgs) {\n    if (!dragArgs.cancel && !isNOU(parent.targetModule) && parent.targetModule !== '') {\n      dropHandler(parent);\n    }\n  });\n}\nexport function dragStartHandler(parent, args, dragObj) {\n  var dragArgs = args;\n  dragArgs.cancel = false;\n  dragArgs.fileDetails = parent.dragData;\n  parent.droppedObjects = [];\n\n  if (!parent.allowDragAndDrop || parent.activeModule === 'navigationpane' && closest(args.element, 'li').getAttribute('data-uid') === parent.pathId[0]) {\n    dragArgs.cancel = true;\n  }\n\n  if (parent.activeModule === 'navigationpane' && parent.pathId.indexOf(closest(args.element, 'li').getAttribute('data-uid')) !== -1) {\n    parent.isPathDrag = true;\n  } else {\n    parent.isPathDrag = false;\n  }\n\n  removeBlur(parent);\n\n  if (dragArgs.cancel) {\n    dragObj.intDestroy(args.event);\n    dragCancel(parent);\n  } else if (!dragArgs.cancel) {\n    var i = 0;\n\n    while (i < parent.activeElements.length) {\n      addBlur(parent.activeElements[i]);\n      i++;\n    }\n\n    parent.trigger('fileDragStart', dragArgs, function (dragArgs) {\n      if (dragArgs.cancel) {\n        dragObj.intDestroy(args.event);\n        dragCancel(parent);\n      } else {\n        parent.uploadObj.dropArea = null;\n\n        if (isBlazor()) {\n          dragArgs.bindEvents(dragArgs.dragElement);\n        }\n      }\n    });\n  }\n}\nexport function dragCancel(parent) {\n  removeBlur(parent);\n  var virtualEle = select('.' + CLS.CLONE, parent.element);\n\n  if (virtualEle) {\n    detach(virtualEle);\n  }\n}\nexport function removeDropTarget(parent) {\n  removeItemClass(parent, CLS.DROP_FOLDER);\n  removeItemClass(parent, CLS.DROP_FILE);\n}\nexport function removeItemClass(parent, value) {\n  var ele = parent.element.querySelectorAll('.' + value);\n\n  for (var i = 0; i < ele.length; i++) {\n    ele[i].classList.remove(value);\n  }\n}\nexport function draggingHandler(parent, args) {\n  var dragArgs = args;\n  dragArgs.fileDetails = parent.dragData;\n  var canDrop = false;\n  getTargetModule(parent, args.target);\n  removeDropTarget(parent);\n\n  if (parent.treeExpandTimer != null) {\n    window.clearTimeout(parent.treeExpandTimer);\n    parent.treeExpandTimer = null;\n  }\n\n  removeBlur(parent, 'hover');\n  var node = null;\n\n  if (parent.targetModule === 'navigationpane') {\n    node = closest(args.target, 'li');\n    node.classList.add(CLS.HOVER, CLS.DROP_FOLDER);\n    canDrop = true;\n    /* istanbul ignore next */\n\n    parent.treeExpandTimer = window.setTimeout(function () {\n      parent.notify(events.dragging, args);\n    }, 800);\n  } else if (parent.targetModule === 'detailsview') {\n    node = closest(args.target, 'tr');\n\n    if (node && node.querySelector('.' + CLS.FOLDER) && !node.classList.contains(CLS.BLUR)) {\n      node.classList.add(CLS.DROP_FOLDER);\n    } else if (node && !node.querySelector('.' + CLS.FOLDER) && !node.classList.contains(CLS.BLUR)) {\n      node.classList.add(CLS.DROP_FILE);\n    }\n\n    canDrop = true;\n  } else if (parent.targetModule === 'largeiconsview') {\n    node = closest(args.target, 'li');\n\n    if (node && node.querySelector('.' + CLS.FOLDER) && !node.classList.contains(CLS.BLUR)) {\n      node.classList.add(CLS.HOVER, CLS.DROP_FOLDER);\n    }\n\n    canDrop = true;\n    /* istanbul ignore next */\n  } else if (parent.targetModule === 'breadcrumbbar') {\n    canDrop = true;\n  }\n\n  parent.element.classList.remove('e-fe-drop', 'e-no-drop');\n  parent.element.classList.add(canDrop ? 'e-fe-drop' : 'e-no-drop');\n  parent.trigger('fileDragging', dragArgs);\n} // Ignored the message key value in permission object\n\nexport function objectToString(data) {\n  var str = '';\n  var keys = Object.keys(data);\n\n  for (var i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'message') {\n      str += (i === 0 ? '' : ', ') + keys[i] + ': ' + getValue(keys[i], data);\n    }\n  }\n\n  return str;\n}\nexport function getItemName(parent, data) {\n  if (parent.hasId) {\n    return getValue('id', data);\n  }\n\n  return getName(parent, data);\n}\nexport function updateRenamingData(parent, data) {\n  parent.itemData = [data];\n  parent.currentItemText = getValue('name', data);\n  parent.isFile = getValue('isFile', data);\n  parent.filterPath = getValue('filterPath', data);\n}\nexport function doRename(parent) {\n  if (!hasEditAccess(parent.itemData[0])) {\n    createDeniedDialog(parent, parent.itemData[0], events.permissionEdit);\n  } else {\n    createDialog(parent, 'Rename');\n  }\n}\n/* istanbul ignore next */\n\nexport function doDownload(parent) {\n  var items = parent.itemData;\n\n  for (var i = 0; i < items.length; i++) {\n    if (!hasDownloadAccess(items[i])) {\n      createDeniedDialog(parent, items[i], events.permissionDownload);\n      return;\n    }\n  }\n\n  if (parent.selectedItems.length > 0) {\n    Download(parent, parent.path, parent.selectedItems);\n  }\n}\nexport function doDeleteFiles(parent, data, newIds) {\n  for (var i = 0; i < data.length; i++) {\n    if (!hasEditAccess(data[i])) {\n      createDeniedDialog(parent, data[i], events.permissionEdit);\n      return;\n    }\n  }\n\n  parent.itemData = data;\n  Delete(parent, newIds, parent.path, 'delete');\n}\n/* istanbul ignore next */\n\nexport function doDownloadFiles(parent, data, newIds) {\n  for (var i = 0; i < data.length; i++) {\n    if (!hasDownloadAccess(data[i])) {\n      createDeniedDialog(parent, data[i], events.permissionDownload);\n      return;\n    }\n  }\n\n  parent.itemData = data;\n\n  if (newIds.length > 0) {\n    Download(parent, parent.path, newIds);\n  }\n}\nexport function createDeniedDialog(parent, data, action) {\n  var message = getValue('message', getValue('permission', data));\n\n  if (message === '') {\n    message = getLocaleText(parent, 'Access-Message').replace('{0}', getValue('name', data)).replace('{1}', action);\n  }\n\n  var response = {\n    error: {\n      code: '401',\n      fileExists: null,\n      message: message\n    }\n  };\n  createDialog(parent, 'Error', response);\n}\nexport function getAccessClass(data) {\n  return !hasReadAccess(data) ? 'e-fe-locked e-fe-hidden' : 'e-fe-locked';\n}\nexport function hasReadAccess(data) {\n  var permission = getValue('permission', data);\n  return permission && !getValue('read', permission) ? false : true;\n}\nexport function hasEditAccess(data) {\n  var permission = getValue('permission', data);\n  return permission ? getValue('read', permission) && getValue('write', permission) : true;\n}\nexport function hasContentAccess(data) {\n  var permission = getValue('permission', data);\n  return permission ? getValue('read', permission) && getValue('writeContents', permission) : true;\n}\nexport function hasUploadAccess(data) {\n  var permission = getValue('permission', data);\n  return permission ? getValue('read', permission) && getValue('upload', permission) : true;\n}\nexport function hasDownloadAccess(data) {\n  var permission = getValue('permission', data);\n  return permission ? getValue('read', permission) && getValue('download', permission) : true;\n}\nexport function createNewFolder(parent) {\n  var details = parent.itemData[0];\n\n  if (!hasContentAccess(details)) {\n    createDeniedDialog(parent, details, events.permissionEditContents);\n  } else {\n    createDialog(parent, 'NewFolder');\n  }\n}\nexport function uploadItem(parent) {\n  var details = parent.itemData[0];\n\n  if (!hasUploadAccess(details)) {\n    createDeniedDialog(parent, details, events.permissionUpload);\n  } else {\n    var eleId = '#' + parent.element.id + CLS.UPLOAD_ID;\n    var uploadEle = document.querySelector(eleId);\n    uploadEle.click();\n  }\n}","map":null,"metadata":{},"sourceType":"module"}