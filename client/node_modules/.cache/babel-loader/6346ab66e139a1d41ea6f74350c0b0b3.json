{"ast":null,"code":"/**\r\n * DevExtreme (ui/text_box/ui.text_editor.mask.strategy.base.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _utils = require(\"../../events/utils\");\n\nvar _browser = require(\"../../core/utils/browser\");\n\nvar _browser2 = _interopRequireDefault(_browser);\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _dom = require(\"../../core/utils/dom\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar MASK_EVENT_NAMESPACE = \"dxMask\";\nvar BLUR_EVENT = \"blur beforedeactivate\";\nvar EMPTY_CHAR = \" \";\n\nvar BaseMaskStrategy = function () {\n  function BaseMaskStrategy(editor) {\n    _classCallCheck(this, BaseMaskStrategy);\n\n    this.editor = editor;\n    this.DIRECTION = {\n      FORWARD: \"forward\",\n      BACKWARD: \"backward\"\n    };\n    this.NAME = this._getStrategyName();\n  }\n\n  _createClass(BaseMaskStrategy, [{\n    key: \"_getStrategyName\",\n    value: function () {\n      return \"base\";\n    }\n  }, {\n    key: \"editorOption\",\n    value: function () {\n      var _this$editor;\n\n      return (_this$editor = this.editor).option.apply(_this$editor, arguments);\n    }\n  }, {\n    key: \"editorInput\",\n    value: function () {\n      return this.editor._input();\n    }\n  }, {\n    key: \"editorCaret\",\n    value: function (newCaret) {\n      if (!newCaret) {\n        return this.editor._caret();\n      }\n\n      this.editor._caret(newCaret);\n    }\n  }, {\n    key: \"getHandler\",\n    value: function (handlerName) {\n      var handler = this[\"_\".concat(handlerName, \"Handler\")] || function () {};\n\n      return handler.bind(this);\n    }\n  }, {\n    key: \"attachEvents\",\n    value: function () {\n      var _this = this;\n\n      var $input = this.editorInput();\n      this.getHandleEventNames().forEach(function (eventName) {\n        var subscriptionName = (0, _utils.addNamespace)(eventName.toLowerCase(), MASK_EVENT_NAMESPACE);\n\n        _events_engine2.default.on($input, subscriptionName, _this.getEventHandler(eventName));\n      });\n\n      this._attachChangeEventHandlers();\n    }\n  }, {\n    key: \"getHandleEventNames\",\n    value: function () {\n      return [\"focusIn\", \"focusOut\", \"keyDown\", \"input\", \"paste\", \"cut\", \"drop\"];\n    }\n  }, {\n    key: \"getEventHandler\",\n    value: function (eventName) {\n      return this[\"_\".concat(eventName, \"Handler\")].bind(this);\n    }\n  }, {\n    key: \"detachEvents\",\n    value: function () {\n      _events_engine2.default.off(this.editorInput(), \".\".concat(MASK_EVENT_NAMESPACE));\n    }\n  }, {\n    key: \"_attachChangeEventHandlers\",\n    value: function () {\n      if ((0, _array.inArray)(\"change\", this.editorOption(\"valueChangeEvent\").split(\" \")) === -1) {\n        return;\n      }\n\n      _events_engine2.default.on(this.editorInput(), (0, _utils.addNamespace)(BLUR_EVENT, MASK_EVENT_NAMESPACE), function (e) {\n        this._suppressCaretChanging(this._changeHandler, [e]);\n\n        this._changeHandler(e);\n      }.bind(this.editor));\n    }\n  }, {\n    key: \"_focusInHandler\",\n    value: function () {\n      this.editor._showMaskPlaceholder();\n\n      this.editor._direction(this.DIRECTION.FORWARD);\n\n      if (!this.editor._isValueEmpty() && this.editorOption(\"isValid\")) {\n        this.editor._adjustCaret();\n      } else {\n        var caret = this.editor._maskRulesChain.first();\n\n        this._caretTimeout = setTimeout(function () {\n          this._caret({\n            start: caret,\n            end: caret\n          });\n        }.bind(this.editor), 0);\n      }\n    }\n  }, {\n    key: \"_focusOutHandler\",\n    value: function (event) {\n      this.editor._changeHandler(event);\n\n      if (\"onFocus\" === this.editorOption(\"showMaskMode\") && this.editor._isValueEmpty()) {\n        this.editorOption(\"text\", \"\");\n\n        this.editor._renderDisplayText(\"\");\n      }\n    }\n  }, {\n    key: \"_cutHandler\",\n    value: function (event) {\n      var caret = this.editorCaret();\n      var selectedText = this.editorInput().val().substring(caret.start, caret.end);\n\n      this.editor._maskKeyHandler(event, function () {\n        return (0, _dom.clipboardText)(event, selectedText);\n      });\n    }\n  }, {\n    key: \"_dropHandler\",\n    value: function () {\n      this._clearDragTimer();\n\n      this._dragTimer = setTimeout(function () {\n        this.option(\"value\", this._convertToValue(this._input().val()));\n      }.bind(this.editor));\n    }\n  }, {\n    key: \"_clearDragTimer\",\n    value: function () {\n      clearTimeout(this._dragTimer);\n    }\n  }, {\n    key: \"_keyDownHandler\",\n    value: function () {\n      this._keyPressHandled = false;\n    }\n  }, {\n    key: \"_pasteHandler\",\n    value: function (event) {\n      var editor = this.editor;\n      this._keyPressHandled = true;\n      var caret = this.editorCaret();\n\n      editor._maskKeyHandler(event, function () {\n        var pastedText = (0, _dom.clipboardText)(event);\n\n        var restText = editor._maskRulesChain.text().substring(caret.end);\n\n        var accepted = editor._handleChain({\n          text: pastedText,\n          start: caret.start,\n          length: pastedText.length\n        });\n\n        var newCaret = caret.start + accepted;\n\n        editor._handleChain({\n          text: restText,\n          start: newCaret,\n          length: restText.length\n        });\n\n        editor._caret({\n          start: newCaret,\n          end: newCaret\n        });\n      });\n    }\n  }, {\n    key: \"_autoFillHandler\",\n    value: function (event) {\n      var _this2 = this;\n\n      var editor = this.editor;\n      var inputVal = this.editorInput().val();\n      this._inputHandlerTimer = setTimeout(function () {\n        _this2._keyPressHandled = true;\n\n        if (_this2._isAutoFill()) {\n          _this2._keyPressHandled = true;\n\n          editor._maskKeyHandler(event, function () {\n            editor._handleChain({\n              text: inputVal,\n              start: 0,\n              length: inputVal.length\n            });\n          });\n\n          editor._validateMask();\n        }\n      });\n    }\n  }, {\n    key: \"_isAutoFill\",\n    value: function () {\n      var $input = this.editor._input();\n\n      var result = false;\n\n      if (_browser2.default.msie && _browser2.default.version > 11) {\n        result = $input.hasClass(\"edge-autofilled\");\n      } else {\n        if (_browser2.default.webkit) {\n          var input = $input.get(0);\n          result = input && input.matches(\":-webkit-autofill\");\n        }\n      }\n\n      return result;\n    }\n  }, {\n    key: \"runWithoutEventProcessing\",\n    value: function (action) {\n      var keyPressHandled = this._keyPressHandled;\n      this._keyPressHandled = true;\n      action();\n      this._keyPressHandled = keyPressHandled;\n    }\n  }, {\n    key: \"_backspaceHandler\",\n    value: function () {}\n  }, {\n    key: \"_delHandler\",\n    value: function (event) {\n      var editor = this.editor;\n      this._keyPressHandled = true;\n\n      editor._maskKeyHandler(event, function () {\n        return !editor._hasSelection() && editor._handleKey(EMPTY_CHAR);\n      });\n    }\n  }, {\n    key: \"clean\",\n    value: function () {\n      this._clearDragTimer();\n\n      clearTimeout(this._backspaceHandlerTimeout);\n      clearTimeout(this._caretTimeout);\n      clearTimeout(this._inputHandlerTimer);\n    }\n  }]);\n\n  return BaseMaskStrategy;\n}();\n\nexports.default = BaseMaskStrategy;","map":null,"metadata":{},"sourceType":"script"}