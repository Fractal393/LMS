{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.context_menu.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _context_menu = require(\"../context_menu\");\n\nvar _context_menu2 = _interopRequireDefault(_context_menu);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar CONTEXT_MENU = \"dx-context-menu\";\nvar viewName = {\n  columnHeadersView: \"header\",\n  rowsView: \"content\",\n  footerView: \"footer\",\n  headerPanel: \"headerPanel\"\n};\nvar VIEW_NAMES = [\"columnHeadersView\", \"rowsView\", \"footerView\", \"headerPanel\"];\n\nvar ContextMenuController = _uiGrid_core2.default.ViewController.inherit({\n  init: function () {\n    this.createAction(\"onContextMenuPreparing\");\n  },\n  getContextMenuItems: function (dxEvent) {\n    if (!dxEvent) {\n      return false;\n    }\n\n    var that = this;\n    var $targetElement = (0, _renderer2.default)(dxEvent.target);\n    var $element;\n    var $targetRowElement;\n    var $targetCellElement;\n    var menuItems;\n    (0, _iterator.each)(VIEW_NAMES, function () {\n      var view = that.getView(this);\n      $element = view && view.element();\n\n      if ($element && ($element.is($targetElement) || $element.find($targetElement).length)) {\n        $targetCellElement = $targetElement.closest(\".dx-row > td, .dx-row > tr\");\n        $targetRowElement = $targetCellElement.parent();\n        var rowIndex = view.getRowIndex($targetRowElement);\n        var columnIndex = $targetCellElement[0] && $targetCellElement[0].cellIndex;\n        var rowOptions = $targetRowElement.data(\"options\");\n        var options = {\n          event: dxEvent,\n          targetElement: (0, _dom.getPublicElement)($targetElement),\n          target: viewName[this],\n          rowIndex: rowIndex,\n          row: view._getRows()[rowIndex],\n          columnIndex: columnIndex,\n          column: rowOptions && rowOptions.cells[columnIndex].column\n        };\n        options.items = view.getContextMenuItems && view.getContextMenuItems(options);\n        that.executeAction(\"onContextMenuPreparing\", options);\n\n        that._contextMenuPrepared(options);\n\n        menuItems = options.items;\n\n        if (menuItems) {\n          return false;\n        }\n      }\n    });\n    return menuItems;\n  },\n  _contextMenuPrepared: _common.noop\n});\n\nvar ContextMenuView = _uiGrid_core2.default.View.inherit({\n  _renderCore: function () {\n    var that = this;\n    var $element = that.element().addClass(CONTEXT_MENU);\n    this.setAria(\"role\", \"presentation\", $element);\n\n    this._createComponent($element, _context_menu2.default, {\n      onPositioning: function (actionArgs) {\n        var event = actionArgs.event;\n        var contextMenuInstance = actionArgs.component;\n        var items = that.getController(\"contextMenu\").getContextMenuItems(event);\n\n        if (items) {\n          contextMenuInstance.option(\"items\", items);\n          event.stopPropagation();\n        } else {\n          actionArgs.cancel = true;\n        }\n      },\n      onItemClick: function (params) {\n        params.itemData.onItemClick && params.itemData.onItemClick(params);\n      },\n      cssClass: that.getWidgetContainerClass(),\n      target: that.component.$element()\n    });\n  }\n});\n\nmodule.exports = {\n  defaultOptions: function () {\n    return {\n      onContextMenuPreparing: null\n    };\n  },\n  controllers: {\n    contextMenu: ContextMenuController\n  },\n  views: {\n    contextMenuView: ContextMenuView\n  }\n};","map":null,"metadata":{},"sourceType":"script"}