{"ast":null,"code":"/**\r\n * DevExtreme (ui/list/ui.list.edit.provider.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\");\n\nvar noop = require(\"../../core/utils/common\").noop;\n\nvar Class = require(\"../../core/class\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar each = require(\"../../core/utils/iterator\").each;\n\nvar errors = require(\"../widget/ui.errors\");\n\nvar decoratorRegistry = require(\"./ui.list.edit.decorator_registry\");\n\nrequire(\"./ui.list.edit.decorator.static\");\n\nrequire(\"./ui.list.edit.decorator.switchable.button\");\n\nrequire(\"./ui.list.edit.decorator.switchable.slide\");\n\nrequire(\"./ui.list.edit.decorator.swipe\");\n\nrequire(\"./ui.list.edit.decorator.context\");\n\nrequire(\"./ui.list.edit.decorator.selection\");\n\nrequire(\"./ui.list.edit.decorator.reorder\");\n\nvar editOptionsRegistry = [];\n\nvar registerOption = function (enabledFunc, decoratorTypeFunc, decoratorSubTypeFunc) {\n  editOptionsRegistry.push({\n    enabled: enabledFunc,\n    decoratorType: decoratorTypeFunc,\n    decoratorSubType: decoratorSubTypeFunc\n  });\n};\n\nregisterOption(function () {\n  return this.option(\"menuItems\").length;\n}, function () {\n  return \"menu\";\n}, function () {\n  return this.option(\"menuMode\");\n});\nregisterOption(function () {\n  return !this.option(\"menuItems\").length && this.option(\"allowItemDeleting\");\n}, function () {\n  var mode = this.option(\"itemDeleteMode\");\n  return \"toggle\" === mode || \"slideButton\" === mode || \"swipe\" === mode || \"static\" === mode ? \"delete\" : \"menu\";\n}, function () {\n  var mode = this.option(\"itemDeleteMode\");\n\n  if (\"slideItem\" === mode) {\n    mode = \"slide\";\n  }\n\n  if (\"hold\" === mode) {\n    mode = \"context\";\n  }\n\n  return mode;\n});\nregisterOption(function () {\n  return \"none\" !== this.option(\"selectionMode\") && this.option(\"showSelectionControls\");\n}, function () {\n  return \"selection\";\n}, function () {\n  return \"default\";\n});\nregisterOption(function () {\n  return this.option(\"itemDragging.allowReordering\") || this.option(\"itemDragging.allowDropInsideItem\") || this.option(\"itemDragging.group\");\n}, function () {\n  return \"reorder\";\n}, function () {\n  return \"default\";\n});\nvar LIST_ITEM_BEFORE_BAG_CLASS = \"dx-list-item-before-bag\";\nvar LIST_ITEM_AFTER_BAG_CLASS = \"dx-list-item-after-bag\";\nvar DECORATOR_BEFORE_BAG_CREATE_METHOD = \"beforeBag\";\nvar DECORATOR_AFTER_BAG_CREATE_METHOD = \"afterBag\";\nvar DECORATOR_MODIFY_ELEMENT_METHOD = \"modifyElement\";\nvar DECORATOR_AFTER_RENDER_METHOD = \"afterRender\";\nvar DECORATOR_GET_EXCLUDED_SELECTORS_METHOD = \"getExcludedSelectors\";\nvar EditProvider = Class.inherit({\n  ctor: function (list) {\n    this._list = list;\n\n    this._fetchRequiredDecorators();\n  },\n  dispose: function () {\n    if (this._decorators && this._decorators.length) {\n      each(this._decorators, function (_, decorator) {\n        decorator.dispose();\n      });\n    }\n  },\n  _fetchRequiredDecorators: function () {\n    this._decorators = [];\n    each(editOptionsRegistry, function (_, option) {\n      var optionEnabled = option.enabled.call(this._list);\n\n      if (optionEnabled) {\n        var decoratorType = option.decoratorType.call(this._list);\n        var decoratorSubType = option.decoratorSubType.call(this._list);\n\n        var decorator = this._createDecorator(decoratorType, decoratorSubType);\n\n        this._decorators.push(decorator);\n      }\n    }.bind(this));\n  },\n  _createDecorator: function (type, subType) {\n    var decoratorClass = this._findDecorator(type, subType);\n\n    return new decoratorClass(this._list);\n  },\n  _findDecorator: function (type, subType) {\n    var foundDecorator = decoratorRegistry.registry[type][subType];\n\n    if (!foundDecorator) {\n      throw errors.Error(\"E1012\", type, subType);\n    }\n\n    return foundDecorator;\n  },\n  modifyItemElement: function (args) {\n    var $itemElement = $(args.itemElement);\n    var config = {\n      $itemElement: $itemElement\n    };\n\n    this._prependBeforeBags($itemElement, config);\n\n    this._appendAfterBags($itemElement, config);\n\n    this._applyDecorators(DECORATOR_MODIFY_ELEMENT_METHOD, config);\n  },\n  afterItemsRendered: function () {\n    this._applyDecorators(DECORATOR_AFTER_RENDER_METHOD);\n  },\n  _prependBeforeBags: function ($itemElement, config) {\n    var $beforeBags = this._collectDecoratorsMarkup(DECORATOR_BEFORE_BAG_CREATE_METHOD, config, LIST_ITEM_BEFORE_BAG_CLASS);\n\n    $itemElement.prepend($beforeBags);\n  },\n  _appendAfterBags: function ($itemElement, config) {\n    var $afterBags = this._collectDecoratorsMarkup(DECORATOR_AFTER_BAG_CREATE_METHOD, config, LIST_ITEM_AFTER_BAG_CLASS);\n\n    $itemElement.append($afterBags);\n  },\n  _collectDecoratorsMarkup: function (method, config, containerClass) {\n    var $collector = $(\"<div>\");\n    each(this._decorators, function () {\n      var $container = $(\"<div>\").addClass(containerClass);\n      this[method](extend({\n        $container: $container\n      }, config));\n\n      if ($container.children().length) {\n        $collector.append($container);\n      }\n    });\n    return $collector.children();\n  },\n  _applyDecorators: function (method, config) {\n    each(this._decorators, function () {\n      this[method](config);\n    });\n  },\n  _handlerExists: function (name) {\n    if (!this._decorators) {\n      return false;\n    }\n\n    var decorators = this._decorators;\n    var length = decorators.length;\n\n    for (var i = 0; i < length; i++) {\n      if (decorators[i][name] !== noop) {\n        return true;\n      }\n    }\n\n    return false;\n  },\n  _eventHandler: function (name, $itemElement, e) {\n    if (!this._decorators) {\n      return false;\n    }\n\n    var response = false;\n    var decorators = this._decorators;\n    var length = decorators.length;\n\n    for (var i = 0; i < length; i++) {\n      response = decorators[i][name]($itemElement, e);\n\n      if (response) {\n        break;\n      }\n    }\n\n    return response;\n  },\n  handleClick: function ($itemElement, e) {\n    return this._eventHandler(\"handleClick\", $itemElement, e);\n  },\n  handleKeyboardEvents: function (currentFocusedIndex, moveFocusUp) {\n    return this._eventHandler(\"handleKeyboardEvents\", currentFocusedIndex, moveFocusUp);\n  },\n  handleEnterPressing: function () {\n    return this._eventHandler(\"handleEnterPressing\");\n  },\n  contextMenuHandlerExists: function () {\n    return this._handlerExists(\"handleContextMenu\");\n  },\n  handleContextMenu: function ($itemElement, e) {\n    return this._eventHandler(\"handleContextMenu\", $itemElement, e);\n  },\n  getExcludedItemSelectors: function () {\n    var excludedSelectors = [];\n\n    this._applyDecorators(DECORATOR_GET_EXCLUDED_SELECTORS_METHOD, excludedSelectors);\n\n    return excludedSelectors.join(\",\");\n  }\n});\nmodule.exports = EditProvider;","map":null,"metadata":{},"sourceType":"script"}