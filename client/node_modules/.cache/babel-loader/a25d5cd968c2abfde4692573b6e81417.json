{"ast":null,"code":"/**\r\n * DevExtreme (ui/hierarchical_collection/ui.hierarchical_collection_widget.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _icon = require(\"../../core/utils/icon\");\n\nvar _icon2 = _interopRequireDefault(_icon);\n\nvar _ui = require(\"./ui.data_adapter\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nvar _uiCollection_widget = require(\"../collection/ui.collection_widget.edit\");\n\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\n\nvar _bindable_template = require(\"../../core/templates/bindable_template\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _common = require(\"../../core/utils/common\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\n\nvar HierarchicalCollectionWidget = _uiCollection_widget2.default.inherit({\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      keyExpr: \"id\",\n      displayExpr: \"text\",\n      selectedExpr: \"selected\",\n      disabledExpr: \"disabled\",\n      itemsExpr: \"items\",\n      hoverStateEnabled: true,\n      parentIdExpr: \"parentId\",\n      expandedExpr: \"expanded\"\n    });\n  },\n  _defaultOptionsRules: function () {\n    return this.callBase().concat([{\n      device: function () {\n        return \"desktop\" === _devices2.default.real().deviceType && !_devices2.default.isSimulator();\n      },\n      options: {\n        focusStateEnabled: true\n      }\n    }]);\n  },\n  _init: function () {\n    this.callBase();\n\n    this._initAccessors();\n\n    this._initDataAdapter();\n\n    this._initDynamicTemplates();\n  },\n  _initDataSource: function () {\n    this.callBase();\n    this._dataSource && this._dataSource.paginate(false);\n  },\n  _initDataAdapter: function () {\n    var accessors = this._createDataAdapterAccessors();\n\n    this._dataAdapter = new _ui2.default((0, _extend.extend)({\n      dataAccessors: {\n        getters: accessors.getters,\n        setters: accessors.setters\n      },\n      items: this.option(\"items\")\n    }, this._getDataAdapterOptions()));\n  },\n  _getDataAdapterOptions: _common.noop,\n  _initDynamicTemplates: function () {\n    var that = this;\n\n    this._templateManager.addDefaultTemplates({\n      item: new _bindable_template.BindableTemplate(function ($container, itemData) {\n        $container.html(itemData.html).append(this._getIconContainer(itemData)).append(this._getTextContainer(itemData)).append(this._getPopoutContainer(itemData));\n\n        that._addContentClasses(itemData, $container.parent());\n      }.bind(this), [\"text\", \"html\", \"items\", \"icon\"], this.option(\"integrationOptions.watchMethod\"), {\n        text: this._displayGetter,\n        items: this._itemsGetter\n      })\n    });\n  },\n  _getIconContainer: function (itemData) {\n    return itemData.icon ? _icon2.default.getImageContainer(itemData.icon) : void 0;\n  },\n  _getTextContainer: function (itemData) {\n    return (0, _renderer2.default)(\"<span>\").text(itemData.text);\n  },\n  _getPopoutContainer: _common.noop,\n  _addContentClasses: _common.noop,\n  _initAccessors: function () {\n    var that = this;\n    (0, _iterator.each)(this._getAccessors(), function (_, accessor) {\n      that._compileAccessor(accessor);\n    });\n\n    this._compileDisplayGetter();\n  },\n  _getAccessors: function () {\n    return [\"key\", \"selected\", \"items\", \"disabled\", \"parentId\", \"expanded\"];\n  },\n  _getChildNodes: function (node) {\n    var that = this;\n    var arr = [];\n    (0, _iterator.each)(node.internalFields.childrenKeys, function (_, key) {\n      var childNode = that._dataAdapter.getNodeByKey(key);\n\n      arr.push(childNode);\n    });\n    return arr;\n  },\n  _hasChildren: function (node) {\n    return node && node.internalFields.childrenKeys.length;\n  },\n  _compileAccessor: function (optionName) {\n    var getter = \"_\" + optionName + \"Getter\";\n    var setter = \"_\" + optionName + \"Setter\";\n    var optionExpr = this.option(optionName + \"Expr\");\n\n    if (!optionExpr) {\n      this[getter] = _common.noop;\n      this[setter] = _common.noop;\n      return;\n    } else {\n      if ((0, _type.isFunction)(optionExpr)) {\n        this[setter] = function (obj, value) {\n          obj[optionExpr()] = value;\n        };\n\n        this[getter] = function (obj) {\n          return obj[optionExpr()];\n        };\n\n        return;\n      }\n    }\n\n    this[getter] = (0, _data.compileGetter)(optionExpr);\n    this[setter] = (0, _data.compileSetter)(optionExpr);\n  },\n  _createDataAdapterAccessors: function () {\n    var that = this;\n    var accessors = {\n      getters: {},\n      setters: {}\n    };\n    (0, _iterator.each)(this._getAccessors(), function (_, accessor) {\n      var getterName = \"_\" + accessor + \"Getter\";\n      var setterName = \"_\" + accessor + \"Setter\";\n      var newAccessor = \"parentId\" === accessor ? \"parentKey\" : accessor;\n      accessors.getters[newAccessor] = that[getterName];\n      accessors.setters[newAccessor] = that[setterName];\n    });\n    accessors.getters.display = !this._displayGetter ? function (itemData) {\n      return itemData.text;\n    } : this._displayGetter;\n    return accessors;\n  },\n  _initMarkup: function () {\n    this.callBase();\n\n    this._addWidgetClass();\n  },\n  _addWidgetClass: function () {\n    this._focusTarget().addClass(this._widgetClass());\n  },\n  _widgetClass: _common.noop,\n  _renderItemFrame: function (index, itemData) {\n    var $itemFrame = this.callBase.apply(this, arguments);\n    $itemFrame.toggleClass(DISABLED_STATE_CLASS, !!this._disabledGetter(itemData));\n    return $itemFrame;\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"displayExpr\":\n      case \"keyExpr\":\n        this._initAccessors();\n\n        this._initDynamicTemplates();\n\n        this.repaint();\n        break;\n\n      case \"itemsExpr\":\n      case \"selectedExpr\":\n      case \"disabledExpr\":\n      case \"expandedExpr\":\n      case \"parentIdExpr\":\n        this._initAccessors();\n\n        this._initDataAdapter();\n\n        this.repaint();\n        break;\n\n      case \"items\":\n        this._initDataAdapter();\n\n        this.callBase(args);\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  }\n});\n\nmodule.exports = HierarchicalCollectionWidget;","map":null,"metadata":{},"sourceType":"script"}