{"ast":null,"code":"/**\r\n * DevExtreme (core/utils/selection_filter.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar getKeyHash = require(\"./common\").getKeyHash;\n\nvar equalByValue = require(\"./common\").equalByValue;\n\nvar typeUtils = require(\"./type\");\n\nvar SelectionFilterCreator = function (selectedItemKeys, isSelectAll) {\n  this.getLocalFilter = function (keyGetter, equalKeys, equalByReference, keyExpr) {\n    equalKeys = void 0 === equalKeys ? equalByValue : equalKeys;\n    return functionFilter.bind(this, equalKeys, keyGetter, equalByReference, keyExpr);\n  };\n\n  this.getExpr = function (keyExpr) {\n    if (!keyExpr) {\n      return;\n    }\n\n    var filterExpr;\n    selectedItemKeys.forEach(function (key, index) {\n      filterExpr = filterExpr || [];\n      var filterExprPart;\n\n      if (index > 0) {\n        filterExpr.push(isSelectAll ? \"and\" : \"or\");\n      }\n\n      if (typeUtils.isString(keyExpr)) {\n        filterExprPart = getFilterForPlainKey(keyExpr, key);\n      } else {\n        filterExprPart = getFilterForCompositeKey(keyExpr, key);\n      }\n\n      filterExpr.push(filterExprPart);\n    });\n\n    if (filterExpr && 1 === filterExpr.length) {\n      filterExpr = filterExpr[0];\n    }\n\n    return filterExpr;\n  };\n\n  this.getCombinedFilter = function (keyExpr, dataSourceFilter) {\n    var filterExpr = this.getExpr(keyExpr);\n    var combinedFilter = filterExpr;\n\n    if (isSelectAll && dataSourceFilter) {\n      if (filterExpr) {\n        combinedFilter = [];\n        combinedFilter.push(filterExpr);\n        combinedFilter.push(dataSourceFilter);\n      } else {\n        combinedFilter = dataSourceFilter;\n      }\n    }\n\n    return combinedFilter;\n  };\n\n  var selectedItemKeyHashesMap;\n\n  var getSelectedItemKeyHashesMap = function (selectedItemKeys) {\n    if (!selectedItemKeyHashesMap) {\n      selectedItemKeyHashesMap = {};\n\n      for (var i = 0; i < selectedItemKeys.length; i++) {\n        selectedItemKeyHashesMap[getKeyHash(selectedItemKeys[i])] = true;\n      }\n    }\n\n    return selectedItemKeyHashesMap;\n  };\n\n  var normalizeKeys = function (keys, keyOf, keyExpr) {\n    return Array.isArray(keyExpr) ? keys.map(function (key) {\n      return keyOf(key);\n    }) : keys;\n  };\n\n  function functionFilter(equalKeys, keyOf, equalByReference, keyExpr, item) {\n    var key = keyOf(item);\n    var keyHash;\n    var i;\n\n    if (!equalByReference) {\n      keyHash = getKeyHash(key);\n\n      if (!typeUtils.isObject(keyHash)) {\n        var selectedKeyHashesMap = getSelectedItemKeyHashesMap(normalizeKeys(selectedItemKeys, keyOf, keyExpr));\n\n        if (selectedKeyHashesMap[keyHash]) {\n          return !isSelectAll;\n        }\n\n        return !!isSelectAll;\n      }\n    }\n\n    for (i = 0; i < selectedItemKeys.length; i++) {\n      if (equalKeys(selectedItemKeys[i], key)) {\n        return !isSelectAll;\n      }\n    }\n\n    return !!isSelectAll;\n  }\n\n  function getFilterForPlainKey(keyExpr, keyValue) {\n    if (void 0 === keyValue) {\n      return;\n    }\n\n    return [keyExpr, isSelectAll ? \"<>\" : \"=\", keyValue];\n  }\n\n  function getFilterForCompositeKey(keyExpr, itemKeyValue) {\n    var filterExpr = [];\n\n    for (var i = 0, length = keyExpr.length; i < length; i++) {\n      var currentKeyExpr = keyExpr[i];\n      var currentKeyValue = itemKeyValue && itemKeyValue[currentKeyExpr];\n      var filterExprPart = getFilterForPlainKey(currentKeyExpr, currentKeyValue);\n\n      if (!filterExprPart) {\n        break;\n      }\n\n      if (i > 0) {\n        filterExpr.push(isSelectAll ? \"or\" : \"and\");\n      }\n\n      filterExpr.push(filterExprPart);\n    }\n\n    return filterExpr;\n  }\n};\n\nexports.SelectionFilterCreator = SelectionFilterCreator;","map":null,"metadata":{},"sourceType":"script"}