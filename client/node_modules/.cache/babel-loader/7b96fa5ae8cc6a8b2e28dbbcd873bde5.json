{"ast":null,"code":"/**\n * SanitizeHtmlHelper for sanitize the value.\n */\nimport { detach } from './dom';\nvar removeTags = ['script', 'style', 'iframe[src]', 'link[href*=\"javascript:\"]', 'object[type=\"text/x-scriptlet\"]', 'object[data^=\"data:text/html;base64\"]', 'img[src^=\"data:text/html;base64\"]', '[src^=\"javascript:\"]', '[dynsrc^=\"javascript:\"]', '[lowsrc^=\"javascript:\"]', '[type^=\"application/x-shockwave-flash\"]'];\nvar removeAttrs = [{\n  attribute: 'href',\n  selector: '[href*=\"javascript:\"]'\n}, {\n  attribute: 'background',\n  selector: '[background^=\"javascript:\"]'\n}, {\n  attribute: 'style',\n  selector: '[style*=\"javascript:\"]'\n}, {\n  attribute: 'style',\n  selector: '[style*=\"expression(\"]'\n}, {\n  attribute: 'href',\n  selector: 'a[href^=\"data:text/html;base64\"]'\n}];\nvar jsEvents = ['onchange', 'onclick', 'onmouseover', 'onmouseout', 'onkeydown', 'onload', 'onerror', 'onblur', 'onfocus', 'onbeforeload', 'onbeforeunload', 'onkeyup', 'onsubmit', 'onafterprint', 'onbeforeonload', 'onbeforeprint', 'onblur', 'oncanplay', 'oncanplaythrough', 'onchange', 'onclick', 'oncontextmenu', 'ondblclick', 'ondrag', 'ondragend', 'ondragenter', 'ondragleave', 'ondragover', 'ondragstart', 'ondrop', 'ondurationchange', 'onemptied', 'onended', 'onerror', 'onerror', 'onfocus', 'onformchange', 'onforminput', 'onhaschange', 'oninput', 'oninvalid', 'onkeydown', 'onkeypress', 'onkeyup', 'onload', 'onloadeddata', 'onloadedmetadata', 'onloadstart', 'onmessage', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onmousewheel', 'onoffline', 'onoine', 'ononline', 'onpagehide', 'onpageshow', 'onpause', 'onplay', 'onplaying', 'onpopstate', 'onprogress', 'onratechange', 'onreadystatechange', 'onredo', 'onresize', 'onscroll', 'onseeked', 'onseeking', 'onselect', 'onstalled', 'onstorage', 'onsubmit', 'onsuspend', 'ontimeupdate', 'onundo', 'onunload', 'onvolumechange', 'onwaiting', 'onmouseenter', 'onmouseleave', 'onmousewheel', 'onstart', 'onpropertychange'];\n\nvar SanitizeHtmlHelper =\n/** @class */\nfunction () {\n  function SanitizeHtmlHelper() {}\n\n  SanitizeHtmlHelper.beforeSanitize = function () {\n    return {\n      selectors: {\n        tags: removeTags,\n        attributes: removeAttrs\n      }\n    };\n  };\n\n  ;\n\n  SanitizeHtmlHelper.sanitize = function (value) {\n    var item = this.beforeSanitize();\n    var output = this.serializeValue(item, value);\n    return output;\n  };\n\n  SanitizeHtmlHelper.serializeValue = function (item, value) {\n    this.removeAttrs = item.selectors.attributes;\n    this.removeTags = item.selectors.tags;\n    this.wrapElement = document.createElement('div');\n    this.wrapElement.innerHTML = value;\n    this.removeXssTags();\n    this.removeJsEvents();\n    this.removeXssAttrs();\n    var tempEleValue = this.wrapElement.innerHTML;\n    this.removeElement();\n    return tempEleValue;\n  };\n\n  SanitizeHtmlHelper.removeElement = function () {\n    // Removes an element's attibute to avoid html tag validation\n    var nodes = this.wrapElement.children;\n\n    for (var j = 0; j < nodes.length; j++) {\n      var attribute = nodes[j].attributes;\n\n      for (var i = 0; i < attribute.length; i++) {\n        this.wrapElement.children[j].removeAttribute(attribute[i].localName);\n      }\n    }\n  };\n\n  SanitizeHtmlHelper.removeXssTags = function () {\n    var elements = this.wrapElement.querySelectorAll(this.removeTags.join(','));\n\n    if (elements.length > 0) {\n      elements.forEach(function (element) {\n        detach(element);\n      });\n    } else {\n      return;\n    }\n  };\n\n  SanitizeHtmlHelper.removeJsEvents = function () {\n    var elements = this.wrapElement.querySelectorAll('[' + jsEvents.join('],[') + ']');\n\n    if (elements.length > 0) {\n      elements.forEach(function (element) {\n        jsEvents.forEach(function (attr) {\n          if (element.hasAttribute(attr)) {\n            element.removeAttribute(attr);\n          }\n        });\n      });\n    } else {\n      return;\n    }\n  };\n\n  SanitizeHtmlHelper.removeXssAttrs = function () {\n    var _this = this;\n\n    this.removeAttrs.forEach(function (item, index) {\n      var elements = _this.wrapElement.querySelectorAll(item.selector);\n\n      if (elements.length > 0) {\n        elements.forEach(function (element) {\n          element.removeAttribute(item.attribute);\n        });\n      }\n    });\n  };\n\n  return SanitizeHtmlHelper;\n}();\n\nexport { SanitizeHtmlHelper };","map":null,"metadata":{},"sourceType":"module"}