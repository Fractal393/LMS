{"ast":null,"code":"import { closest, isNullOrUndefined, EventHandler } from '@syncfusion/ej2-base';\nimport { remove, isBlazor } from '@syncfusion/ej2-base';\nimport { ContextMenu as Menu } from '@syncfusion/ej2-navigations';\nimport * as events from '../base/constant';\nimport { Resize } from '../actions/resize';\nimport { Page } from '../actions/page';\nimport { parentsUntil, applyBiggerTheme } from '../base/util';\nimport { Group } from '../actions/group';\nimport { Sort } from '../actions/sort';\nimport { PdfExport } from '../actions/pdf-export';\nimport { ExcelExport } from '../actions/excel-export';\nexport var menuClass = {\n  header: '.e-gridheader',\n  content: '.e-gridcontent',\n  edit: '.e-inline-edit',\n  batchEdit: '.e-editedbatchcell',\n  editIcon: 'e-edit',\n  pager: '.e-gridpager',\n  delete: 'e-delete',\n  save: 'e-save',\n  cancel: 'e-cancel',\n  copy: 'e-copy',\n  pdf: 'e-pdfexport',\n  group: 'e-icon-group',\n  ungroup: 'e-icon-ungroup',\n  csv: 'e-csvexport',\n  excel: 'e-excelexport',\n  fPage: 'e-icon-first',\n  nPage: 'e-icon-next',\n  lPage: 'e-icon-last',\n  pPage: 'e-icon-prev',\n  ascending: 'e-icon-ascending',\n  descending: 'e-icon-descending',\n  groupHeader: 'e-groupdroparea',\n  touchPop: 'e-gridpopup'\n};\n/**\n * The `ContextMenu` module is used to handle context menu actions.\n */\n\nvar ContextMenu =\n/** @class */\nfunction () {\n  function ContextMenu(parent, serviceLocator) {\n    this.defaultItems = {};\n    this.disableItems = [];\n    this.hiddenItems = [];\n    this.localeText = this.setLocaleKey();\n    this.parent = parent;\n    this.gridID = parent.element.id;\n    this.serviceLocator = serviceLocator;\n    this.addEventListener();\n  }\n  /**\n   * @hidden\n   */\n\n\n  ContextMenu.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.uiUpdate, this.enableAfterRenderMenu, this);\n    this.parent.on(events.initialLoad, this.render, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  ContextMenu.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.initialLoad, this.render);\n    this.parent.off(events.uiUpdate, this.enableAfterRenderMenu);\n    EventHandler.remove(this.element, 'keydown', this.keyDownHandler.bind(this));\n  };\n\n  ContextMenu.prototype.keyDownHandler = function (e) {\n    if (e.code === 'Tab' || e.which === 9) {\n      this.contextMenu.close();\n    }\n\n    if (e.code === 'Escape') {\n      this.contextMenu.close();\n      this.parent.notify(events.restoreFocus, {});\n    }\n  };\n\n  ContextMenu.prototype.render = function () {\n    this.parent.element.classList.add('e-noselect');\n    this.l10n = this.serviceLocator.getService('localization');\n    this.element = this.parent.createElement('ul', {\n      id: this.gridID + '_cmenu'\n    });\n    EventHandler.add(this.element, 'keydown', this.keyDownHandler.bind(this));\n    this.parent.element.appendChild(this.element);\n    var target = '#' + this.gridID;\n    this.contextMenu = new Menu({\n      items: this.getMenuItems(),\n      enableRtl: this.parent.enableRtl,\n      enablePersistence: this.parent.enablePersistence,\n      locale: this.parent.locale,\n      target: target,\n      select: this.contextMenuItemClick.bind(this),\n      beforeOpen: this.contextMenuBeforeOpen.bind(this),\n      onOpen: this.contextMenuOpen.bind(this),\n      onClose: this.contextMenuOnClose.bind(this),\n      cssClass: 'e-grid-menu'\n    });\n    this.contextMenu.appendTo(this.element);\n  };\n\n  ContextMenu.prototype.enableAfterRenderMenu = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      if (this.contextMenu) {\n        this.contextMenu.destroy();\n        remove(this.element);\n        this.parent.element.classList.remove('e-noselect');\n      }\n\n      this.render();\n    }\n  };\n\n  ContextMenu.prototype.getMenuItems = function () {\n    var menuItems = [];\n    var exportItems = [];\n\n    for (var _i = 0, _a = this.parent.contextMenuItems; _i < _a.length; _i++) {\n      var item = _a[_i];\n\n      if (typeof item === 'string' && this.getDefaultItems().indexOf(item) !== -1) {\n        if (item.toLocaleLowerCase().indexOf('export') !== -1) {\n          exportItems.push(this.buildDefaultItems(item));\n        } else {\n          menuItems.push(this.buildDefaultItems(item));\n        }\n      } else if (typeof item !== 'string') {\n        menuItems.push(item);\n      }\n    }\n\n    if (exportItems.length > 0) {\n      var exportGroup = this.buildDefaultItems('export');\n      exportGroup.items = exportItems;\n      menuItems.push(exportGroup);\n    }\n\n    return menuItems;\n  };\n\n  ContextMenu.prototype.getLastPage = function () {\n    var totalpage = Math.floor(this.parent.pageSettings.totalRecordsCount / this.parent.pageSettings.pageSize);\n\n    if (this.parent.pageSettings.totalRecordsCount % this.parent.pageSettings.pageSize) {\n      totalpage += 1;\n    }\n\n    return totalpage;\n  };\n\n  ContextMenu.prototype.contextMenuOpen = function () {\n    this.isOpen = true;\n  };\n  /**\n   * @hidden\n   */\n\n\n  ContextMenu.prototype.contextMenuItemClick = function (args) {\n    var item = this.getKeyFromId(args.item.id);\n\n    switch (item) {\n      case 'AutoFitAll':\n        this.parent.autoFitColumns([]);\n        break;\n\n      case 'AutoFit':\n        this.parent.autoFitColumns(this.targetColumn.field);\n        break;\n\n      case 'Group':\n        this.parent.groupColumn(this.targetColumn.field);\n        break;\n\n      case 'Ungroup':\n        this.parent.ungroupColumn(this.targetColumn.field);\n        break;\n\n      case 'Edit':\n        if (this.parent.editModule) {\n          if (this.parent.editSettings.mode === 'Batch') {\n            if (this.row && this.cell && !isNaN(parseInt(this.cell.getAttribute('aria-colindex'), 10))) {\n              this.parent.editModule.editCell(parseInt(this.row.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(this.cell.getAttribute('aria-colindex'), 10)].field);\n            }\n          } else {\n            this.parent.editModule.endEdit();\n            this.parent.editModule.startEdit(this.row);\n          }\n        }\n\n        break;\n\n      case 'Delete':\n        if (this.parent.editModule) {\n          if (this.parent.editSettings.mode !== 'Batch') {\n            this.parent.editModule.endEdit();\n          }\n\n          if (this.parent.getSelectedRecords().length === 1) {\n            this.parent.editModule.deleteRow(this.row);\n          } else {\n            this.parent.deleteRecord();\n          }\n        }\n\n        break;\n\n      case 'Save':\n        if (this.parent.editModule) {\n          this.parent.editModule.endEdit();\n        }\n\n        break;\n\n      case 'Cancel':\n        if (this.parent.editModule) {\n          this.parent.editModule.closeEdit();\n        }\n\n        break;\n\n      case 'Copy':\n        this.parent.copy();\n        break;\n\n      case 'PdfExport':\n        this.parent.pdfExport();\n        break;\n\n      case 'ExcelExport':\n        this.parent.excelExport();\n        break;\n\n      case 'CsvExport':\n        this.parent.csvExport();\n        break;\n\n      case 'SortAscending':\n        this.isOpen = false;\n        this.parent.sortColumn(this.targetColumn.field, 'Ascending');\n        break;\n\n      case 'SortDescending':\n        this.isOpen = false;\n        this.parent.sortColumn(this.targetColumn.field, 'Descending');\n        break;\n\n      case 'FirstPage':\n        this.parent.goToPage(1);\n        break;\n\n      case 'PrevPage':\n        this.parent.goToPage(this.parent.pageSettings.currentPage - 1);\n        break;\n\n      case 'LastPage':\n        this.parent.goToPage(this.getLastPage());\n        break;\n\n      case 'NextPage':\n        this.parent.goToPage(this.parent.pageSettings.currentPage + 1);\n        break;\n    }\n\n    args.column = this.targetColumn;\n    args.rowInfo = this.targetRowdata;\n\n    if (isBlazor()) {\n      var contextMenuClickArgs = args.rowInfo.row ? {\n        element: args.element,\n        item: args.item,\n        event: args.event,\n        column: this.targetColumn,\n        rowInfo: {\n          rowData: this.targetRowdata.rowData,\n          rowIndex: this.targetRowdata.rowIndex,\n          cellIndex: this.targetRowdata.cellIndex\n        }\n      } : this.targetColumn ? {\n        element: args.element,\n        item: args.item,\n        event: args.event,\n        column: this.targetColumn\n      } : {\n        element: args.element,\n        item: args.item,\n        event: args.event\n      };\n      this.parent.trigger(events.contextMenuClick, contextMenuClickArgs);\n    } else {\n      this.parent.trigger(events.contextMenuClick, args);\n    }\n  };\n\n  ContextMenu.prototype.contextMenuOnClose = function (args) {\n    var parent = 'parentObj';\n\n    if (args.items.length > 0 && args.items[0][parent] instanceof Menu) {\n      this.updateItemStatus();\n    }\n  };\n\n  ContextMenu.prototype.getLocaleText = function (item) {\n    return this.l10n.getConstant(this.localeText[item]);\n  };\n\n  ContextMenu.prototype.updateItemStatus = function () {\n    this.contextMenu.showItems(this.hiddenItems);\n    this.contextMenu.enableItems(this.disableItems);\n    this.hiddenItems = [];\n    this.disableItems = [];\n    this.isOpen = false;\n  };\n\n  ContextMenu.prototype.contextMenuBeforeOpen = function (args) {\n    var changedRecords = 'changedRecords';\n    var addedRecords = 'addedRecords';\n    var deletedRecords = 'deletedRecords';\n    var closestGrid = closest(args.event.target, '.e-grid');\n\n    if (args.event && closestGrid && closestGrid !== this.parent.element) {\n      args.cancel = true;\n    } else if (args.event && (closest(args.event.target, '.' + menuClass.groupHeader) || closest(args.event.target, '.' + menuClass.touchPop) || closest(args.event.target, '.e-summarycell') || closest(args.event.target, '.e-groupcaption') || closest(args.event.target, '.e-filterbarcell'))) {\n      args.cancel = true;\n    } else {\n      this.targetColumn = this.getColumn(args.event);\n      this.targetRowdata = this.parent.getRowInfo(args.event.target);\n\n      if (isNullOrUndefined(args.parentItem) && this.targetColumn) {\n        if (this.targetRowdata.cell) {\n          this.selectRow(args.event, this.targetRowdata.cell.classList.contains('e-selectionbackground') && this.parent.selectionSettings.type === 'Multiple' ? false : true);\n        }\n      }\n\n      var hideSepItems = [];\n      var showSepItems = [];\n\n      for (var _i = 0, _a = args.items; _i < _a.length; _i++) {\n        var item = _a[_i];\n        var key = this.getKeyFromId(item.id);\n        var dItem = this.defaultItems[key];\n\n        if (this.getDefaultItems().indexOf(key) !== -1) {\n          if (this.ensureDisabledStatus(key)) {\n            this.disableItems.push(item.text);\n          }\n\n          if (args.event && (this.ensureTarget(args.event.target, menuClass.edit) || this.ensureTarget(args.event.target, menuClass.batchEdit))) {\n            if (key !== 'Save' && key !== 'Cancel') {\n              this.hiddenItems.push(item.text);\n            }\n          } else if (this.parent.editModule && this.parent.editSettings.mode === 'Batch' && (closest(args.event.target, '.e-gridform') || this.parent.editModule.getBatchChanges()[changedRecords].length || this.parent.editModule.getBatchChanges()[addedRecords].length || this.parent.editModule.getBatchChanges()[deletedRecords].length) && (key === 'Save' || key === 'Cancel')) {\n            continue;\n          } else if (isNullOrUndefined(args.parentItem) && args.event && !this.ensureTarget(args.event.target, dItem.target)) {\n            this.hiddenItems.push(item.text);\n          }\n        } else if (item.target && args.event && !this.ensureTarget(args.event.target, item.target)) {\n          if (item.separator) {\n            hideSepItems.push(item.id);\n          } else {\n            this.hiddenItems.push(item.text);\n          }\n        } else if (this.ensureTarget(args.event.target, item.target) && item.separator) {\n          showSepItems.push(item.id);\n        }\n      }\n\n      if (showSepItems.length > 0) {\n        this.contextMenu.showItems(showSepItems, true);\n      }\n\n      this.contextMenu.enableItems(this.disableItems, false);\n      this.contextMenu.hideItems(this.hiddenItems);\n\n      if (hideSepItems.length > 0) {\n        this.contextMenu.hideItems(hideSepItems, true);\n      }\n\n      this.eventArgs = args.event;\n      args.column = this.targetColumn;\n      args.rowInfo = this.targetRowdata;\n      this.parent.trigger(events.contextMenuOpen, args);\n\n      if (args.cancel || this.hiddenItems.length === args.items.length && !args.parentItem) {\n        this.updateItemStatus();\n        args.cancel = true;\n      }\n    }\n\n    applyBiggerTheme(this.parent.element, this.contextMenu.element.parentElement);\n  };\n\n  ContextMenu.prototype.ensureTarget = function (targetElement, selector) {\n    var target = targetElement;\n\n    if (this.ensureFrozenHeader(targetElement) && (selector === menuClass.header || selector === menuClass.content)) {\n      target = closest(targetElement, selector === menuClass.header ? 'thead' : 'tbody');\n    } else if (selector === menuClass.content || selector === menuClass.header) {\n      target = parentsUntil(closest(targetElement, '.e-table'), selector.substr(1, selector.length));\n    } else {\n      target = closest(targetElement, selector);\n    }\n\n    return target && parentsUntil(target, 'e-grid') === this.parent.element;\n  };\n\n  ContextMenu.prototype.ensureFrozenHeader = function (targetElement) {\n    return (this.parent.getFrozenColumns() || this.parent.frozenRows) && closest(targetElement, menuClass.header) ? true : false;\n  };\n\n  ContextMenu.prototype.ensureDisabledStatus = function (item) {\n    var status = false;\n\n    switch (item) {\n      case 'AutoFitAll':\n      case 'AutoFit':\n        status = !(this.parent.ensureModuleInjected(Resize) && !this.parent.isEdit) || this.targetColumn && !this.targetColumn.field && item === 'AutoFit';\n        break;\n\n      case 'Group':\n        if (!this.parent.allowGrouping || this.parent.ensureModuleInjected(Group) && this.targetColumn && this.parent.groupSettings.columns.indexOf(this.targetColumn.field) >= 0 || this.targetColumn && !this.targetColumn.field) {\n          status = true;\n        }\n\n        break;\n\n      case 'Ungroup':\n        if (!this.parent.allowGrouping || !this.parent.ensureModuleInjected(Group) || this.parent.ensureModuleInjected(Group) && this.targetColumn && this.parent.groupSettings.columns.indexOf(this.targetColumn.field) < 0) {\n          status = true;\n        }\n\n        break;\n\n      case 'Edit':\n      case 'Delete':\n      case 'Save':\n      case 'Cancel':\n        if (!this.parent.editModule || this.parent.getDataRows().length === 0) {\n          status = true;\n        }\n\n        break;\n\n      case 'Copy':\n        if (this.parent.getSelectedRowIndexes().length === 0 || this.parent.getCurrentViewRecords().length === 0) {\n          status = true;\n        }\n\n        break;\n\n      case 'export':\n        if (!this.parent.allowExcelExport || !this.parent.excelExport || !this.parent.ensureModuleInjected(PdfExport) && !this.parent.ensureModuleInjected(ExcelExport)) {\n          status = true;\n        }\n\n        break;\n\n      case 'PdfExport':\n        if (!this.parent.allowPdfExport || !this.parent.ensureModuleInjected(PdfExport)) {\n          status = true;\n        }\n\n        break;\n\n      case 'ExcelExport':\n      case 'CsvExport':\n        if (!this.parent.allowExcelExport || !this.parent.ensureModuleInjected(ExcelExport)) {\n          status = true;\n        }\n\n        break;\n\n      case 'SortAscending':\n      case 'SortDescending':\n        if (!this.parent.allowSorting || !this.parent.ensureModuleInjected(Sort) || this.targetColumn && !this.targetColumn.field) {\n          status = true;\n        } else if (this.parent.ensureModuleInjected(Sort) && this.parent.sortSettings.columns.length > 0 && this.targetColumn) {\n          var sortColumns = this.parent.sortSettings.columns;\n\n          for (var i = 0; i < sortColumns.length; i++) {\n            if (sortColumns[i].field === this.targetColumn.field && sortColumns[i].direction.toLowerCase() === item.toLowerCase().replace('sort', '').toLocaleLowerCase()) {\n              status = true;\n            }\n          }\n        }\n\n        break;\n\n      case 'FirstPage':\n      case 'PrevPage':\n        if (!this.parent.allowPaging || !this.parent.ensureModuleInjected(Page) || this.parent.getCurrentViewRecords().length === 0 || this.parent.ensureModuleInjected(Page) && this.parent.pageSettings.currentPage === 1) {\n          status = true;\n        }\n\n        break;\n\n      case 'LastPage':\n      case 'NextPage':\n        if (!this.parent.allowPaging || !this.parent.ensureModuleInjected(Page) || this.parent.getCurrentViewRecords().length === 0 || this.parent.ensureModuleInjected(Page) && this.parent.pageSettings.currentPage === this.getLastPage()) {\n          status = true;\n        }\n\n        break;\n    }\n\n    return status;\n  };\n  /**\n   * Gets the context menu element from the Grid.\n   * @return {Element}\n   */\n\n\n  ContextMenu.prototype.getContextMenu = function () {\n    return this.element;\n  };\n  /**\n   * Destroys the context menu component in the Grid.\n   * @method destroy\n   * @return {void}\n   * @hidden\n   */\n\n\n  ContextMenu.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    }\n\n    this.contextMenu.destroy();\n    remove(this.element);\n    this.removeEventListener();\n    this.parent.element.classList.remove('e-noselect');\n  };\n\n  ContextMenu.prototype.getModuleName = function () {\n    return 'contextMenu';\n  };\n\n  ContextMenu.prototype.generateID = function (item) {\n    return this.gridID + '_cmenu_' + item;\n  };\n\n  ContextMenu.prototype.getKeyFromId = function (id) {\n    return id.replace(this.gridID + '_cmenu_', '');\n  };\n\n  ContextMenu.prototype.buildDefaultItems = function (item) {\n    var menuItem;\n\n    switch (item) {\n      case 'AutoFitAll':\n      case 'AutoFit':\n        menuItem = {\n          target: menuClass.header\n        };\n        break;\n\n      case 'Group':\n        menuItem = {\n          target: menuClass.header,\n          iconCss: menuClass.group\n        };\n        break;\n\n      case 'Ungroup':\n        menuItem = {\n          target: menuClass.header,\n          iconCss: menuClass.ungroup\n        };\n        break;\n\n      case 'Edit':\n        menuItem = {\n          target: menuClass.content,\n          iconCss: menuClass.editIcon\n        };\n        break;\n\n      case 'Delete':\n        menuItem = {\n          target: menuClass.content,\n          iconCss: menuClass.delete\n        };\n        break;\n\n      case 'Save':\n        menuItem = {\n          target: menuClass.edit,\n          iconCss: menuClass.save\n        };\n        break;\n\n      case 'Cancel':\n        menuItem = {\n          target: menuClass.edit,\n          iconCss: menuClass.cancel\n        };\n        break;\n\n      case 'Copy':\n        menuItem = {\n          target: menuClass.content,\n          iconCss: menuClass.copy\n        };\n        break;\n\n      case 'export':\n        menuItem = {\n          target: menuClass.content\n        };\n        break;\n\n      case 'PdfExport':\n        menuItem = {\n          target: menuClass.content,\n          iconCss: menuClass.pdf\n        };\n        break;\n\n      case 'ExcelExport':\n        menuItem = {\n          target: menuClass.content,\n          iconCss: menuClass.excel\n        };\n        break;\n\n      case 'CsvExport':\n        menuItem = {\n          target: menuClass.content,\n          iconCss: menuClass.csv\n        };\n        break;\n\n      case 'SortAscending':\n        menuItem = {\n          target: menuClass.header,\n          iconCss: menuClass.ascending\n        };\n        break;\n\n      case 'SortDescending':\n        menuItem = {\n          target: menuClass.header,\n          iconCss: menuClass.descending\n        };\n        break;\n\n      case 'FirstPage':\n        menuItem = {\n          target: menuClass.pager,\n          iconCss: menuClass.fPage\n        };\n        break;\n\n      case 'PrevPage':\n        menuItem = {\n          target: menuClass.pager,\n          iconCss: menuClass.pPage\n        };\n        break;\n\n      case 'LastPage':\n        menuItem = {\n          target: menuClass.pager,\n          iconCss: menuClass.lPage\n        };\n        break;\n\n      case 'NextPage':\n        menuItem = {\n          target: menuClass.pager,\n          iconCss: menuClass.nPage\n        };\n        break;\n    }\n\n    this.defaultItems[item] = {\n      text: this.getLocaleText(item),\n      id: this.generateID(item),\n      target: menuItem.target,\n      iconCss: menuItem.iconCss ? 'e-icons ' + menuItem.iconCss : ''\n    };\n    return this.defaultItems[item];\n  };\n\n  ContextMenu.prototype.getDefaultItems = function () {\n    return ['AutoFitAll', 'AutoFit', 'Group', 'Ungroup', 'Edit', 'Delete', 'Save', 'Cancel', 'Copy', 'export', 'PdfExport', 'ExcelExport', 'CsvExport', 'SortAscending', 'SortDescending', 'FirstPage', 'PrevPage', 'LastPage', 'NextPage'];\n  };\n\n  ContextMenu.prototype.setLocaleKey = function () {\n    var localeKeys = {\n      'AutoFitAll': 'autoFitAll',\n      'AutoFit': 'autoFit',\n      'Copy': 'Copy',\n      'Group': 'Group',\n      'Ungroup': 'Ungroup',\n      'Edit': 'EditRecord',\n      'Delete': 'DeleteRecord',\n      'Save': 'Save',\n      'Cancel': 'CancelButton',\n      'PdfExport': 'Pdfexport',\n      'ExcelExport': 'Excelexport',\n      'CsvExport': 'Csvexport',\n      'export': 'Export',\n      'SortAscending': 'SortAscending',\n      'SortDescending': 'SortDescending',\n      'FirstPage': 'FirstPage',\n      'LastPage': 'LastPage',\n      'PrevPage': 'PreviousPage',\n      'NextPage': 'NextPage'\n    };\n\n    if (isBlazor()) {\n      var autoFitAll = 'AutoFitAll';\n      localeKeys[autoFitAll] = 'AutoFitAll';\n      var autoFit = 'AutoFit';\n      localeKeys[autoFit] = 'AutoFit';\n    }\n\n    return localeKeys;\n  };\n\n  ContextMenu.prototype.getColumn = function (e) {\n    var cell = closest(e.target, 'th.e-headercell');\n\n    if (cell) {\n      var uid = cell.querySelector('.e-headercelldiv, .e-stackedheadercelldiv').getAttribute('e-mappinguid');\n      return this.parent.getColumnByUid(uid);\n    } else {\n      var ele = this.parent.getRowInfo(e.target).column;\n      return ele || null;\n    }\n  };\n\n  ContextMenu.prototype.selectRow = function (e, isSelectable) {\n    this.cell = e.target;\n    this.row = closest(e.target, 'tr.e-row') || this.row;\n\n    if (this.row && isSelectable && !parentsUntil(e.target, 'e-gridpager')) {\n      this.parent.selectRow(parseInt(this.row.getAttribute('aria-rowindex'), 10));\n    }\n  };\n\n  return ContextMenu;\n}();\n\nexport { ContextMenu };","map":null,"metadata":{},"sourceType":"module"}