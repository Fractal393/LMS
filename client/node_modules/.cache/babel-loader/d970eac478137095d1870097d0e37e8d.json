{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.error_handling.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar ERROR_ROW_CLASS = \"dx-error-row\";\nvar ERROR_MESSAGE_CLASS = \"dx-error-message\";\nvar ERROR_CLOSEBUTTON_CLASS = \"dx-closebutton\";\nvar ACTION_CLASS = \"action\";\n\nvar ErrorHandlingController = _uiGrid_core2.default.ViewController.inherit({\n  init: function () {\n    var that = this;\n    that._columnHeadersView = that.getView(\"columnHeadersView\");\n    that._rowsView = that.getView(\"rowsView\");\n  },\n  _createErrorRow: function (error, $tableElements) {\n    var that = this;\n    var $errorRow;\n    var $closeButton;\n\n    var $errorMessage = this._renderErrorMessage(error);\n\n    if ($tableElements) {\n      $errorRow = (0, _renderer2.default)(\"<tr>\").addClass(ERROR_ROW_CLASS);\n      $closeButton = (0, _renderer2.default)(\"<div>\").addClass(ERROR_CLOSEBUTTON_CLASS).addClass(that.addWidgetPrefix(ACTION_CLASS));\n\n      _events_engine2.default.on($closeButton, _click2.default.name, that.createAction(function (args) {\n        var e = args.event;\n        var $errorRow;\n        var errorRowIndex = (0, _renderer2.default)(e.currentTarget).closest(\".\" + ERROR_ROW_CLASS).index();\n        e.stopPropagation();\n        (0, _iterator.each)($tableElements, function (_, tableElement) {\n          $errorRow = (0, _renderer2.default)(tableElement).children(\"tbody\").children(\"tr\").eq(errorRowIndex);\n          that.removeErrorRow($errorRow);\n        });\n        that.getController(\"resizing\") && that.getController(\"resizing\").fireContentReadyAction();\n      }));\n\n      (0, _renderer2.default)(\"<td>\").attr({\n        colSpan: that.getController(\"columns\").getVisibleColumns().length,\n        role: \"presentation\"\n      }).prepend($closeButton).append($errorMessage).appendTo($errorRow);\n      return $errorRow;\n    }\n\n    return $errorMessage;\n  },\n  _renderErrorMessage: function (error) {\n    var message = error.url ? error.message.replace(error.url, \"\") : error.message || error;\n    var $message = (0, _renderer2.default)(\"<div>\").addClass(ERROR_MESSAGE_CLASS).text(message);\n\n    if (error.url) {\n      (0, _renderer2.default)(\"<a>\").attr(\"href\", error.url).text(error.url).appendTo($message);\n    }\n\n    return $message;\n  },\n  renderErrorRow: function (error, rowIndex, $popupContent) {\n    var that = this;\n    var $errorMessageElement;\n    var $firstErrorRow;\n\n    if ($popupContent) {\n      $popupContent.find(\".\" + ERROR_MESSAGE_CLASS).remove();\n      $errorMessageElement = that._createErrorRow(error);\n      $popupContent.prepend($errorMessageElement);\n      return $errorMessageElement;\n    }\n\n    var viewElement = rowIndex >= 0 || !that._columnHeadersView.isVisible() ? that._rowsView : that._columnHeadersView;\n    var $tableElements = $popupContent || viewElement.getTableElements();\n    (0, _iterator.each)($tableElements, function (_, tableElement) {\n      $errorMessageElement = that._createErrorRow(error, $tableElements);\n      $firstErrorRow = $firstErrorRow || $errorMessageElement;\n\n      if (rowIndex >= 0) {\n        var $row = viewElement._getRowElements((0, _renderer2.default)(tableElement)).eq(rowIndex);\n\n        that.removeErrorRow($row.next());\n        $errorMessageElement.insertAfter($row);\n      } else {\n        var $tbody = (0, _renderer2.default)(tableElement).children(\"tbody\");\n        var rowElements = $tbody.children(\"tr\");\n\n        if (that._columnHeadersView.isVisible()) {\n          that.removeErrorRow(rowElements.last());\n          (0, _renderer2.default)(tableElement).append($errorMessageElement);\n        } else {\n          that.removeErrorRow(rowElements.first());\n          $tbody.first().prepend($errorMessageElement);\n        }\n      }\n    });\n\n    if (!$popupContent) {\n      var resizingController = that.getController(\"resizing\");\n      resizingController && resizingController.fireContentReadyAction();\n    }\n\n    return $firstErrorRow;\n  },\n  removeErrorRow: function ($row) {\n    if (!$row) {\n      var $columnHeaders = this._columnHeadersView && this._columnHeadersView.element();\n\n      $row = $columnHeaders && $columnHeaders.find(\".\" + ERROR_ROW_CLASS);\n\n      if (!$row || !$row.length) {\n        var $rowsViewElement = this._rowsView.element();\n\n        $row = $rowsViewElement && $rowsViewElement.find(\".\" + ERROR_ROW_CLASS);\n      }\n    }\n\n    $row && $row.hasClass(ERROR_ROW_CLASS) && $row.remove();\n  },\n  optionChanged: function (args) {\n    var that = this;\n\n    switch (args.name) {\n      case \"errorRowEnabled\":\n        args.handled = true;\n        break;\n\n      default:\n        that.callBase(args);\n    }\n  }\n});\n\nmodule.exports = {\n  defaultOptions: function () {\n    return {\n      errorRowEnabled: true\n    };\n  },\n  controllers: {\n    errorHandling: ErrorHandlingController\n  },\n  extenders: {\n    controllers: {\n      data: {\n        init: function () {\n          var that = this;\n          var errorHandlingController = that.getController(\"errorHandling\");\n          that.callBase();\n          that.dataErrorOccurred.add(function (error, $popupContent) {\n            if (that.option(\"errorRowEnabled\")) {\n              errorHandlingController.renderErrorRow(error, void 0, $popupContent);\n            }\n          });\n          that.changed.add(function (e) {\n            if (e && \"loadError\" === e.changeType) {\n              return;\n            }\n\n            var errorHandlingController = that.getController(\"errorHandling\");\n            var editingController = that.getController(\"editing\");\n\n            if (editingController && !editingController.hasChanges()) {\n              errorHandlingController && errorHandlingController.removeErrorRow();\n            }\n          });\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}