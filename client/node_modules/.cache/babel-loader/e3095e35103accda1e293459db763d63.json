{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.filter_row.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _utils = require(\"../../events/utils\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _uiGrid_core4 = _interopRequireDefault(_uiGrid_core3);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _editor = require(\"../editor/editor\");\n\nvar _editor2 = _interopRequireDefault(_editor);\n\nvar _overlay = require(\"../overlay\");\n\nvar _overlay2 = _interopRequireDefault(_overlay);\n\nvar _menu = require(\"../menu\");\n\nvar _menu2 = _interopRequireDefault(_menu);\n\nvar _accessibility = require(\"../shared/accessibility\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar OPERATION_ICONS = {\n  \"=\": \"filter-operation-equals\",\n  \"<>\": \"filter-operation-not-equals\",\n  \"<\": \"filter-operation-less\",\n  \"<=\": \"filter-operation-less-equal\",\n  \">\": \"filter-operation-greater\",\n  \">=\": \"filter-operation-greater-equal\",\n  \"default\": \"filter-operation-default\",\n  notcontains: \"filter-operation-not-contains\",\n  contains: \"filter-operation-contains\",\n  startswith: \"filter-operation-starts-with\",\n  endswith: \"filter-operation-ends-with\",\n  between: \"filter-operation-between\"\n};\nvar OPERATION_DESCRIPTORS = {\n  \"=\": \"equal\",\n  \"<>\": \"notEqual\",\n  \"<\": \"lessThan\",\n  \"<=\": \"lessThanOrEqual\",\n  \">\": \"greaterThan\",\n  \">=\": \"greaterThanOrEqual\",\n  startswith: \"startsWith\",\n  contains: \"contains\",\n  notcontains: \"notContains\",\n  endswith: \"endsWith\",\n  between: \"between\"\n};\nvar FILTERING_TIMEOUT = 700;\nvar CORRECT_FILTER_RANGE_OVERLAY_WIDTH = 1;\nvar FILTER_ROW_CLASS = \"filter-row\";\nvar FILTER_RANGE_OVERLAY_CLASS = \"filter-range-overlay\";\nvar FILTER_RANGE_START_CLASS = \"filter-range-start\";\nvar FILTER_RANGE_END_CLASS = \"filter-range-end\";\nvar MENU_CLASS = \"dx-menu\";\nvar EDITOR_WITH_MENU_CLASS = \"dx-editor-with-menu\";\nvar EDITOR_CONTAINER_CLASS = \"dx-editor-container\";\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\nvar FILTER_MENU = \"dx-filter-menu\";\nvar APPLY_BUTTON_CLASS = \"dx-apply-button\";\nvar HIGHLIGHT_OUTLINE_CLASS = \"dx-highlight-outline\";\nvar FOCUSED_CLASS = \"dx-focused\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar FILTER_RANGE_CONTENT_CLASS = \"dx-filter-range-content\";\nvar FILTER_MODIFIED_CLASS = \"dx-filter-modified\";\nvar EDITORS_INPUT_SELECTOR = \"input:not([type='hidden'])\";\nvar BETWEEN_OPERATION_DATA_TYPES = [\"date\", \"datetime\", \"number\"];\n\nfunction isOnClickApplyFilterMode(that) {\n  return \"onClick\" === that.option(\"filterRow.applyFilter\");\n}\n\nvar ColumnHeadersViewFilterRowExtender = function () {\n  var getEditorInstance = function ($editorContainer) {\n    var $editor = $editorContainer && $editorContainer.children();\n    var componentNames = $editor && $editor.data(\"dxComponents\");\n    var editor = componentNames && componentNames.length && $editor.data(componentNames[0]);\n\n    if (editor instanceof _editor2.default) {\n      return editor;\n    }\n  };\n\n  var getRangeTextByFilterValue = function (that, column) {\n    var result = \"\";\n    var rangeEnd = \"\";\n    var filterValue = getColumnFilterValue(that, column);\n\n    var formatOptions = _uiGrid_core4.default.getFormatOptionsByColumn(column, \"filterRow\");\n\n    if (Array.isArray(filterValue)) {\n      result = _uiGrid_core4.default.formatValue(filterValue[0], formatOptions);\n      rangeEnd = _uiGrid_core4.default.formatValue(filterValue[1], formatOptions);\n\n      if (\"\" !== rangeEnd) {\n        result += \" - \" + rangeEnd;\n      }\n    } else {\n      if ((0, _type.isDefined)(filterValue)) {\n        result = _uiGrid_core4.default.formatValue(filterValue, formatOptions);\n      }\n    }\n\n    return result;\n  };\n\n  function getColumnFilterValue(that, column) {\n    if (column) {\n      return isOnClickApplyFilterMode(that) && void 0 !== column.bufferedFilterValue ? column.bufferedFilterValue : column.filterValue;\n    }\n  }\n\n  var getColumnSelectedFilterOperation = function (that, column) {\n    if (column) {\n      return isOnClickApplyFilterMode(that) && void 0 !== column.bufferedSelectedFilterOperation ? column.bufferedSelectedFilterOperation : column.selectedFilterOperation;\n    }\n  };\n\n  var isValidFilterValue = function (filterValue, column) {\n    if (column && BETWEEN_OPERATION_DATA_TYPES.indexOf(column.dataType) >= 0 && Array.isArray(filterValue)) {\n      return false;\n    }\n\n    return void 0 !== filterValue;\n  };\n\n  var getFilterValue = function (that, columnIndex, $editorContainer) {\n    var column = that._columnsController.columnOption(columnIndex);\n\n    var filterValue = getColumnFilterValue(that, column);\n    var isFilterRange = $editorContainer.closest(\".\" + that.addWidgetPrefix(FILTER_RANGE_OVERLAY_CLASS)).length;\n    var isRangeStart = $editorContainer.hasClass(that.addWidgetPrefix(FILTER_RANGE_START_CLASS));\n\n    if (filterValue && Array.isArray(filterValue) && \"between\" === getColumnSelectedFilterOperation(that, column)) {\n      if (isRangeStart) {\n        return filterValue[0];\n      } else {\n        return filterValue[1];\n      }\n    }\n\n    return !isFilterRange && isValidFilterValue(filterValue, column) ? filterValue : null;\n  };\n\n  var normalizeFilterValue = function (that, filterValue, column, $editorContainer) {\n    if (\"between\" === getColumnSelectedFilterOperation(that, column)) {\n      var columnFilterValue = getColumnFilterValue(that, column);\n\n      if ($editorContainer.hasClass(that.addWidgetPrefix(FILTER_RANGE_START_CLASS))) {\n        return [filterValue, Array.isArray(columnFilterValue) ? columnFilterValue[1] : void 0];\n      } else {\n        return [Array.isArray(columnFilterValue) ? columnFilterValue[0] : columnFilterValue, filterValue];\n      }\n    }\n\n    return filterValue;\n  };\n\n  var updateFilterValue = function (that, options) {\n    var value = \"\" === options.value ? null : options.value;\n    var $editorContainer = options.container;\n\n    var column = that._columnsController.columnOption(options.column.index);\n\n    var filterValue = getFilterValue(that, column.index, $editorContainer);\n\n    if (!(0, _type.isDefined)(filterValue) && !(0, _type.isDefined)(value)) {\n      return;\n    }\n\n    that._applyFilterViewController.setHighLight($editorContainer, filterValue !== value);\n\n    that._columnsController.columnOption(column.index, isOnClickApplyFilterMode(that) ? \"bufferedFilterValue\" : \"filterValue\", normalizeFilterValue(that, value, column, $editorContainer), options.notFireEvent);\n  };\n\n  return {\n    _updateEditorValue: function (column, $editorContainer) {\n      var that = this;\n      var editor = getEditorInstance($editorContainer);\n      editor && editor.option(\"value\", getFilterValue(that, column.index, $editorContainer));\n    },\n    _columnOptionChanged: function (e) {\n      var that = this;\n      var optionNames = e.optionNames;\n      var $cell;\n      var $editorContainer;\n      var $editorRangeElements;\n      var $menu;\n\n      if (_uiGrid_core4.default.checkChanges(optionNames, [\"filterValue\", \"bufferedFilterValue\", \"selectedFilterOperation\", \"bufferedSelectedFilterOperation\"]) && void 0 !== e.columnIndex) {\n        var visibleIndex = that._columnsController.getVisibleIndex(e.columnIndex);\n\n        var column = that._columnsController.columnOption(e.columnIndex);\n\n        $cell = that._getCellElement(that.element().find(\".\" + that.addWidgetPrefix(FILTER_ROW_CLASS)).index(), visibleIndex) || (0, _renderer2.default)();\n        $editorContainer = $cell.find(\".\" + EDITOR_CONTAINER_CLASS).first();\n\n        if (optionNames.filterValue || optionNames.bufferedFilterValue) {\n          that._updateEditorValue(column, $editorContainer);\n\n          var overlayInstance = $cell.find(\".\" + that.addWidgetPrefix(FILTER_RANGE_OVERLAY_CLASS)).data(\"dxOverlay\");\n\n          if (overlayInstance) {\n            $editorRangeElements = overlayInstance.$content().find(\".\" + EDITOR_CONTAINER_CLASS);\n\n            that._updateEditorValue(column, $editorRangeElements.first());\n\n            that._updateEditorValue(column, $editorRangeElements.last());\n          }\n\n          if (!overlayInstance || !overlayInstance.option(\"visible\")) {\n            that._updateFilterRangeContent($cell, getRangeTextByFilterValue(that, column));\n          }\n        }\n\n        if (optionNames.selectedFilterOperation || optionNames.bufferedSelectedFilterOperation) {\n          if (visibleIndex >= 0 && column) {\n            $menu = $cell.find(\".\" + MENU_CLASS);\n\n            if ($menu.length) {\n              that._updateFilterOperationChooser($menu, column, $editorContainer);\n\n              if (\"between\" === getColumnSelectedFilterOperation(that, column)) {\n                that._renderFilterRangeContent($cell, column);\n              } else {\n                if ($editorContainer.find(\".\" + FILTER_RANGE_CONTENT_CLASS).length) {\n                  that._renderEditor($editorContainer, that._getEditorOptions($editorContainer, column));\n\n                  that._hideFilterRange();\n                }\n              }\n            }\n          }\n        }\n\n        return;\n      }\n\n      that.callBase(e);\n    },\n    _renderCore: function () {\n      this._filterRangeOverlayInstance = null;\n      this.callBase.apply(this, arguments);\n    },\n    _resizeCore: function () {\n      this.callBase.apply(this, arguments);\n      this._filterRangeOverlayInstance && this._filterRangeOverlayInstance.repaint();\n    },\n    isFilterRowVisible: function () {\n      return this._isElementVisible(this.option(\"filterRow\"));\n    },\n    isVisible: function () {\n      return this.callBase() || this.isFilterRowVisible();\n    },\n    init: function () {\n      this.callBase();\n      this._applyFilterViewController = this.getController(\"applyFilter\");\n    },\n    _initFilterRangeOverlay: function ($cell, column) {\n      var that = this;\n      var sharedData = {};\n      var $editorContainer = $cell.find(\".dx-editor-container\");\n      var $overlay = (0, _renderer2.default)(\"<div>\").addClass(that.addWidgetPrefix(FILTER_RANGE_OVERLAY_CLASS)).appendTo($cell);\n      return that._createComponent($overlay, _overlay2.default, {\n        height: \"auto\",\n        shading: false,\n        showTitle: false,\n        focusStateEnabled: false,\n        closeOnTargetScroll: false,\n        closeOnOutsideClick: true,\n        animation: false,\n        position: {\n          my: \"top\",\n          at: \"top\",\n          of: $editorContainer.length && $editorContainer || $cell,\n          offset: \"0 -1\"\n        },\n        contentTemplate: function (contentElement) {\n          var editorOptions;\n          var $editor = (0, _renderer2.default)(\"<div>\").addClass(EDITOR_CONTAINER_CLASS + \" \" + that.addWidgetPrefix(FILTER_RANGE_START_CLASS)).appendTo(contentElement);\n          column = that._columnsController.columnOption(column.index);\n          editorOptions = that._getEditorOptions($editor, column);\n          editorOptions.sharedData = sharedData;\n\n          that._renderEditor($editor, editorOptions);\n\n          _events_engine2.default.on($editor.find(EDITORS_INPUT_SELECTOR), \"keydown\", function (e) {\n            var $prevElement = $cell.find(\"[tabindex]\").not(e.target).first();\n\n            if (\"tab\" === (0, _utils.normalizeKeyName)(e) && e.shiftKey) {\n              e.preventDefault();\n\n              that._hideFilterRange();\n\n              if (!$prevElement.length) {\n                $prevElement = $cell.prev().find(\"[tabindex]\").last();\n              }\n\n              _events_engine2.default.trigger($prevElement, \"focus\");\n            }\n          });\n\n          $editor = (0, _renderer2.default)(\"<div>\").addClass(EDITOR_CONTAINER_CLASS + \" \" + that.addWidgetPrefix(FILTER_RANGE_END_CLASS)).appendTo(contentElement);\n          editorOptions = that._getEditorOptions($editor, column);\n          editorOptions.sharedData = sharedData;\n\n          that._renderEditor($editor, editorOptions);\n\n          _events_engine2.default.on($editor.find(EDITORS_INPUT_SELECTOR), \"keydown\", function (e) {\n            if (\"tab\" === (0, _utils.normalizeKeyName)(e) && !e.shiftKey) {\n              e.preventDefault();\n\n              that._hideFilterRange();\n\n              _events_engine2.default.trigger($cell.next().find(\"[tabindex]\").first(), \"focus\");\n            }\n          });\n\n          return (0, _renderer2.default)(contentElement).addClass(that.getWidgetContainerClass());\n        },\n        onShown: function (e) {\n          var $editor = e.component.$content().find(\".\" + EDITOR_CONTAINER_CLASS).first();\n\n          _events_engine2.default.trigger($editor.find(EDITORS_INPUT_SELECTOR), \"focus\");\n        },\n        onHidden: function () {\n          column = that._columnsController.columnOption(column.index);\n          $cell.find(\".\" + MENU_CLASS).parent().addClass(EDITOR_WITH_MENU_CLASS);\n\n          if (\"between\" === getColumnSelectedFilterOperation(that, column)) {\n            that._updateFilterRangeContent($cell, getRangeTextByFilterValue(that, column));\n\n            that.component.updateDimensions();\n          }\n        }\n      });\n    },\n    _updateFilterRangeOverlay: function (options) {\n      var overlayInstance = this._filterRangeOverlayInstance;\n      overlayInstance && overlayInstance.option(options);\n    },\n    _showFilterRange: function ($cell, column) {\n      var that = this;\n      var $overlay = $cell.children(\".\" + that.addWidgetPrefix(FILTER_RANGE_OVERLAY_CLASS));\n      var overlayInstance = $overlay.length && $overlay.data(\"dxOverlay\");\n\n      if (!overlayInstance && column) {\n        overlayInstance = that._initFilterRangeOverlay($cell, column);\n      }\n\n      if (!overlayInstance.option(\"visible\")) {\n        that._filterRangeOverlayInstance && that._filterRangeOverlayInstance.hide();\n        that._filterRangeOverlayInstance = overlayInstance;\n\n        that._updateFilterRangeOverlay({\n          width: $cell.outerWidth(true) + CORRECT_FILTER_RANGE_OVERLAY_WIDTH\n        });\n\n        that._filterRangeOverlayInstance && that._filterRangeOverlayInstance.show();\n      }\n    },\n    _hideFilterRange: function () {\n      var overlayInstance = this._filterRangeOverlayInstance;\n      overlayInstance && overlayInstance.hide();\n    },\n    getFilterRangeOverlayInstance: function () {\n      return this._filterRangeOverlayInstance;\n    },\n    _createRow: function (row) {\n      var _this = this;\n\n      var $row = this.callBase(row);\n\n      if (\"filter\" === row.rowType) {\n        $row.addClass(this.addWidgetPrefix(FILTER_ROW_CLASS));\n\n        if (!this.option(\"useLegacyKeyboardNavigation\")) {\n          _events_engine2.default.on($row, \"keydown\", function (event) {\n            return (0, _accessibility.selectView)(\"filterRow\", _this, event);\n          });\n        }\n      }\n\n      return $row;\n    },\n    _getRows: function () {\n      var result = this.callBase();\n\n      if (this.isFilterRowVisible()) {\n        result.push({\n          rowType: \"filter\"\n        });\n      }\n\n      return result;\n    },\n    _renderFilterCell: function (cell, options) {\n      var that = this;\n      var column = options.column;\n      var $cell = (0, _renderer2.default)(cell);\n\n      if (that.component.option(\"showColumnHeaders\")) {\n        that.setAria(\"describedby\", column.headerId, $cell);\n      }\n\n      that.setAria(\"label\", _message2.default.format(\"dxDataGrid-ariaFilterCell\"), $cell);\n      $cell.addClass(EDITOR_CELL_CLASS);\n      var $container = (0, _renderer2.default)(\"<div>\").appendTo($cell);\n      var $editorContainer = (0, _renderer2.default)(\"<div>\").addClass(EDITOR_CONTAINER_CLASS).appendTo($container);\n\n      if (\"between\" === getColumnSelectedFilterOperation(that, column)) {\n        that._renderFilterRangeContent($cell, column);\n      } else {\n        var editorOptions = that._getEditorOptions($editorContainer, column);\n\n        that._renderEditor($editorContainer, editorOptions);\n      }\n\n      if (column.alignment) {\n        $cell.find(EDITORS_INPUT_SELECTOR).first().css(\"textAlign\", column.alignment);\n      }\n\n      if (column.filterOperations && column.filterOperations.length) {\n        that._renderFilterOperationChooser($container, column, $editorContainer);\n      }\n    },\n    _renderCellContent: function ($cell, options) {\n      var that = this;\n      var column = options.column;\n\n      if (\"filter\" === options.rowType) {\n        if (column.command) {\n          $cell.html(\"&nbsp;\");\n        } else {\n          if (column.allowFiltering) {\n            that.renderTemplate($cell, that._renderFilterCell.bind(that), options).done(function () {\n              that._updateCell($cell, options);\n            });\n            return;\n          }\n        }\n      }\n\n      that.callBase($cell, options);\n    },\n    _getEditorOptions: function ($editorContainer, column) {\n      var that = this;\n      var accessibilityOptions = {\n        editorOptions: {\n          inputAttr: that._getFilterInputAccessibilityAttributes(column)\n        }\n      };\n      var result = (0, _extend.extend)(accessibilityOptions, column, {\n        value: getFilterValue(that, column.index, $editorContainer),\n        parentType: \"filterRow\",\n        showAllText: that.option(\"filterRow.showAllText\"),\n        updateValueTimeout: \"onClick\" === that.option(\"filterRow.applyFilter\") ? 0 : FILTERING_TIMEOUT,\n        width: null,\n        setValue: function (value, notFireEvent) {\n          updateFilterValue(that, {\n            column: column,\n            value: value,\n            container: $editorContainer,\n            notFireEvent: notFireEvent\n          });\n        }\n      });\n\n      if (\"between\" === getColumnSelectedFilterOperation(that, column)) {\n        if ($editorContainer.hasClass(that.addWidgetPrefix(FILTER_RANGE_START_CLASS))) {\n          result.placeholder = that.option(\"filterRow.betweenStartText\");\n        } else {\n          result.placeholder = that.option(\"filterRow.betweenEndText\");\n        }\n      }\n\n      return result;\n    },\n    _getFilterInputAccessibilityAttributes: function (column) {\n      var columnAriaLabel = _message2.default.format(\"dxDataGrid-ariaFilterCell\");\n\n      if (this.component.option(\"showColumnHeaders\")) {\n        return {\n          \"aria-label\": columnAriaLabel,\n          \"aria-describedby\": column.headerId\n        };\n      }\n\n      return {\n        \"aria-label\": columnAriaLabel\n      };\n    },\n    _renderEditor: function ($editorContainer, options) {\n      $editorContainer.empty();\n      return this.getController(\"editorFactory\").createEditor((0, _renderer2.default)(\"<div>\").appendTo($editorContainer), options);\n    },\n    _renderFilterRangeContent: function ($cell, column) {\n      var that = this;\n      var $editorContainer = $cell.find(\".\" + EDITOR_CONTAINER_CLASS).first();\n      $editorContainer.empty();\n      var $filterRangeContent = (0, _renderer2.default)(\"<div>\").addClass(FILTER_RANGE_CONTENT_CLASS).attr(\"tabindex\", this.option(\"tabIndex\"));\n\n      _events_engine2.default.on($filterRangeContent, \"focusin\", function () {\n        that._showFilterRange($cell, column);\n      });\n\n      $filterRangeContent.appendTo($editorContainer);\n\n      that._updateFilterRangeContent($cell, getRangeTextByFilterValue(that, column));\n    },\n    _updateFilterRangeContent: function ($cell, value) {\n      var $filterRangeContent = $cell.find(\".\" + FILTER_RANGE_CONTENT_CLASS);\n\n      if ($filterRangeContent.length) {\n        if (\"\" === value) {\n          $filterRangeContent.html(\"&nbsp;\");\n        } else {\n          $filterRangeContent.text(value);\n        }\n      }\n    },\n    _updateFilterOperationChooser: function ($menu, column, $editorContainer) {\n      var that = this;\n      var isCellWasFocused;\n\n      var restoreFocus = function () {\n        var menu = _menu2.default.getInstance($menu);\n\n        menu && menu.option(\"focusedElement\", null);\n        isCellWasFocused && that._focusEditor($editorContainer);\n      };\n\n      that._createComponent($menu, _menu2.default, {\n        integrationOptions: {},\n        activeStateEnabled: false,\n        selectionMode: \"single\",\n        cssClass: that.getWidgetContainerClass() + \" \" + CELL_FOCUS_DISABLED_CLASS + \" \" + FILTER_MENU,\n        showFirstSubmenuMode: \"onHover\",\n        hideSubmenuOnMouseLeave: true,\n        items: [{\n          disabled: column.filterOperations && column.filterOperations.length ? false : true,\n          icon: OPERATION_ICONS[getColumnSelectedFilterOperation(that, column) || \"default\"],\n          selectable: false,\n          items: that._getFilterOperationMenuItems(column)\n        }],\n        onItemClick: function (properties) {\n          var selectedFilterOperation = properties.itemData.name;\n          var columnSelectedFilterOperation = getColumnSelectedFilterOperation(that, column);\n          var notFocusEditor = false;\n          var isOnClickMode = isOnClickApplyFilterMode(that);\n          var options = {};\n\n          if (properties.itemData.items || selectedFilterOperation && selectedFilterOperation === columnSelectedFilterOperation) {\n            return;\n          }\n\n          if (selectedFilterOperation) {\n            options[isOnClickMode ? \"bufferedSelectedFilterOperation\" : \"selectedFilterOperation\"] = selectedFilterOperation;\n\n            if (\"between\" === selectedFilterOperation || \"between\" === columnSelectedFilterOperation) {\n              notFocusEditor = \"between\" === selectedFilterOperation;\n              options[isOnClickMode ? \"bufferedFilterValue\" : \"filterValue\"] = null;\n            }\n          } else {\n            options[isOnClickMode ? \"bufferedFilterValue\" : \"filterValue\"] = null;\n            options[isOnClickMode ? \"bufferedSelectedFilterOperation\" : \"selectedFilterOperation\"] = column.defaultSelectedFilterOperation || null;\n          }\n\n          that._columnsController.columnOption(column.index, options);\n\n          that._applyFilterViewController.setHighLight($editorContainer, true);\n\n          if (!selectedFilterOperation) {\n            var editor = getEditorInstance($editorContainer);\n\n            if (editor && \"dxDateBox\" === editor.NAME && !editor.option(\"isValid\")) {\n              editor.reset();\n              editor.option(\"isValid\", true);\n            }\n          }\n\n          if (!notFocusEditor) {\n            that._focusEditor($editorContainer);\n          } else {\n            that._showFilterRange($editorContainer.closest(\".\" + EDITOR_CELL_CLASS), column);\n          }\n        },\n        onSubmenuShown: function () {\n          isCellWasFocused = that._isEditorFocused($editorContainer);\n          that.getController(\"editorFactory\").loseFocus();\n        },\n        onSubmenuHiding: function () {\n          _events_engine2.default.trigger($menu, \"blur\");\n\n          restoreFocus();\n        },\n        onContentReady: function (e) {\n          _events_engine2.default.on($menu, \"blur\", function () {\n            var menu = e.component;\n\n            menu._hideSubmenu(menu._visibleSubmenu);\n\n            restoreFocus();\n          });\n        },\n        rtlEnabled: that.option(\"rtlEnabled\")\n      });\n    },\n    _isEditorFocused: function ($container) {\n      return $container.hasClass(FOCUSED_CLASS) || $container.parents(\".\" + FOCUSED_CLASS).length;\n    },\n    _focusEditor: function ($container) {\n      this.getController(\"editorFactory\").focus($container);\n\n      _events_engine2.default.trigger($container.find(EDITORS_INPUT_SELECTOR), \"focus\");\n    },\n    _renderFilterOperationChooser: function ($container, column, $editorContainer) {\n      var that = this;\n      var $menu;\n\n      if (that.option(\"filterRow.showOperationChooser\")) {\n        $container.addClass(EDITOR_WITH_MENU_CLASS);\n        $menu = (0, _renderer2.default)(\"<div>\").prependTo($container);\n\n        that._updateFilterOperationChooser($menu, column, $editorContainer);\n      }\n    },\n    _getFilterOperationMenuItems: function (column) {\n      var that = this;\n      var result = [{}];\n      var filterRowOptions = that.option(\"filterRow\");\n      var operationDescriptions = filterRowOptions && filterRowOptions.operationDescriptions || {};\n\n      if (column.filterOperations && column.filterOperations.length) {\n        var availableFilterOperations = column.filterOperations.filter(function (value) {\n          return (0, _type.isDefined)(OPERATION_DESCRIPTORS[value]);\n        });\n        result = _iterator2.default.map(availableFilterOperations, function (value) {\n          var descriptionName = OPERATION_DESCRIPTORS[value];\n          return {\n            name: value,\n            selected: (getColumnSelectedFilterOperation(that, column) || column.defaultFilterOperation) === value,\n            text: operationDescriptions[descriptionName],\n            icon: OPERATION_ICONS[value]\n          };\n        });\n        result.push({\n          name: null,\n          text: filterRowOptions && filterRowOptions.resetOperationText,\n          icon: OPERATION_ICONS.default\n        });\n      }\n\n      return result;\n    },\n    optionChanged: function (args) {\n      var that = this;\n\n      switch (args.name) {\n        case \"filterRow\":\n        case \"showColumnLines\":\n          this._invalidate(true, true);\n\n          args.handled = true;\n          break;\n\n        default:\n          that.callBase(args);\n      }\n    }\n  };\n}();\n\nvar DataControllerFilterRowExtender = {\n  skipCalculateColumnFilters: function () {\n    return false;\n  },\n  _calculateAdditionalFilter: function () {\n    if (this.skipCalculateColumnFilters()) {\n      return this.callBase();\n    }\n\n    var filters = [this.callBase()];\n\n    var columns = this._columnsController.getVisibleColumns(null, true);\n\n    _iterator2.default.each(columns, function () {\n      if (this.allowFiltering && this.calculateFilterExpression && (0, _type.isDefined)(this.filterValue)) {\n        var filter = this.createFilterExpression(this.filterValue, this.selectedFilterOperation || this.defaultFilterOperation, \"filterRow\");\n        filters.push(filter);\n      }\n    });\n\n    return _uiGrid_core4.default.combineFilters(filters);\n  }\n};\nexports.ApplyFilterViewController = _uiGrid_core2.default.ViewController.inherit({\n  _getHeaderPanel: function () {\n    if (!this._headerPanel) {\n      this._headerPanel = this.getView(\"headerPanel\");\n    }\n\n    return this._headerPanel;\n  },\n  setHighLight: function ($element, value) {\n    if (isOnClickApplyFilterMode(this)) {\n      $element && $element.toggleClass(HIGHLIGHT_OUTLINE_CLASS, value) && $element.closest(\".\" + EDITOR_CELL_CLASS).toggleClass(FILTER_MODIFIED_CLASS, value);\n\n      this._getHeaderPanel().enableApplyButton(value);\n    }\n  },\n  applyFilter: function () {\n    var columnsController = this.getController(\"columns\");\n    var columns = columnsController.getColumns();\n    columnsController.beginUpdate();\n\n    for (var i = 0; i < columns.length; i++) {\n      var column = columns[i];\n\n      if (void 0 !== column.bufferedFilterValue) {\n        columnsController.columnOption(i, \"filterValue\", column.bufferedFilterValue);\n        column.bufferedFilterValue = void 0;\n      }\n\n      if (void 0 !== column.bufferedSelectedFilterOperation) {\n        columnsController.columnOption(i, \"selectedFilterOperation\", column.bufferedSelectedFilterOperation);\n        column.bufferedSelectedFilterOperation = void 0;\n      }\n    }\n\n    columnsController.endUpdate();\n    this.removeHighLights();\n  },\n  removeHighLights: function () {\n    if (isOnClickApplyFilterMode(this)) {\n      var columnHeadersViewElement = this.getView(\"columnHeadersView\").element();\n      columnHeadersViewElement.find(\".\" + this.addWidgetPrefix(FILTER_ROW_CLASS) + \" .\" + HIGHLIGHT_OUTLINE_CLASS).removeClass(HIGHLIGHT_OUTLINE_CLASS);\n      columnHeadersViewElement.find(\".\" + this.addWidgetPrefix(FILTER_ROW_CLASS) + \" .\" + FILTER_MODIFIED_CLASS).removeClass(FILTER_MODIFIED_CLASS);\n\n      this._getHeaderPanel().enableApplyButton(false);\n    }\n  }\n});\nmodule.exports = {\n  defaultOptions: function () {\n    return {\n      filterRow: {\n        visible: false,\n        showOperationChooser: true,\n        showAllText: _message2.default.format(\"dxDataGrid-filterRowShowAllText\"),\n        resetOperationText: _message2.default.format(\"dxDataGrid-filterRowResetOperationText\"),\n        applyFilter: \"auto\",\n        applyFilterText: _message2.default.format(\"dxDataGrid-applyFilterText\"),\n        operationDescriptions: {\n          equal: _message2.default.format(\"dxDataGrid-filterRowOperationEquals\"),\n          notEqual: _message2.default.format(\"dxDataGrid-filterRowOperationNotEquals\"),\n          lessThan: _message2.default.format(\"dxDataGrid-filterRowOperationLess\"),\n          lessThanOrEqual: _message2.default.format(\"dxDataGrid-filterRowOperationLessOrEquals\"),\n          greaterThan: _message2.default.format(\"dxDataGrid-filterRowOperationGreater\"),\n          greaterThanOrEqual: _message2.default.format(\"dxDataGrid-filterRowOperationGreaterOrEquals\"),\n          startsWith: _message2.default.format(\"dxDataGrid-filterRowOperationStartsWith\"),\n          contains: _message2.default.format(\"dxDataGrid-filterRowOperationContains\"),\n          notContains: _message2.default.format(\"dxDataGrid-filterRowOperationNotContains\"),\n          endsWith: _message2.default.format(\"dxDataGrid-filterRowOperationEndsWith\"),\n          between: _message2.default.format(\"dxDataGrid-filterRowOperationBetween\"),\n          isBlank: _message2.default.format(\"dxFilterBuilder-filterOperationIsBlank\"),\n          isNotBlank: _message2.default.format(\"dxFilterBuilder-filterOperationIsNotBlank\")\n        },\n        betweenStartText: _message2.default.format(\"dxDataGrid-filterRowOperationBetweenStartText\"),\n        betweenEndText: _message2.default.format(\"dxDataGrid-filterRowOperationBetweenEndText\")\n      }\n    };\n  },\n  controllers: {\n    applyFilter: exports.ApplyFilterViewController\n  },\n  extenders: {\n    controllers: {\n      data: DataControllerFilterRowExtender,\n      columnsResizer: {\n        _startResizing: function () {\n          var that = this;\n          that.callBase.apply(that, arguments);\n\n          if (that.isResizing()) {\n            var overlayInstance = that._columnHeadersView.getFilterRangeOverlayInstance();\n\n            if (overlayInstance) {\n              var cellIndex = overlayInstance.$element().closest(\"td\").index();\n\n              if (cellIndex === that._targetPoint.columnIndex || cellIndex === that._targetPoint.columnIndex + 1) {\n                overlayInstance.$content().hide();\n              }\n            }\n          }\n        },\n        _endResizing: function () {\n          var that = this;\n          var $cell;\n\n          if (that.isResizing()) {\n            var overlayInstance = that._columnHeadersView.getFilterRangeOverlayInstance();\n\n            if (overlayInstance) {\n              $cell = overlayInstance.$element().closest(\"td\");\n\n              that._columnHeadersView._updateFilterRangeOverlay({\n                width: $cell.outerWidth(true) + CORRECT_FILTER_RANGE_OVERLAY_WIDTH\n              });\n\n              overlayInstance.$content().show();\n            }\n          }\n\n          that.callBase.apply(that, arguments);\n        }\n      }\n    },\n    views: {\n      columnHeadersView: ColumnHeadersViewFilterRowExtender,\n      headerPanel: {\n        _getToolbarItems: function () {\n          var items = this.callBase();\n\n          var filterItem = this._prepareFilterItem(items);\n\n          return filterItem.concat(items);\n        },\n        _prepareFilterItem: function () {\n          var that = this;\n          var filterItem = [];\n\n          if (that._isShowApplyFilterButton()) {\n            var hintText = that.option(\"filterRow.applyFilterText\");\n\n            var columns = that._columnsController.getColumns();\n\n            var disabled = !columns.filter(function (column) {\n              return void 0 !== column.bufferedFilterValue;\n            }).length;\n\n            var onInitialized = function (e) {\n              (0, _renderer2.default)(e.element).addClass(that._getToolbarButtonClass(APPLY_BUTTON_CLASS));\n            };\n\n            var onClickHandler = function () {\n              that._applyFilterViewController.applyFilter();\n            };\n\n            var toolbarItem = {\n              widget: \"dxButton\",\n              options: {\n                icon: \"apply-filter\",\n                disabled: disabled,\n                onClick: onClickHandler,\n                hint: hintText,\n                text: hintText,\n                onInitialized: onInitialized\n              },\n              showText: \"inMenu\",\n              name: \"applyFilterButton\",\n              location: \"after\",\n              locateInMenu: \"auto\",\n              sortIndex: 10\n            };\n            filterItem.push(toolbarItem);\n          }\n\n          return filterItem;\n        },\n        _isShowApplyFilterButton: function () {\n          var filterRowOptions = this.option(\"filterRow\");\n          return filterRowOptions && filterRowOptions.visible && \"onClick\" === filterRowOptions.applyFilter;\n        },\n        init: function () {\n          this.callBase();\n          this._dataController = this.getController(\"data\");\n          this._applyFilterViewController = this.getController(\"applyFilter\");\n        },\n        enableApplyButton: function (value) {\n          this.setToolbarItemDisabled(\"applyFilterButton\", !value);\n        },\n        isVisible: function () {\n          return this.callBase() || this._isShowApplyFilterButton();\n        },\n        optionChanged: function (args) {\n          if (\"filterRow\" === args.name) {\n            this._invalidate();\n\n            args.handled = true;\n          } else {\n            this.callBase(args);\n          }\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}