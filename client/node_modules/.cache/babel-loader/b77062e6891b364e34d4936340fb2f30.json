{"ast":null,"code":"import { remove, isBlazor, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { uiUpdate, initialEnd, dataReady, modelChanged, refreshAggregates, refreshFooterRenderer, groupAggregates } from '../base/constant';\nimport { FooterRenderer } from '../renderer/footer-renderer';\nimport { SummaryCellRenderer } from '../renderer/summary-cell-renderer';\nimport { GroupSummaryModelGenerator, CaptionSummaryModelGenerator } from '../services/summary-model-generator';\n/**\n * Summary Action controller.\n */\n\nvar Aggregate =\n/** @class */\nfunction () {\n  function Aggregate(parent, locator) {\n    this.parent = parent;\n    this.locator = locator;\n    this.addEventListener();\n  }\n\n  Aggregate.prototype.getModuleName = function () {\n    return 'aggregate';\n  };\n\n  Aggregate.prototype.initiateRender = function () {\n    var _this = this;\n\n    var cellFac = this.locator.getService('cellRendererFactory');\n    var instance = new SummaryCellRenderer(this.parent, this.locator);\n    var type = [CellType.Summary, CellType.CaptionSummary, CellType.GroupSummary];\n\n    for (var i = 0; i < type.length; i++) {\n      cellFac.addCellRenderer(type[i], instance);\n    }\n\n    this.footerRenderer = new FooterRenderer(this.parent, this.locator);\n    this.footerRenderer.renderPanel();\n    this.footerRenderer.renderTable();\n    var footerContent = this.footerRenderer.getPanel();\n\n    if (this.parent.element.scrollHeight > this.parent.element.querySelector('.e-content').scrollHeight && footerContent) {\n      addClass([footerContent], ['e-footerpadding']);\n    }\n\n    this.locator.register('footerRenderer', this.footerRenderer);\n\n    var fn = function () {\n      _this.prepareSummaryInfo();\n\n      _this.parent.off(dataReady, fn);\n    };\n\n    this.parent.on(dataReady, fn, this);\n    this.parent.on(dataReady, this.footerRenderer.refresh, this.footerRenderer);\n  };\n  /**\n   * @hidden\n   */\n\n\n  Aggregate.prototype.prepareSummaryInfo = function () {\n    var _this = this;\n\n    summaryIterator(this.parent.aggregates, function (column) {\n      var dataColumn = _this.parent.getColumnByField(column.field) || {};\n      var type = dataColumn.type;\n      var cFormat = 'customFormat';\n\n      if (!isNullOrUndefined(column[cFormat])) {\n        column.setPropertiesSilent({\n          format: column[cFormat]\n        });\n      }\n\n      if (typeof column.format === 'object') {\n        var valueFormatter = new ValueFormatter();\n        column.setFormatter(valueFormatter.getFormatFunction(extend({}, column.format)));\n      } else if (typeof column.format === 'string') {\n        var fmtr = _this.locator.getService('valueFormatter');\n\n        column.setFormatter(fmtr.getFormatFunction({\n          format: column.format\n        }));\n      }\n\n      column.setPropertiesSilent({\n        columnName: column.columnName || column.field\n      });\n    });\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      var bulkChanges = 'bulkChanges';\n      var aggregates = 'aggregates';\n      var prop = Object.keys(this.parent[bulkChanges]);\n\n      for (var i = 0; i < prop.length; i++) {\n        if (prop[i].startsWith(aggregates)) {\n          delete this.parent[bulkChanges][prop[i]];\n        }\n      }\n    }\n  };\n\n  Aggregate.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    if (isNullOrUndefined(this.footerRenderer)) {\n      this.initiateRender();\n    }\n\n    this.prepareSummaryInfo();\n    this.footerRenderer.refresh();\n    var cModel = new CaptionSummaryModelGenerator(this.parent);\n    var gModel = new GroupSummaryModelGenerator(this.parent);\n\n    if (gModel.getData().length !== 0 || !cModel.isEmpty()) {\n      this.parent.notify(modelChanged, {});\n    }\n  };\n\n  Aggregate.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(initialEnd, this.initiateRender, this);\n    this.parent.on(uiUpdate, this.onPropertyChanged, this);\n    this.parent.on(refreshAggregates, this.refresh, this);\n  };\n\n  Aggregate.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.footerRenderer.removeEventListener();\n    this.parent.off(initialEnd, this.initiateRender);\n    this.parent.off(dataReady, this.footerRenderer.refresh);\n    this.parent.off(uiUpdate, this.onPropertyChanged);\n    this.parent.off(refreshAggregates, this.refresh);\n  };\n\n  Aggregate.prototype.destroy = function () {\n    this.removeEventListener();\n    remove(this.parent.element.querySelector('.e-gridfooter'));\n  };\n\n  Aggregate.prototype.refresh = function (data) {\n    var editedData = data instanceof Array ? data : [data];\n    this.parent.notify(refreshFooterRenderer, editedData);\n\n    if (this.parent.groupSettings.columns.length > 0) {\n      this.parent.notify(groupAggregates, editedData);\n    }\n  };\n\n  return Aggregate;\n}();\n\nexport { Aggregate };\n/**\n * @private\n */\n\nexport function summaryIterator(aggregates, callback) {\n  for (var i = 0; i < aggregates.length; i++) {\n    for (var j = 0; j < aggregates[i].columns.length; j++) {\n      callback(aggregates[i].columns[j], aggregates[i]);\n    }\n  }\n}","map":null,"metadata":{},"sourceType":"module"}