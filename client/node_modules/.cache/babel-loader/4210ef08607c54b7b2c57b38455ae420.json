{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * PdfTrueTypeFont.ts class for EJ2-PDF\n */\n\n\nimport { UnicodeTrueTypeFont } from './unicode-true-type-font';\nimport { PdfFont } from './pdf-font';\nimport { PdfFontStyle } from './enum';\nimport { PdfDocument } from './../../document/pdf-document';\nimport { PdfTextDirection } from './../enum';\nimport { RtlRenderer } from './rtl-renderer'; //https://www.giftofspeed.com/base64-encoder/\n\nvar PdfTrueTypeFont =\n/** @class */\nfunction (_super) {\n  __extends(PdfTrueTypeFont, _super);\n\n  function PdfTrueTypeFont(base64String, size, style) {\n    var _this = _super.call(this, size) || this;\n    /**\n     * Indicates whether the font is embedded or not.\n     * @private\n     */\n\n\n    _this.isEmbedFont = false;\n    /**\n     * Indicates whether the font is unicoded or not.\n     * @private\n     */\n\n    _this.isUnicode = true;\n\n    if (style !== undefined) {\n      _this.createFontInternal(base64String, style);\n    } else {\n      _this.createFontInternal(base64String, PdfFontStyle.Regular);\n    }\n\n    return _this;\n  }\n\n  PdfTrueTypeFont.prototype.equalsToFont = function (font) {\n    var result = false; //let result : boolean = this.fontInternal.equalsToFont(font);\n\n    return result;\n  };\n\n  PdfTrueTypeFont.prototype.getLineWidth = function (line, format) {\n    var width = 0;\n\n    if (format !== null && format.textDirection !== PdfTextDirection.None) {\n      var returnValue = this.getUnicodeLineWidth(line,\n      /*out*/\n      width, format);\n      width = returnValue.width;\n    } else {\n      width = this.fontInternal.getLineWidth(line);\n    }\n\n    var size = this.metrics.getSize(format);\n    width *= PdfFont.charSizeMultiplier * size;\n    width = this.applyFormatSettings(line, format, width);\n    return width;\n  };\n  /**\n   * Returns width of the char.\n   */\n\n\n  PdfTrueTypeFont.prototype.getCharWidth = function (charCode, format) {\n    var codeWidth = this.fontInternal.getCharWidth(charCode);\n    var size = this.metrics.getSize(format);\n    codeWidth *= 0.001 * size;\n    return codeWidth;\n  }; //Implementation\n\n\n  PdfTrueTypeFont.prototype.createFontInternal = function (base64String, style) {\n    this.fontInternal = new UnicodeTrueTypeFont(base64String, this.size);\n    this.calculateStyle(style);\n    this.initializeInternals();\n  };\n\n  PdfTrueTypeFont.prototype.calculateStyle = function (style) {\n    var iStyle = this.fontInternal.ttfMetrics.macStyle;\n\n    if ((style & PdfFontStyle.Underline) !== 0) {\n      iStyle |= PdfFontStyle.Underline;\n    }\n\n    if ((style & PdfFontStyle.Strikeout) !== 0) {\n      iStyle |= PdfFontStyle.Strikeout;\n    }\n\n    this.setStyle(iStyle);\n  };\n\n  PdfTrueTypeFont.prototype.initializeInternals = function () {\n    var equalFont = null;\n\n    if (PdfDocument.enableCache) {\n      // Search for the similar fonts.\n      equalFont = PdfDocument.cache.search(this);\n    }\n\n    var internals = null; // There is not equal font in the cache.\n\n    if (equalFont !== null && equalFont !== undefined) {\n      // Get the settings from the cached font.\n      internals = equalFont.getInternals();\n      var metrics = equalFont.metrics;\n      metrics = metrics.clone();\n      metrics.size = this.size;\n      this.metrics = metrics;\n      this.fontInternal = equalFont.fontInternal;\n    } else {\n      if (equalFont == null) {\n        if (this.fontInternal instanceof UnicodeTrueTypeFont) {\n          this.fontInternal.isEmbed = this.isEmbedFont;\n        }\n\n        this.fontInternal.createInternals();\n        internals = this.fontInternal.getInternals();\n        this.metrics = this.fontInternal.metrics;\n      }\n    }\n\n    this.metrics.isUnicodeFont = true;\n    this.setInternals(internals); //this.ttfReader = (this.fontInternal as UnicodeTrueTypeFont).ttfReader;\n  };\n  /**\n   * Stores used symbols.\n   */\n\n\n  PdfTrueTypeFont.prototype.setSymbols = function (text) {\n    var internalFont = this.fontInternal;\n\n    if (internalFont != null) {\n      internalFont.setSymbols(text);\n    }\n  };\n\n  Object.defineProperty(PdfTrueTypeFont.prototype, \"Unicode\", {\n    /**\n     * Property\n     *\n     */\n    get: function () {\n      return this.isUnicode;\n    },\n    enumerable: true,\n    configurable: true\n  }); // public get Font() : UnicodeTrueTypeFont {\n  //     return this.fontInternal as UnicodeTrueTypeFont;\n  // }\n\n  PdfTrueTypeFont.prototype.getUnicodeLineWidth = function (line,\n  /*out*/\n  width, format) {\n    // if (line == null) {\n    //     throw new Error('ArgumentNullException : line');\n    // }\n    width = 0;\n    var glyphIndices = null;\n    var rtlRender = new RtlRenderer();\n    /* tslint:disable-next-line:max-line-length */\n\n    var result = rtlRender.getGlyphIndex(line, this, format.textDirection === PdfTextDirection.RightToLeft ? true : false,\n    /*out*/\n    glyphIndices, true);\n    var resultGlyph = result.success;\n    glyphIndices = result.glyphs;\n\n    if (resultGlyph && glyphIndices !== null) {\n      var ttfReader = this.fontInternal.ttfReader;\n\n      for (var i = 0, len = glyphIndices.length; i < len; i++) {\n        var glyphIndex = glyphIndices[i];\n        var glyph = ttfReader.getGlyph(glyphIndex);\n\n        if (glyph !== null && typeof glyph !== 'undefined') {\n          width += glyph.width;\n        }\n      }\n    }\n\n    return {\n      success: resultGlyph,\n      width: width\n    };\n  };\n\n  return PdfTrueTypeFont;\n}(PdfFont);\n\nexport { PdfTrueTypeFont };","map":null,"metadata":{},"sourceType":"module"}