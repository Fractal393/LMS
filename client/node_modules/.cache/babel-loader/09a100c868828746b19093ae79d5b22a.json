{"ast":null,"code":"var _jsxFileName = \"D:\\\\Akshat\\\\LMS\\\\client\\\\src\\\\components\\\\editor\\\\QuillEditor.js\";\nimport React from 'react';\nimport ReactQuill, { Quill } from 'react-quill';\nimport \"react-quill/dist/quill.snow.css\";\nimport axios from 'axios';\n\nconst __ISMSIE__ = navigator.userAgent.match(/Trident/i) ? true : false; // Quill.register('modules/clipboard', PlainClipboard, true);\n\n\nconst QuillClipboard = Quill.import('modules/clipboard');\n\nclass Clipboard extends QuillClipboard {\n  constructor(...args) {\n    super(...args);\n\n    this.getMetaTagElements = stringContent => {\n      const el = document.createElement('div');\n      el.innerHTML = stringContent;\n      return el.getElementsByTagName('meta');\n    };\n  }\n\n  async onPaste(e) {\n    let clipboardData = e.clipboardData || window.clipboardData;\n    let pastedData = await clipboardData.getData('Text');\n    const urlMatches = pastedData.match(/\\b(http|https)?:\\/\\/\\S+/gi) || [];\n\n    if (urlMatches.length > 0) {\n      e.preventDefault();\n      urlMatches.forEach(link => {\n        axios.get(link).then(payload => {\n          // let title, image, url, description;\n          let title, image, url;\n\n          for (let node of this.getMetaTagElements(payload)) {\n            if (node.getAttribute(\"property\") === \"og:title\") {\n              title = node.getAttribute(\"content\");\n            }\n\n            if (node.getAttribute(\"property\") === \"og:image\") {\n              image = node.getAttribute(\"content\");\n            }\n\n            if (node.getAttribute(\"property\") === \"og:url\") {\n              url = node.getAttribute(\"content\");\n            } // if (node.getAttribute(\"property\") === \"og:description\") {\n            //     description = node.getAttribute(\"content\");\n            // }\n\n          }\n\n          const rendered = \"<a href=\".concat(url, \" target=\\\"_blank\\\"><div><img src=\").concat(image, \" alt=\").concat(title, \" width=\\\"20%\\\"/><span>\").concat(title, \"</span></div></a>\");\n          let range = this.quill.getSelection();\n          let position = range ? range.index : 0;\n          this.quill.pasteHTML(position, rendered, 'silent');\n          this.quill.setSelection(position + rendered.length);\n        }).catch(error => console.error(error));\n      });\n    } else {\n      //console.log('when to use this') \n      super.onPaste(e);\n    }\n  }\n\n}\n\nQuill.register('modules/clipboard', Clipboard, true);\nconst BlockEmbed = Quill.import('blots/block/embed');\n\nclass ImageBlot extends BlockEmbed {\n  static create(value) {\n    const imgTag = super.create();\n    imgTag.setAttribute('src', value.src);\n    imgTag.setAttribute('alt', value.alt);\n    imgTag.setAttribute('width', '100%');\n    return imgTag;\n  }\n\n  static value(node) {\n    return {\n      src: node.getAttribute('src'),\n      alt: node.getAttribute('alt')\n    };\n  }\n\n}\n\nImageBlot.blotName = 'image';\nImageBlot.tagName = 'img';\nQuill.register(ImageBlot);\n\nclass VideoBlot extends BlockEmbed {\n  static create(value) {\n    if (value && value.src) {\n      const videoTag = super.create();\n      videoTag.setAttribute('src', value.src);\n      videoTag.setAttribute('title', value.title);\n      videoTag.setAttribute('width', '100%');\n      videoTag.setAttribute('controls', '');\n      return videoTag;\n    } else {\n      const iframeTag = document.createElement('iframe');\n      iframeTag.setAttribute('src', value);\n      iframeTag.setAttribute('frameborder', '0');\n      iframeTag.setAttribute('allowfullscreen', true);\n      iframeTag.setAttribute('width', '100%');\n      return iframeTag;\n    }\n  }\n\n  static value(node) {\n    if (node.getAttribute('title')) {\n      return {\n        src: node.getAttribute('src'),\n        alt: node.getAttribute('title')\n      };\n    } else {\n      return node.getAttribute('src');\n    } // return { src: node.getAttribute('src'), alt: node.getAttribute('title') };\n\n  }\n\n}\n\nVideoBlot.blotName = 'video';\nVideoBlot.tagName = 'video';\nQuill.register(VideoBlot);\n\nclass FileBlot extends BlockEmbed {\n  static create(value) {\n    const prefixTag = document.createElement('span');\n    prefixTag.innerText = \"\";\n    const bTag = document.createElement('b');\n    bTag.innerText = value;\n    const linkTag = document.createElement('a');\n    linkTag.setAttribute('href', value);\n    linkTag.setAttribute(\"target\", \"_blank\");\n    linkTag.setAttribute(\"className\", \"file-link-inner-post\");\n    linkTag.appendChild(bTag); //linkTag  <a href=\"btn_editPic@3x.png\" target=\"_blank\" classname=\"file-link-inner-post\"><b>btn_editPic@3x.png</b></a>\n\n    const node = super.create();\n    node.appendChild(prefixTag);\n    node.appendChild(linkTag);\n    return node;\n  }\n\n  static value(node) {\n    const linkTag = node.querySelector('a');\n    return linkTag.getAttribute('href');\n  }\n\n}\n\nFileBlot.blotName = 'file';\nFileBlot.tagName = 'p';\nFileBlot.className = 'file-inner-post';\nQuill.register(FileBlot);\n\nclass PollBlot extends BlockEmbed {\n  static create(value) {\n    const prefixTag = document.createElement('span');\n    prefixTag.innerText = \"\";\n    const bTag = document.createElement('b');\n    bTag.innerText = value.title;\n    const node = super.create();\n    node.setAttribute('id', value.id);\n    node.appendChild(prefixTag);\n    node.appendChild(bTag);\n    return node;\n  }\n\n  static value(node) {\n    const id = node.getAttribute('id');\n    const bTag = node.querySelector('b');\n    const title = bTag.innerText;\n    return {\n      id,\n      title\n    };\n  }\n\n}\n\nPollBlot.blotName = 'poll';\nPollBlot.tagName = 'p';\nPollBlot.className = 'poll-inner-post';\nQuill.register(PollBlot);\n\nclass QuillEditor extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = html => {\n      console.log('html', html); // https://youtu.be/BbR-QCoKngE\n      // https://www.youtube.com/embed/ZwKhufmMxko\n      // https://tv.naver.com/v/9176888\n      // renderToStaticMarkup(ReactHtmlParser(html, options));\n\n      this.setState({\n        editorHtml: html\n      }, () => {\n        this.props.onEditorChange(this.state.editorHtml);\n      });\n    };\n\n    this.imageHandler = () => {\n      this.inputOpenImageRef.current.click();\n    };\n\n    this.videoHandler = () => {\n      this.inputOpenVideoRef.current.click();\n    };\n\n    this.fileHandler = () => {\n      this.inputOpenFileRef.current.click();\n    };\n\n    this.insertImage = e => {\n      e.stopPropagation();\n      e.preventDefault();\n\n      if (e.currentTarget && e.currentTarget.files && e.currentTarget.files.length > 0) {\n        const file = e.currentTarget.files[0];\n        let formData = new FormData();\n        const config = {\n          header: {\n            'content-type': 'multipart/form-data'\n          }\n        };\n        formData.append(\"file\", file);\n        axios.post('/api/blog/uploadfiles', formData, config).then(response => {\n          if (response.data.success) {\n            const quill = this.reactQuillRef.getEditor();\n            quill.focus();\n            let range = quill.getSelection();\n            let position = range ? range.index : 0;\n            quill.insertEmbed(position, \"image\", {\n              src: \"http://localhost:5000/\" + response.data.url,\n              alt: response.data.fileName\n            });\n            quill.setSelection(position + 1);\n\n            if (this._isMounted) {\n              this.setState({\n                files: [...this.state.files, file]\n              }, () => {\n                this.props.onFilesChange(this.state.files);\n              });\n            }\n          } else {\n            return alert('failed to upload file');\n          }\n        });\n      }\n    };\n\n    this.insertVideo = e => {\n      e.stopPropagation();\n      e.preventDefault();\n\n      if (e.currentTarget && e.currentTarget.files && e.currentTarget.files.length > 0) {\n        const file = e.currentTarget.files[0];\n        let formData = new FormData();\n        const config = {\n          header: {\n            'content-type': 'multipart/form-data'\n          }\n        };\n        formData.append(\"file\", file);\n        axios.post('/api/blog/uploadfiles', formData, config).then(response => {\n          if (response.data.success) {\n            const quill = this.reactQuillRef.getEditor();\n            quill.focus();\n            let range = quill.getSelection();\n            let position = range ? range.index : 0;\n            quill.insertEmbed(position, \"video\", {\n              src: \"http://localhost:5000/\" + response.data.url,\n              title: response.data.fileName\n            });\n            quill.setSelection(position + 1);\n\n            if (this._isMounted) {\n              this.setState({\n                files: [...this.state.files, file]\n              }, () => {\n                this.props.onFilesChange(this.state.files);\n              });\n            }\n          } else {\n            return alert('failed to upload file');\n          }\n        });\n      }\n    };\n\n    this.insertFile = e => {\n      e.stopPropagation();\n      e.preventDefault();\n\n      if (e.currentTarget && e.currentTarget.files && e.currentTarget.files.length > 0) {\n        const file = e.currentTarget.files[0];\n        console.log(file);\n        let formData = new FormData();\n        const config = {\n          header: {\n            'content-type': 'multipart/form-data'\n          }\n        };\n        formData.append(\"file\", file);\n        axios.post('/api/blog/uploadfiles', formData, config).then(response => {\n          if (response.data.success) {\n            const quill = this.reactQuillRef.getEditor();\n            quill.focus();\n            let range = quill.getSelection();\n            let position = range ? range.index : 0;\n            quill.insertEmbed(position, \"file\", response.data.fileName);\n            quill.setSelection(position + 1);\n\n            if (this._isMounted) {\n              this.setState({\n                files: [...this.state.files, file]\n              }, () => {\n                this.props.onFilesChange(this.state.files);\n              });\n            }\n          }\n\n          ;\n        });\n      }\n    };\n\n    this.modules = {\n      syntax: true,\n      toolbar: {\n        container: \"#toolbar\",\n        handlers: {\n          insertImage: this.imageHandler,\n          insertVideo: this.videoHandler,\n          insertFile: this.fileHandler,\n          insertPoll: this.pollHandler\n        }\n      }\n    };\n    this.formats = ['font', 'header', 'bold', 'italic', 'underline', 'strike', 'image', 'video', 'file', 'link', \"code-block\", \"video\", \"blockquote\", \"clean\", \"list\", \"script\"];\n    this.state = {\n      editorHtml: __ISMSIE__ ? \"<p>&nbsp;</p>\" : \"\",\n      files: []\n    };\n    this.reactQuillRef = null;\n    this.inputOpenImageRef = React.createRef();\n    this.inputOpenVideoRef = React.createRef();\n    this.inputOpenFileRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"toolbar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367\n      },\n      __self: this\n    }, React.createElement(\"select\", {\n      className: \"ql-font\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368\n      },\n      __self: this\n    }, React.createElement(\"option\", {\n      \"data-value\": \"serif\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      \"data-value\": \"monospace\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370\n      },\n      __self: this\n    })), React.createElement(\"select\", {\n      className: \"ql-header\",\n      defaultValue: \"\",\n      onChange: e => e.persist(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 372\n      },\n      __self: this\n    }, React.createElement(\"option\", {\n      value: \"1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 374\n      },\n      __self: this\n    }), React.createElement(\"option\", {\n      value: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      className: \"ql-bold\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-italic\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-underline\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-strike\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      class: \"ql-list\",\n      value: \"ordered\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      class: \"ql-list\",\n      value: \"bullet\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      class: \"ql-script\",\n      value: \"sub\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      class: \"ql-script\",\n      value: \"super\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-insertImage\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 385\n      },\n      __self: this\n    }, \"I\"), React.createElement(\"button\", {\n      className: \"ql-insertVideo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 388\n      },\n      __self: this\n    }, \"V\"), React.createElement(\"button\", {\n      className: \"ql-link\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-code-block\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-video\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 396\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-blockquote\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"ql-clean\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398\n      },\n      __self: this\n    })), React.createElement(ReactQuill, {\n      ref: el => {\n        this.reactQuillRef = el;\n      },\n      theme: 'snow',\n      onChange: this.handleChange,\n      modules: this.modules,\n      formats: this.formats,\n      value: this.state.editorHtml,\n      placeholder: this.props.placeholder,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"file\",\n      accept: \"image/*\",\n      ref: this.inputOpenImageRef,\n      style: {\n        display: \"none\"\n      },\n      onChange: this.insertImage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"file\",\n      accept: \"video/*\",\n      ref: this.inputOpenVideoRef,\n      style: {\n        display: \"none\"\n      },\n      onChange: this.insertVideo,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 414\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"file\",\n      accept: \"*\",\n      ref: this.inputOpenFileRef,\n      style: {\n        display: \"none\"\n      },\n      onChange: this.insertFile,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 415\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default QuillEditor;","map":{"version":3,"sources":["D:\\Akshat\\LMS\\client\\src\\components\\editor\\QuillEditor.js"],"names":["React","ReactQuill","Quill","axios","__ISMSIE__","navigator","userAgent","match","QuillClipboard","import","Clipboard","getMetaTagElements","stringContent","el","document","createElement","innerHTML","getElementsByTagName","onPaste","e","clipboardData","window","pastedData","getData","urlMatches","length","preventDefault","forEach","link","get","then","payload","title","image","url","node","getAttribute","rendered","range","quill","getSelection","position","index","pasteHTML","setSelection","catch","error","console","register","BlockEmbed","ImageBlot","create","value","imgTag","setAttribute","src","alt","blotName","tagName","VideoBlot","videoTag","iframeTag","FileBlot","prefixTag","innerText","bTag","linkTag","appendChild","querySelector","className","PollBlot","id","QuillEditor","Component","constructor","props","handleChange","html","log","setState","editorHtml","onEditorChange","state","imageHandler","inputOpenImageRef","current","click","videoHandler","inputOpenVideoRef","fileHandler","inputOpenFileRef","insertImage","stopPropagation","currentTarget","files","file","formData","FormData","config","header","append","post","response","data","success","reactQuillRef","getEditor","focus","insertEmbed","fileName","_isMounted","onFilesChange","alert","insertVideo","insertFile","modules","syntax","toolbar","container","handlers","insertPoll","pollHandler","formats","createRef","componentDidMount","componentWillUnmount","render","persist","placeholder","display"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,IAAqBC,KAArB,QAAkC,aAAlC;AACA,OAAO,iCAAP;AAEA,OAAOC,KAAP,MAAkB,OAAlB;;AACA,MAAMC,UAAU,GAAGC,SAAS,CAACC,SAAV,CAAoBC,KAApB,CAA0B,UAA1B,IAAwC,IAAxC,GAA+C,KAAlE,C,CAEA;;;AAEA,MAAMC,cAAc,GAAGN,KAAK,CAACO,MAAN,CAAa,mBAAb,CAAvB;;AAGA,MAAMC,SAAN,SAAwBF,cAAxB,CAAuC;AAAA;AAAA;;AAAA,SAEnCG,kBAFmC,GAEbC,aAAD,IAAmB;AACpC,YAAMC,EAAE,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAX;AACAF,MAAAA,EAAE,CAACG,SAAH,GAAeJ,aAAf;AACA,aAAOC,EAAE,CAACI,oBAAH,CAAwB,MAAxB,CAAP;AACH,KANkC;AAAA;;AAQnC,QAAMC,OAAN,CAAcC,CAAd,EAAiB;AACb,QAAIC,aAAa,GAAGD,CAAC,CAACC,aAAF,IAAmBC,MAAM,CAACD,aAA9C;AACA,QAAIE,UAAU,GAAG,MAAMF,aAAa,CAACG,OAAd,CAAsB,MAAtB,CAAvB;AAEA,UAAMC,UAAU,GAAGF,UAAU,CAACf,KAAX,CAAiB,2BAAjB,KAAiD,EAApE;;AACA,QAAIiB,UAAU,CAACC,MAAX,GAAoB,CAAxB,EAA2B;AACvBN,MAAAA,CAAC,CAACO,cAAF;AACAF,MAAAA,UAAU,CAACG,OAAX,CAAmBC,IAAI,IAAI;AACvBzB,QAAAA,KAAK,CAAC0B,GAAN,CAAUD,IAAV,EACKE,IADL,CACUC,OAAO,IAAI;AACb;AACA,cAAIC,KAAJ,EAAWC,KAAX,EAAkBC,GAAlB;;AACA,eAAK,IAAIC,IAAT,IAAiB,KAAKxB,kBAAL,CAAwBoB,OAAxB,CAAjB,EAAmD;AAC/C,gBAAII,IAAI,CAACC,YAAL,CAAkB,UAAlB,MAAkC,UAAtC,EAAkD;AAC9CJ,cAAAA,KAAK,GAAGG,IAAI,CAACC,YAAL,CAAkB,SAAlB,CAAR;AACH;;AACD,gBAAID,IAAI,CAACC,YAAL,CAAkB,UAAlB,MAAkC,UAAtC,EAAkD;AAC9CH,cAAAA,KAAK,GAAGE,IAAI,CAACC,YAAL,CAAkB,SAAlB,CAAR;AACH;;AACD,gBAAID,IAAI,CAACC,YAAL,CAAkB,UAAlB,MAAkC,QAAtC,EAAgD;AAC5CF,cAAAA,GAAG,GAAGC,IAAI,CAACC,YAAL,CAAkB,SAAlB,CAAN;AACH,aAT8C,CAU/C;AACA;AACA;;AACH;;AAED,gBAAMC,QAAQ,qBAAcH,GAAd,8CAAmDD,KAAnD,kBAAgED,KAAhE,mCAA4FA,KAA5F,sBAAd;AAEA,cAAIM,KAAK,GAAG,KAAKC,KAAL,CAAWC,YAAX,EAAZ;AACA,cAAIC,QAAQ,GAAGH,KAAK,GAAGA,KAAK,CAACI,KAAT,GAAiB,CAArC;AACA,eAAKH,KAAL,CAAWI,SAAX,CAAqBF,QAArB,EAA+BJ,QAA/B,EAAyC,QAAzC;AACA,eAAKE,KAAL,CAAWK,YAAX,CAAwBH,QAAQ,GAAGJ,QAAQ,CAACZ,MAA5C;AACH,SAzBL,EA0BKoB,KA1BL,CA0BWC,KAAK,IAAIC,OAAO,CAACD,KAAR,CAAcA,KAAd,CA1BpB;AA2BH,OA5BD;AA8BH,KAhCD,MAgCO;AACH;AACA,YAAM5B,OAAN,CAAcC,CAAd;AACH;AACJ;;AAjDkC;;AAoDvCjB,KAAK,CAAC8C,QAAN,CAAe,mBAAf,EAAoCtC,SAApC,EAA+C,IAA/C;AAEA,MAAMuC,UAAU,GAAG/C,KAAK,CAACO,MAAN,CAAa,mBAAb,CAAnB;;AAEA,MAAMyC,SAAN,SAAwBD,UAAxB,CAAmC;AAE/B,SAAOE,MAAP,CAAcC,KAAd,EAAqB;AACjB,UAAMC,MAAM,GAAG,MAAMF,MAAN,EAAf;AACAE,IAAAA,MAAM,CAACC,YAAP,CAAoB,KAApB,EAA2BF,KAAK,CAACG,GAAjC;AACAF,IAAAA,MAAM,CAACC,YAAP,CAAoB,KAApB,EAA2BF,KAAK,CAACI,GAAjC;AACAH,IAAAA,MAAM,CAACC,YAAP,CAAoB,OAApB,EAA6B,MAA7B;AACA,WAAOD,MAAP;AACH;;AAED,SAAOD,KAAP,CAAajB,IAAb,EAAmB;AACf,WAAO;AAAEoB,MAAAA,GAAG,EAAEpB,IAAI,CAACC,YAAL,CAAkB,KAAlB,CAAP;AAAiCoB,MAAAA,GAAG,EAAErB,IAAI,CAACC,YAAL,CAAkB,KAAlB;AAAtC,KAAP;AACH;;AAZ8B;;AAgBnCc,SAAS,CAACO,QAAV,GAAqB,OAArB;AACAP,SAAS,CAACQ,OAAV,GAAoB,KAApB;AACAxD,KAAK,CAAC8C,QAAN,CAAeE,SAAf;;AAEA,MAAMS,SAAN,SAAwBV,UAAxB,CAAmC;AAE/B,SAAOE,MAAP,CAAcC,KAAd,EAAqB;AACjB,QAAIA,KAAK,IAAIA,KAAK,CAACG,GAAnB,EAAwB;AACpB,YAAMK,QAAQ,GAAG,MAAMT,MAAN,EAAjB;AACAS,MAAAA,QAAQ,CAACN,YAAT,CAAsB,KAAtB,EAA6BF,KAAK,CAACG,GAAnC;AACAK,MAAAA,QAAQ,CAACN,YAAT,CAAsB,OAAtB,EAA+BF,KAAK,CAACpB,KAArC;AACA4B,MAAAA,QAAQ,CAACN,YAAT,CAAsB,OAAtB,EAA+B,MAA/B;AACAM,MAAAA,QAAQ,CAACN,YAAT,CAAsB,UAAtB,EAAkC,EAAlC;AAEA,aAAOM,QAAP;AACH,KARD,MAQO;AACH,YAAMC,SAAS,GAAG/C,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAlB;AACA8C,MAAAA,SAAS,CAACP,YAAV,CAAuB,KAAvB,EAA8BF,KAA9B;AACAS,MAAAA,SAAS,CAACP,YAAV,CAAuB,aAAvB,EAAsC,GAAtC;AACAO,MAAAA,SAAS,CAACP,YAAV,CAAuB,iBAAvB,EAA0C,IAA1C;AACAO,MAAAA,SAAS,CAACP,YAAV,CAAuB,OAAvB,EAAgC,MAAhC;AACA,aAAOO,SAAP;AACH;AACJ;;AAED,SAAOT,KAAP,CAAajB,IAAb,EAAmB;AACf,QAAIA,IAAI,CAACC,YAAL,CAAkB,OAAlB,CAAJ,EAAgC;AAC5B,aAAO;AAAEmB,QAAAA,GAAG,EAAEpB,IAAI,CAACC,YAAL,CAAkB,KAAlB,CAAP;AAAiCoB,QAAAA,GAAG,EAAErB,IAAI,CAACC,YAAL,CAAkB,OAAlB;AAAtC,OAAP;AACH,KAFD,MAEO;AACH,aAAOD,IAAI,CAACC,YAAL,CAAkB,KAAlB,CAAP;AACH,KALc,CAMf;;AACH;;AA5B8B;;AAgCnCuB,SAAS,CAACF,QAAV,GAAqB,OAArB;AACAE,SAAS,CAACD,OAAV,GAAoB,OAApB;AACAxD,KAAK,CAAC8C,QAAN,CAAeW,SAAf;;AAEA,MAAMG,QAAN,SAAuBb,UAAvB,CAAkC;AAE9B,SAAOE,MAAP,CAAcC,KAAd,EAAqB;AACjB,UAAMW,SAAS,GAAGjD,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAlB;AACAgD,IAAAA,SAAS,CAACC,SAAV,GAAsB,EAAtB;AAEA,UAAMC,IAAI,GAAGnD,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AAEAkD,IAAAA,IAAI,CAACD,SAAL,GAAiBZ,KAAjB;AAEA,UAAMc,OAAO,GAAGpD,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAhB;AACAmD,IAAAA,OAAO,CAACZ,YAAR,CAAqB,MAArB,EAA6BF,KAA7B;AACAc,IAAAA,OAAO,CAACZ,YAAR,CAAqB,QAArB,EAA+B,QAA/B;AACAY,IAAAA,OAAO,CAACZ,YAAR,CAAqB,WAArB,EAAkC,sBAAlC;AACAY,IAAAA,OAAO,CAACC,WAAR,CAAoBF,IAApB,EAZiB,CAajB;;AAEA,UAAM9B,IAAI,GAAG,MAAMgB,MAAN,EAAb;AACAhB,IAAAA,IAAI,CAACgC,WAAL,CAAiBJ,SAAjB;AACA5B,IAAAA,IAAI,CAACgC,WAAL,CAAiBD,OAAjB;AAEA,WAAO/B,IAAP;AACH;;AAED,SAAOiB,KAAP,CAAajB,IAAb,EAAmB;AACf,UAAM+B,OAAO,GAAG/B,IAAI,CAACiC,aAAL,CAAmB,GAAnB,CAAhB;AACA,WAAOF,OAAO,CAAC9B,YAAR,CAAqB,MAArB,CAAP;AACH;;AA3B6B;;AA+BlC0B,QAAQ,CAACL,QAAT,GAAoB,MAApB;AACAK,QAAQ,CAACJ,OAAT,GAAmB,GAAnB;AACAI,QAAQ,CAACO,SAAT,GAAqB,iBAArB;AACAnE,KAAK,CAAC8C,QAAN,CAAec,QAAf;;AAEA,MAAMQ,QAAN,SAAuBrB,UAAvB,CAAkC;AAE9B,SAAOE,MAAP,CAAcC,KAAd,EAAqB;AACjB,UAAMW,SAAS,GAAGjD,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAlB;AACAgD,IAAAA,SAAS,CAACC,SAAV,GAAsB,EAAtB;AAEA,UAAMC,IAAI,GAAGnD,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAkD,IAAAA,IAAI,CAACD,SAAL,GAAiBZ,KAAK,CAACpB,KAAvB;AAEA,UAAMG,IAAI,GAAG,MAAMgB,MAAN,EAAb;AACAhB,IAAAA,IAAI,CAACmB,YAAL,CAAkB,IAAlB,EAAwBF,KAAK,CAACmB,EAA9B;AACApC,IAAAA,IAAI,CAACgC,WAAL,CAAiBJ,SAAjB;AACA5B,IAAAA,IAAI,CAACgC,WAAL,CAAiBF,IAAjB;AAEA,WAAO9B,IAAP;AACH;;AAED,SAAOiB,KAAP,CAAajB,IAAb,EAAmB;AACf,UAAMoC,EAAE,GAAGpC,IAAI,CAACC,YAAL,CAAkB,IAAlB,CAAX;AACA,UAAM6B,IAAI,GAAG9B,IAAI,CAACiC,aAAL,CAAmB,GAAnB,CAAb;AACA,UAAMpC,KAAK,GAAGiC,IAAI,CAACD,SAAnB;AACA,WAAO;AAAEO,MAAAA,EAAF;AAAMvC,MAAAA;AAAN,KAAP;AACH;;AAtB6B;;AA0BlCsC,QAAQ,CAACb,QAAT,GAAoB,MAApB;AACAa,QAAQ,CAACZ,OAAT,GAAmB,GAAnB;AACAY,QAAQ,CAACD,SAAT,GAAqB,iBAArB;AACAnE,KAAK,CAAC8C,QAAN,CAAesB,QAAf;;AAEA,MAAME,WAAN,SAA0BxE,KAAK,CAACyE,SAAhC,CAA0C;AAStCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN;;AADe,SAuBnBC,YAvBmB,GAuBHC,IAAD,IAAU;AACrB9B,MAAAA,OAAO,CAAC+B,GAAR,CAAY,MAAZ,EAAoBD,IAApB,EADqB,CAErB;AACA;AACA;AACA;;AAEA,WAAKE,QAAL,CAAc;AACVC,QAAAA,UAAU,EAAEH;AADF,OAAd,EAEG,MAAM;AACL,aAAKF,KAAL,CAAWM,cAAX,CAA0B,KAAKC,KAAL,CAAWF,UAArC;AACH,OAJD;AAKH,KAnCkB;;AAAA,SAsCnBG,YAtCmB,GAsCJ,MAAM;AACjB,WAAKC,iBAAL,CAAuBC,OAAvB,CAA+BC,KAA/B;AACH,KAxCkB;;AAAA,SA0CnBC,YA1CmB,GA0CJ,MAAM;AACjB,WAAKC,iBAAL,CAAuBH,OAAvB,CAA+BC,KAA/B;AACH,KA5CkB;;AAAA,SA8CnBG,WA9CmB,GA8CL,MAAM;AAChB,WAAKC,gBAAL,CAAsBL,OAAtB,CAA8BC,KAA9B;AACH,KAhDkB;;AAAA,SAmDnBK,WAnDmB,GAmDJxE,CAAD,IAAO;AACjBA,MAAAA,CAAC,CAACyE,eAAF;AACAzE,MAAAA,CAAC,CAACO,cAAF;;AAEA,UAAIP,CAAC,CAAC0E,aAAF,IAAmB1E,CAAC,CAAC0E,aAAF,CAAgBC,KAAnC,IAA4C3E,CAAC,CAAC0E,aAAF,CAAgBC,KAAhB,CAAsBrE,MAAtB,GAA+B,CAA/E,EAAkF;AAC9E,cAAMsE,IAAI,GAAG5E,CAAC,CAAC0E,aAAF,CAAgBC,KAAhB,CAAsB,CAAtB,CAAb;AAEA,YAAIE,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACA,cAAMC,MAAM,GAAG;AACXC,UAAAA,MAAM,EAAE;AAAE,4BAAgB;AAAlB;AADG,SAAf;AAGAH,QAAAA,QAAQ,CAACI,MAAT,CAAgB,MAAhB,EAAwBL,IAAxB;AAEA5F,QAAAA,KAAK,CAACkG,IAAN,CAAW,uBAAX,EAAoCL,QAApC,EAA8CE,MAA9C,EACKpE,IADL,CACUwE,QAAQ,IAAI;AACd,cAAIA,QAAQ,CAACC,IAAT,CAAcC,OAAlB,EAA2B;AAEvB,kBAAMjE,KAAK,GAAG,KAAKkE,aAAL,CAAmBC,SAAnB,EAAd;AACAnE,YAAAA,KAAK,CAACoE,KAAN;AAEA,gBAAIrE,KAAK,GAAGC,KAAK,CAACC,YAAN,EAAZ;AACA,gBAAIC,QAAQ,GAAGH,KAAK,GAAGA,KAAK,CAACI,KAAT,GAAiB,CAArC;AAGAH,YAAAA,KAAK,CAACqE,WAAN,CAAkBnE,QAAlB,EAA4B,OAA5B,EAAqC;AAAEc,cAAAA,GAAG,EAAE,2BAA2B+C,QAAQ,CAACC,IAAT,CAAcrE,GAAhD;AAAqDsB,cAAAA,GAAG,EAAE8C,QAAQ,CAACC,IAAT,CAAcM;AAAxE,aAArC;AACAtE,YAAAA,KAAK,CAACK,YAAN,CAAmBH,QAAQ,GAAG,CAA9B;;AAEA,gBAAI,KAAKqE,UAAT,EAAqB;AACjB,mBAAK/B,QAAL,CAAc;AACVe,gBAAAA,KAAK,EAAE,CAAC,GAAG,KAAKZ,KAAL,CAAWY,KAAf,EAAsBC,IAAtB;AADG,eAAd,EAEG,MAAM;AAAE,qBAAKpB,KAAL,CAAWoC,aAAX,CAAyB,KAAK7B,KAAL,CAAWY,KAApC;AAA4C,eAFvD;AAGH;AACJ,WAjBD,MAiBO;AACH,mBAAOkB,KAAK,CAAC,uBAAD,CAAZ;AACH;AACJ,SAtBL;AAuBH;AACJ,KAxFkB;;AAAA,SA0FnBC,WA1FmB,GA0FJ9F,CAAD,IAAO;AACjBA,MAAAA,CAAC,CAACyE,eAAF;AACAzE,MAAAA,CAAC,CAACO,cAAF;;AAEA,UAAIP,CAAC,CAAC0E,aAAF,IAAmB1E,CAAC,CAAC0E,aAAF,CAAgBC,KAAnC,IAA4C3E,CAAC,CAAC0E,aAAF,CAAgBC,KAAhB,CAAsBrE,MAAtB,GAA+B,CAA/E,EAAkF;AAC9E,cAAMsE,IAAI,GAAG5E,CAAC,CAAC0E,aAAF,CAAgBC,KAAhB,CAAsB,CAAtB,CAAb;AAEA,YAAIE,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACA,cAAMC,MAAM,GAAG;AACXC,UAAAA,MAAM,EAAE;AAAE,4BAAgB;AAAlB;AADG,SAAf;AAGAH,QAAAA,QAAQ,CAACI,MAAT,CAAgB,MAAhB,EAAwBL,IAAxB;AAEA5F,QAAAA,KAAK,CAACkG,IAAN,CAAW,uBAAX,EAAoCL,QAApC,EAA8CE,MAA9C,EACKpE,IADL,CACUwE,QAAQ,IAAI;AACd,cAAIA,QAAQ,CAACC,IAAT,CAAcC,OAAlB,EAA2B;AAEvB,kBAAMjE,KAAK,GAAG,KAAKkE,aAAL,CAAmBC,SAAnB,EAAd;AACAnE,YAAAA,KAAK,CAACoE,KAAN;AAEA,gBAAIrE,KAAK,GAAGC,KAAK,CAACC,YAAN,EAAZ;AACA,gBAAIC,QAAQ,GAAGH,KAAK,GAAGA,KAAK,CAACI,KAAT,GAAiB,CAArC;AACAH,YAAAA,KAAK,CAACqE,WAAN,CAAkBnE,QAAlB,EAA4B,OAA5B,EAAqC;AAAEc,cAAAA,GAAG,EAAE,2BAA2B+C,QAAQ,CAACC,IAAT,CAAcrE,GAAhD;AAAqDF,cAAAA,KAAK,EAAEsE,QAAQ,CAACC,IAAT,CAAcM;AAA1E,aAArC;AACAtE,YAAAA,KAAK,CAACK,YAAN,CAAmBH,QAAQ,GAAG,CAA9B;;AAEA,gBAAI,KAAKqE,UAAT,EAAqB;AACjB,mBAAK/B,QAAL,CAAc;AACVe,gBAAAA,KAAK,EAAE,CAAC,GAAG,KAAKZ,KAAL,CAAWY,KAAf,EAAsBC,IAAtB;AADG,eAAd,EAEG,MAAM;AAAE,qBAAKpB,KAAL,CAAWoC,aAAX,CAAyB,KAAK7B,KAAL,CAAWY,KAApC;AAA4C,eAFvD;AAGH;AACJ,WAfD,MAeO;AACH,mBAAOkB,KAAK,CAAC,uBAAD,CAAZ;AACH;AACJ,SApBL;AAqBH;AACJ,KA7HkB;;AAAA,SA+HnBE,UA/HmB,GA+HL/F,CAAD,IAAO;AAChBA,MAAAA,CAAC,CAACyE,eAAF;AACAzE,MAAAA,CAAC,CAACO,cAAF;;AAEA,UAAIP,CAAC,CAAC0E,aAAF,IAAmB1E,CAAC,CAAC0E,aAAF,CAAgBC,KAAnC,IAA4C3E,CAAC,CAAC0E,aAAF,CAAgBC,KAAhB,CAAsBrE,MAAtB,GAA+B,CAA/E,EAAkF;AAC9E,cAAMsE,IAAI,GAAG5E,CAAC,CAAC0E,aAAF,CAAgBC,KAAhB,CAAsB,CAAtB,CAAb;AACA/C,QAAAA,OAAO,CAAC+B,GAAR,CAAYiB,IAAZ;AAEA,YAAIC,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACA,cAAMC,MAAM,GAAG;AACXC,UAAAA,MAAM,EAAE;AAAE,4BAAgB;AAAlB;AADG,SAAf;AAGAH,QAAAA,QAAQ,CAACI,MAAT,CAAgB,MAAhB,EAAwBL,IAAxB;AAEA5F,QAAAA,KAAK,CAACkG,IAAN,CAAW,uBAAX,EAAoCL,QAApC,EAA8CE,MAA9C,EACKpE,IADL,CACUwE,QAAQ,IAAI;AACd,cAAIA,QAAQ,CAACC,IAAT,CAAcC,OAAlB,EAA2B;AAEvB,kBAAMjE,KAAK,GAAG,KAAKkE,aAAL,CAAmBC,SAAnB,EAAd;AACAnE,YAAAA,KAAK,CAACoE,KAAN;AAEA,gBAAIrE,KAAK,GAAGC,KAAK,CAACC,YAAN,EAAZ;AACA,gBAAIC,QAAQ,GAAGH,KAAK,GAAGA,KAAK,CAACI,KAAT,GAAiB,CAArC;AACAH,YAAAA,KAAK,CAACqE,WAAN,CAAkBnE,QAAlB,EAA4B,MAA5B,EAAoC6D,QAAQ,CAACC,IAAT,CAAcM,QAAlD;AACAtE,YAAAA,KAAK,CAACK,YAAN,CAAmBH,QAAQ,GAAG,CAA9B;;AAEA,gBAAI,KAAKqE,UAAT,EAAqB;AACjB,mBAAK/B,QAAL,CAAc;AACVe,gBAAAA,KAAK,EAAE,CAAC,GAAG,KAAKZ,KAAL,CAAWY,KAAf,EAAsBC,IAAtB;AADG,eAAd,EAEG,MAAM;AAAE,qBAAKpB,KAAL,CAAWoC,aAAX,CAAyB,KAAK7B,KAAL,CAAWY,KAApC;AAA4C,eAFvD;AAGH;AACJ;;AAAA;AACJ,SAlBL;AAmBH;AACJ,KAjKkB;;AAAA,SA2NnBqB,OA3NmB,GA2NT;AACNC,MAAAA,MAAM,EAAE,IADF;AAENC,MAAAA,OAAO,EAAE;AACLC,QAAAA,SAAS,EAAE,UADN;AAGLC,QAAAA,QAAQ,EAAE;AACN5B,UAAAA,WAAW,EAAE,KAAKR,YADZ;AAEN8B,UAAAA,WAAW,EAAE,KAAK1B,YAFZ;AAGN2B,UAAAA,UAAU,EAAE,KAAKzB,WAHX;AAIN+B,UAAAA,UAAU,EAAE,KAAKC;AAJX;AAHL;AAFH,KA3NS;AAAA,SA0OnBC,OA1OmB,GA0OT,CACN,MADM,EAEN,QAFM,EAGN,MAHM,EAGE,QAHF,EAGY,WAHZ,EAGyB,QAHzB,EAIN,OAJM,EAIG,OAJH,EAIY,MAJZ,EAIoB,MAJpB,EAI2B,YAJ3B,EAIyC,OAJzC,EAIkD,YAJlD,EAIgE,OAJhE,EAIyE,MAJzE,EAIiF,QAJjF,CA1OS;AAGf,SAAKxC,KAAL,GAAa;AACTF,MAAAA,UAAU,EAAE5E,UAAU,GAAG,eAAH,GAAqB,EADlC;AAET0F,MAAAA,KAAK,EAAE;AAFE,KAAb;AAKA,SAAKW,aAAL,GAAqB,IAArB;AAEA,SAAKrB,iBAAL,GAAyBpF,KAAK,CAAC2H,SAAN,EAAzB;AACA,SAAKnC,iBAAL,GAAyBxF,KAAK,CAAC2H,SAAN,EAAzB;AACA,SAAKjC,gBAAL,GAAwB1F,KAAK,CAAC2H,SAAN,EAAxB;AACH;;AAEDC,EAAAA,iBAAiB,GAAG;AAChB,SAAKd,UAAL,GAAkB,IAAlB;AACH;;AAEDe,EAAAA,oBAAoB,GAAG;AACnB,SAAKf,UAAL,GAAkB,KAAlB;AACH;;AA8IDgB,EAAAA,MAAM,GAAG;AACL,WACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,EAAE,EAAC,SAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAQ,MAAA,SAAS,EAAC,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAQ,oBAAW,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,EAEI;AAAQ,oBAAW,WAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFJ,CADJ,EAKI;AAAQ,MAAA,SAAS,EAAC,WAAlB;AAA8B,MAAA,YAAY,EAAE,EAA5C;AAAgD,MAAA,QAAQ,EAAE3G,CAAC,IAAIA,CAAC,CAAC4G,OAAF,EAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAQ,MAAA,KAAK,EAAC,GAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,EAEI;AAAQ,MAAA,KAAK,EAAC,GAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFJ,EAGI;AAAQ,MAAA,KAAK,EAAC,EAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAHJ,CALJ,EAUI;AAAQ,MAAA,SAAS,EAAC,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAVJ,EAWI;AAAQ,MAAA,SAAS,EAAC,WAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAXJ,EAYI;AAAQ,MAAA,SAAS,EAAC,cAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAZJ,EAaI;AAAQ,MAAA,SAAS,EAAC,WAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAbJ,EAcI;AAAQ,MAAA,KAAK,EAAC,SAAd;AAAwB,MAAA,KAAK,EAAC,SAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAdJ,EAeI;AAAQ,MAAA,KAAK,EAAC,SAAd;AAAwB,MAAA,KAAK,EAAC,QAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAfJ,EAgBI;AAAQ,MAAA,KAAK,EAAC,WAAd;AAA0B,MAAA,KAAK,EAAC,KAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAhBJ,EAiBI;AAAQ,MAAA,KAAK,EAAC,WAAd;AAA0B,MAAA,KAAK,EAAC,OAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAjBJ,EAkBI;AAAQ,MAAA,SAAS,EAAC,gBAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAlBJ,EAqBI;AAAQ,MAAA,SAAS,EAAC,gBAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WArBJ,EA2BI;AAAQ,MAAA,SAAS,EAAC,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA3BJ,EA4BI;AAAQ,MAAA,SAAS,EAAC,eAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA5BJ,EA6BI;AAAQ,MAAA,SAAS,EAAC,UAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA7BJ,EA8BI;AAAQ,MAAA,SAAS,EAAC,eAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA9BJ,EA+BI;AAAQ,MAAA,SAAS,EAAC,UAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA/BJ,CADJ,EAsCI,oBAAC,UAAD;AACI,MAAA,GAAG,EAAGlH,EAAD,IAAQ;AAAE,aAAK4F,aAAL,GAAqB5F,EAArB;AAAyB,OAD5C;AAEI,MAAA,KAAK,EAAE,MAFX;AAGI,MAAA,QAAQ,EAAE,KAAK+D,YAHnB;AAII,MAAA,OAAO,EAAE,KAAKuC,OAJlB;AAKI,MAAA,OAAO,EAAE,KAAKO,OALlB;AAMI,MAAA,KAAK,EAAE,KAAKxC,KAAL,CAAWF,UANtB;AAOI,MAAA,WAAW,EAAE,KAAKL,KAAL,CAAWqD,WAP5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAtCJ,EA+CI;AAAO,MAAA,IAAI,EAAC,MAAZ;AAAmB,MAAA,MAAM,EAAC,SAA1B;AAAoC,MAAA,GAAG,EAAE,KAAK5C,iBAA9C;AAAiE,MAAA,KAAK,EAAE;AAAE6C,QAAAA,OAAO,EAAE;AAAX,OAAxE;AAA6F,MAAA,QAAQ,EAAE,KAAKtC,WAA5G;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA/CJ,EAgDI;AAAO,MAAA,IAAI,EAAC,MAAZ;AAAmB,MAAA,MAAM,EAAC,SAA1B;AAAoC,MAAA,GAAG,EAAE,KAAKH,iBAA9C;AAAiE,MAAA,KAAK,EAAE;AAAEyC,QAAAA,OAAO,EAAE;AAAX,OAAxE;AAA6F,MAAA,QAAQ,EAAE,KAAKhB,WAA5G;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAhDJ,EAiDI;AAAO,MAAA,IAAI,EAAC,MAAZ;AAAmB,MAAA,MAAM,EAAC,GAA1B;AAA8B,MAAA,GAAG,EAAE,KAAKvB,gBAAxC;AAA0D,MAAA,KAAK,EAAE;AAAEuC,QAAAA,OAAO,EAAE;AAAX,OAAjE;AAAsF,MAAA,QAAQ,EAAE,KAAKf,UAArG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAjDJ,CADJ;AAqDH;;AAlOqC;;AA2P1C,eAAe1C,WAAf","sourcesContent":["import React from 'react';\nimport ReactQuill, { Quill } from 'react-quill';\nimport \"react-quill/dist/quill.snow.css\";\n\nimport axios from 'axios';\nconst __ISMSIE__ = navigator.userAgent.match(/Trident/i) ? true : false;\n\n// Quill.register('modules/clipboard', PlainClipboard, true);\n\nconst QuillClipboard = Quill.import('modules/clipboard');\n\n\nclass Clipboard extends QuillClipboard {\n\n    getMetaTagElements = (stringContent) => {\n        const el = document.createElement('div');\n        el.innerHTML = stringContent;\n        return el.getElementsByTagName('meta');\n    };\n\n    async onPaste(e) {\n        let clipboardData = e.clipboardData || window.clipboardData;\n        let pastedData = await clipboardData.getData('Text');\n\n        const urlMatches = pastedData.match(/\\b(http|https)?:\\/\\/\\S+/gi) || [];\n        if (urlMatches.length > 0) {\n            e.preventDefault();\n            urlMatches.forEach(link => {\n                axios.get(link)\n                    .then(payload => {\n                        // let title, image, url, description;\n                        let title, image, url;\n                        for (let node of this.getMetaTagElements(payload)) {\n                            if (node.getAttribute(\"property\") === \"og:title\") {\n                                title = node.getAttribute(\"content\");\n                            }\n                            if (node.getAttribute(\"property\") === \"og:image\") {\n                                image = node.getAttribute(\"content\");\n                            }\n                            if (node.getAttribute(\"property\") === \"og:url\") {\n                                url = node.getAttribute(\"content\");\n                            }\n                            // if (node.getAttribute(\"property\") === \"og:description\") {\n                            //     description = node.getAttribute(\"content\");\n                            // }\n                        }\n\n                        const rendered = `<a href=${url} target=\"_blank\"><div><img src=${image} alt=${title} width=\"20%\"/><span>${title}</span></div></a>`;\n\n                        let range = this.quill.getSelection();\n                        let position = range ? range.index : 0;\n                        this.quill.pasteHTML(position, rendered, 'silent');\n                        this.quill.setSelection(position + rendered.length);\n                    })\n                    .catch(error => console.error(error));\n            });\n\n        } else {\n            //console.log('when to use this') \n            super.onPaste(e);\n        }\n    }\n\n}\nQuill.register('modules/clipboard', Clipboard, true);\n\nconst BlockEmbed = Quill.import('blots/block/embed');\n\nclass ImageBlot extends BlockEmbed {\n\n    static create(value) {\n        const imgTag = super.create();\n        imgTag.setAttribute('src', value.src);\n        imgTag.setAttribute('alt', value.alt);\n        imgTag.setAttribute('width', '100%');\n        return imgTag;\n    }\n\n    static value(node) {\n        return { src: node.getAttribute('src'), alt: node.getAttribute('alt') };\n    }\n\n}\n\nImageBlot.blotName = 'image';\nImageBlot.tagName = 'img';\nQuill.register(ImageBlot);\n\nclass VideoBlot extends BlockEmbed {\n\n    static create(value) {\n        if (value && value.src) {\n            const videoTag = super.create();\n            videoTag.setAttribute('src', value.src);\n            videoTag.setAttribute('title', value.title);\n            videoTag.setAttribute('width', '100%');\n            videoTag.setAttribute('controls', '');\n\n            return videoTag;\n        } else {\n            const iframeTag = document.createElement('iframe');\n            iframeTag.setAttribute('src', value);\n            iframeTag.setAttribute('frameborder', '0');\n            iframeTag.setAttribute('allowfullscreen', true);\n            iframeTag.setAttribute('width', '100%');\n            return iframeTag;\n        }\n    }\n\n    static value(node) {\n        if (node.getAttribute('title')) {\n            return { src: node.getAttribute('src'), alt: node.getAttribute('title') };\n        } else {\n            return node.getAttribute('src');\n        }\n        // return { src: node.getAttribute('src'), alt: node.getAttribute('title') };\n    }\n\n}\n\nVideoBlot.blotName = 'video';\nVideoBlot.tagName = 'video';\nQuill.register(VideoBlot);\n\nclass FileBlot extends BlockEmbed {\n\n    static create(value) {\n        const prefixTag = document.createElement('span');\n        prefixTag.innerText = \"\";\n\n        const bTag = document.createElement('b');\n        \n        bTag.innerText = value;\n\n        const linkTag = document.createElement('a');\n        linkTag.setAttribute('href', value);\n        linkTag.setAttribute(\"target\", \"_blank\");\n        linkTag.setAttribute(\"className\", \"file-link-inner-post\");\n        linkTag.appendChild(bTag);\n        //linkTag  <a href=\"btn_editPic@3x.png\" target=\"_blank\" classname=\"file-link-inner-post\"><b>btn_editPic@3x.png</b></a>\n\n        const node = super.create();\n        node.appendChild(prefixTag);\n        node.appendChild(linkTag);\n\n        return node;\n    }\n\n    static value(node) {\n        const linkTag = node.querySelector('a');\n        return linkTag.getAttribute('href');\n    }\n\n}\n\nFileBlot.blotName = 'file';\nFileBlot.tagName = 'p';\nFileBlot.className = 'file-inner-post';\nQuill.register(FileBlot);\n\nclass PollBlot extends BlockEmbed {\n\n    static create(value) {\n        const prefixTag = document.createElement('span');\n        prefixTag.innerText = \"\";\n\n        const bTag = document.createElement('b');\n        bTag.innerText = value.title;\n\n        const node = super.create();\n        node.setAttribute('id', value.id);\n        node.appendChild(prefixTag);\n        node.appendChild(bTag);\n\n        return node;\n    }\n\n    static value(node) {\n        const id = node.getAttribute('id');\n        const bTag = node.querySelector('b');\n        const title = bTag.innerText;\n        return { id, title };\n    }\n\n}\n\nPollBlot.blotName = 'poll';\nPollBlot.tagName = 'p';\nPollBlot.className = 'poll-inner-post';\nQuill.register(PollBlot);\n\nclass QuillEditor extends React.Component {\n\n    bandId;\n    placeholder;\n    onEditorChange;\n    onFilesChange;\n    onPollsChange;\n    _isMounted;\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            editorHtml: __ISMSIE__ ? \"<p>&nbsp;</p>\" : \"\",\n            files: [],\n        };\n\n        this.reactQuillRef = null;\n\n        this.inputOpenImageRef = React.createRef();\n        this.inputOpenVideoRef = React.createRef();\n        this.inputOpenFileRef = React.createRef();\n    }\n\n    componentDidMount() {\n        this._isMounted = true;\n    }\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n\n    handleChange = (html) => {\n        console.log('html', html)\n        // https://youtu.be/BbR-QCoKngE\n        // https://www.youtube.com/embed/ZwKhufmMxko\n        // https://tv.naver.com/v/9176888\n        // renderToStaticMarkup(ReactHtmlParser(html, options));\n\n        this.setState({\n            editorHtml: html\n        }, () => {\n            this.props.onEditorChange(this.state.editorHtml);\n        });\n    };\n\n    // I V F P insertImage: this.imageHandler inputOpenImageRef. \n    imageHandler = () => {\n        this.inputOpenImageRef.current.click();\n    };\n\n    videoHandler = () => {\n        this.inputOpenVideoRef.current.click();\n    };\n\n    fileHandler = () => {\n        this.inputOpenFileRef.current.click();\n    };\n\n\n    insertImage = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (e.currentTarget && e.currentTarget.files && e.currentTarget.files.length > 0) {\n            const file = e.currentTarget.files[0];\n\n            let formData = new FormData();\n            const config = {\n                header: { 'content-type': 'multipart/form-data' }\n            }\n            formData.append(\"file\", file);\n\n            axios.post('/api/blog/uploadfiles', formData, config)\n                .then(response => {\n                    if (response.data.success) {\n\n                        const quill = this.reactQuillRef.getEditor();\n                        quill.focus();\n\n                        let range = quill.getSelection();\n                        let position = range ? range.index : 0;\n\n        \n                        quill.insertEmbed(position, \"image\", { src: \"http://localhost:5000/\" + response.data.url, alt: response.data.fileName });\n                        quill.setSelection(position + 1);\n\n                        if (this._isMounted) {\n                            this.setState({\n                                files: [...this.state.files, file]\n                            }, () => { this.props.onFilesChange(this.state.files) });\n                        }\n                    } else {\n                        return alert('failed to upload file')\n                    }\n                })\n        }\n    };\n\n    insertVideo = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (e.currentTarget && e.currentTarget.files && e.currentTarget.files.length > 0) {\n            const file = e.currentTarget.files[0];\n\n            let formData = new FormData();\n            const config = {\n                header: { 'content-type': 'multipart/form-data' }\n            }\n            formData.append(\"file\", file);\n\n            axios.post('/api/blog/uploadfiles', formData, config)\n                .then(response => {\n                    if (response.data.success) {\n\n                        const quill = this.reactQuillRef.getEditor();\n                        quill.focus();\n\n                        let range = quill.getSelection();\n                        let position = range ? range.index : 0;\n                        quill.insertEmbed(position, \"video\", { src: \"http://localhost:5000/\" + response.data.url, title: response.data.fileName });\n                        quill.setSelection(position + 1);\n\n                        if (this._isMounted) {\n                            this.setState({\n                                files: [...this.state.files, file]\n                            }, () => { this.props.onFilesChange(this.state.files) });\n                        }\n                    } else {\n                        return alert('failed to upload file')\n                    }\n                })\n        }\n    }\n\n    insertFile = (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (e.currentTarget && e.currentTarget.files && e.currentTarget.files.length > 0) {\n            const file = e.currentTarget.files[0];\n            console.log(file);\n\n            let formData = new FormData();\n            const config = {\n                header: { 'content-type': 'multipart/form-data' }\n            }\n            formData.append(\"file\", file);\n\n            axios.post('/api/blog/uploadfiles', formData, config)\n                .then(response => {\n                    if (response.data.success) {\n\n                        const quill = this.reactQuillRef.getEditor();\n                        quill.focus();\n\n                        let range = quill.getSelection();\n                        let position = range ? range.index : 0;\n                        quill.insertEmbed(position, \"file\", response.data.fileName);\n                        quill.setSelection(position + 1);\n\n                        if (this._isMounted) {\n                            this.setState({\n                                files: [...this.state.files, file]\n                            }, () => { this.props.onFilesChange(this.state.files) });\n                        }\n                    };\n                })\n        }\n    };\n\n    render() {\n        return (\n            <div>\n                <div id=\"toolbar\">\n                    <select className=\"ql-font\">\n                        <option data-value=\"serif\" />\n                        <option data-value=\"monospace\" />\n                    </select>\n                    <select className=\"ql-header\" defaultValue={\"\"} onChange={e => e.persist()}>\n                        <option value=\"1\" />\n                        <option value=\"2\" />\n                        <option value=\"\" />\n                    </select>\n                    <button className=\"ql-bold\" />\n                    <button className=\"ql-italic\" />\n                    <button className=\"ql-underline\" />\n                    <button className=\"ql-strike\" />\n                    <button class=\"ql-list\" value=\"ordered\" />\n                    <button class=\"ql-list\" value=\"bullet\" />\n                    <button class=\"ql-script\" value=\"sub\" />\n                    <button class=\"ql-script\" value=\"super\" />\n                    <button className=\"ql-insertImage\">\n                        I\n                    </button>\n                    <button className=\"ql-insertVideo\">\n                        V\n                    </button>\n                    {/* <button className=\"ql-insertFile\">\n                        F\n                    </button> */}\n                    <button className=\"ql-link\" />\n                    <button className=\"ql-code-block\" />\n                    <button className=\"ql-video\" />\n                    <button className=\"ql-blockquote\" />\n                    <button className=\"ql-clean\" />\n                    \n\n                    \n\n                </div>\n                <ReactQuill\n                    ref={(el) => { this.reactQuillRef = el }}\n                    theme={'snow'}\n                    onChange={this.handleChange}\n                    modules={this.modules}\n                    formats={this.formats}\n                    value={this.state.editorHtml}\n                    placeholder={this.props.placeholder}\n                />\n                <input type=\"file\" accept=\"image/*\" ref={this.inputOpenImageRef} style={{ display: \"none\" }} onChange={this.insertImage} />\n                <input type=\"file\" accept=\"video/*\" ref={this.inputOpenVideoRef} style={{ display: \"none\" }} onChange={this.insertVideo} />\n                <input type=\"file\" accept=\"*\" ref={this.inputOpenFileRef} style={{ display: \"none\" }} onChange={this.insertFile} />\n            </div>\n        )\n    }\n\n    modules = {\n        syntax: true,\n        toolbar: {\n            container: \"#toolbar\",\n            \n            handlers: {\n                insertImage: this.imageHandler,\n                insertVideo: this.videoHandler,\n                insertFile: this.fileHandler,\n                insertPoll: this.pollHandler,\n            }\n        },\n\n    };\n\n    formats = [\n        'font',\n        'header',\n        'bold', 'italic', 'underline', 'strike',\n        'image', 'video', 'file', 'link',\"code-block\", \"video\", \"blockquote\", \"clean\", \"list\", \"script\"\n    ];\n}\n\nexport default QuillEditor;\n"]},"metadata":{},"sourceType":"module"}