{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.filter_custom_operations.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _filter_builder = require(\"../filter_builder/filter_builder\");\n\nvar $ = require(\"../../core/renderer\");\n\nvar messageLocalization = require(\"../../localization/message\");\n\nvar extend = require(\"../../core/utils/extend\").extend;\n\nvar DataSource = require(\"../../data/data_source/data_source\").DataSource;\n\nvar deferredUtils = require(\"../../core/utils/deferred\");\n\nvar utils = require(\"../filter_builder/utils\");\n\nfunction baseOperation(grid) {\n  var calculateFilterExpression = function (filterValue, field, fields) {\n    var result = [];\n    var lastIndex = filterValue.length - 1;\n    filterValue && filterValue.forEach(function (value, index) {\n      if (utils.isCondition(value) || utils.isGroup(value)) {\n        var filterExpression = utils.getFilterExpression(value, fields, [], \"headerFilter\");\n        result.push(filterExpression);\n      } else {\n        result.push(utils.getFilterExpression([field.dataField, \"=\", value], fields, [], \"headerFilter\"));\n      }\n\n      index !== lastIndex && result.push(\"or\");\n    });\n\n    if (1 === result.length) {\n      result = result[0];\n    }\n\n    return result;\n  };\n\n  var getFullText = function (itemText, parentText) {\n    return parentText ? parentText + \"/\" + itemText : itemText;\n  };\n\n  var getSelectedItemsTexts = function getSelectedItemsTexts(items, parentText) {\n    var result = [];\n    items.forEach(function (item) {\n      if (item.items) {\n        var selectedItemsTexts = getSelectedItemsTexts(item.items, getFullText(item.text, parentText));\n        result = result.concat(selectedItemsTexts);\n      }\n\n      item.selected && result.push(getFullText(item.text, parentText));\n    });\n    return result;\n  };\n\n  var headerFilterController = grid && grid.getController(\"headerFilter\");\n\n  var customizeText = function (fieldInfo) {\n    var value = fieldInfo.value;\n    var column = grid.columnOption(fieldInfo.field.dataField);\n    var headerFilter = column && column.headerFilter;\n    var lookup = column && column.lookup;\n\n    if (headerFilter && headerFilter.dataSource || lookup && lookup.dataSource) {\n      column = extend({}, column, {\n        filterType: \"include\",\n        filterValues: [value]\n      });\n      var dataSourceOptions = headerFilterController.getDataSource(column);\n      dataSourceOptions.paginate = false;\n      var dataSource = new DataSource(dataSourceOptions);\n      var result = new deferredUtils.Deferred();\n      var key = dataSource.store().key();\n\n      if (key) {\n        dataSource.filter([key, \"=\", fieldInfo.value]);\n      }\n\n      dataSource.load().done(function (items) {\n        result.resolve(getSelectedItemsTexts(items)[0]);\n      });\n      return result;\n    } else {\n      var text = headerFilterController.getHeaderItemText(value, column, 0, grid.option(\"headerFilter\"));\n      return text;\n    }\n  };\n\n  return {\n    dataTypes: [\"string\", \"date\", \"datetime\", \"number\", \"boolean\", \"object\"],\n    calculateFilterExpression: calculateFilterExpression,\n    editorTemplate: function (conditionInfo, container) {\n      var div = $(\"<div>\").addClass(\"dx-filterbuilder-item-value-text\").appendTo(container);\n      var column = extend(true, {}, grid.columnOption(conditionInfo.field.dataField));\n      (0, _filter_builder.renderValueText)(div, conditionInfo.text && conditionInfo.text.split(\"|\"));\n\n      var setValue = function (value) {\n        conditionInfo.setValue(value);\n      };\n\n      column.filterType = \"include\";\n      column.filterValues = conditionInfo.value ? conditionInfo.value.slice() : [];\n      headerFilterController.showHeaderFilterMenuBase({\n        columnElement: div,\n        column: column,\n        apply: function () {\n          setValue(this.filterValues);\n          headerFilterController.hideHeaderFilterMenu();\n          conditionInfo.closeEditor();\n        },\n        onHidden: function () {\n          conditionInfo.closeEditor();\n        },\n        isFilterBuilder: true\n      });\n      return container;\n    },\n    customizeText: customizeText\n  };\n}\n\nfunction anyOf(grid) {\n  return extend(baseOperation(grid), {\n    name: \"anyof\",\n    icon: \"selectall\",\n    caption: messageLocalization.format(\"dxFilterBuilder-filterOperationAnyOf\")\n  });\n}\n\nfunction noneOf(grid) {\n  var baseOp = baseOperation(grid);\n  return extend({}, baseOp, {\n    calculateFilterExpression: function (filterValue, field, fields) {\n      var baseFilter = baseOp.calculateFilterExpression(filterValue, field, fields);\n\n      if (!baseFilter || 0 === baseFilter.length) {\n        return null;\n      }\n\n      return \"!\" === baseFilter[0] ? baseFilter : [\"!\", baseFilter];\n    },\n    name: \"noneof\",\n    icon: \"unselectall\",\n    caption: messageLocalization.format(\"dxFilterBuilder-filterOperationNoneOf\")\n  });\n}\n\nexports.anyOf = anyOf;\nexports.noneOf = noneOf;","map":null,"metadata":{},"sourceType":"script"}