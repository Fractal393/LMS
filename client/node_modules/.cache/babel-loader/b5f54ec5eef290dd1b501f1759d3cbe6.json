{"ast":null,"code":"'use strict';\n\nvar ensureCallable = function (fn) {\n  if (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n  return fn;\n};\n\nvar byObserver = function (Observer) {\n  var node = document.createTextNode(''),\n      queue,\n      currentQueue,\n      i = 0;\n  new Observer(function () {\n    var callback;\n\n    if (!queue) {\n      if (!currentQueue) return;\n      queue = currentQueue;\n    } else if (currentQueue) {\n      queue = currentQueue.concat(queue);\n    }\n\n    currentQueue = queue;\n    queue = null;\n\n    if (typeof currentQueue === 'function') {\n      callback = currentQueue;\n      currentQueue = null;\n      callback();\n      return;\n    }\n\n    node.data = i = ++i % 2; // Invoke other batch, to handle leftover callbacks in case of crash\n\n    while (currentQueue) {\n      callback = currentQueue.shift();\n      if (!currentQueue.length) currentQueue = null;\n      callback();\n    }\n  }).observe(node, {\n    characterData: true\n  });\n  return function (fn) {\n    ensureCallable(fn);\n\n    if (queue) {\n      if (typeof queue === 'function') queue = [queue, fn];else queue.push(fn);\n      return;\n    }\n\n    queue = fn;\n    node.data = i = ++i % 2;\n  };\n};\n\nmodule.exports = function () {\n  // Node.js\n  if (typeof process === 'object' && process && typeof process.nextTick === 'function') {\n    return process.nextTick;\n  } // queueMicrotask\n\n\n  if (typeof queueMicrotask === \"function\") {\n    return function (cb) {\n      queueMicrotask(ensureCallable(cb));\n    };\n  } // MutationObserver\n\n\n  if (typeof document === 'object' && document) {\n    if (typeof MutationObserver === 'function') return byObserver(MutationObserver);\n    if (typeof WebKitMutationObserver === 'function') return byObserver(WebKitMutationObserver);\n  } // W3C Draft\n  // http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html\n\n\n  if (typeof setImmediate === 'function') {\n    return function (cb) {\n      setImmediate(ensureCallable(cb));\n    };\n  } // Wide available standard\n\n\n  if (typeof setTimeout === 'function' || typeof setTimeout === 'object') {\n    return function (cb) {\n      setTimeout(ensureCallable(cb), 0);\n    };\n  }\n\n  return null;\n}();","map":null,"metadata":{},"sourceType":"script"}