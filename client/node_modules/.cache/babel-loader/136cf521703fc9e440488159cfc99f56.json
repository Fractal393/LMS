{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.columns_view.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _dom_adapter = require(\"../../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _events_engine = require(\"../../events/core/events_engine\");\n\nvar _events_engine2 = _interopRequireDefault(_events_engine);\n\nvar _element_data = require(\"../../core/element_data\");\n\nvar _element_data2 = _interopRequireDefault(_element_data);\n\nvar _pointer = require(\"../../events/pointer\");\n\nvar _pointer2 = _interopRequireDefault(_pointer);\n\nvar _click = require(\"../../events/click\");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _double_click = require(\"../../events/double_click\");\n\nvar _double_click2 = _interopRequireDefault(_double_click);\n\nvar _browser = require(\"../../core/utils/browser\");\n\nvar _browser2 = _interopRequireDefault(_browser);\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _style = require(\"../../core/utils/style\");\n\nvar _style2 = _interopRequireDefault(_style);\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _type2 = _interopRequireDefault(_type);\n\nvar _position = require(\"../../core/utils/position\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\n\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\n\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\n\nvar _uiGrid_core4 = require(\"./ui.grid_core.column_state_mixin\");\n\nvar _uiGrid_core5 = _interopRequireDefault(_uiGrid_core4);\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar SCROLL_CONTAINER_CLASS = \"scroll-container\";\nvar GROUP_SPACE_CLASS = \"group-space\";\nvar CONTENT_CLASS = \"content\";\nvar TABLE_CLASS = \"table\";\nvar TABLE_FIXED_CLASS = \"table-fixed\";\nvar CONTENT_FIXED_CLASS = \"content-fixed\";\nvar ROW_CLASS = \"dx-row\";\nvar GROUP_ROW_CLASS = \"dx-group-row\";\nvar DETAIL_ROW_CLASS = \"dx-master-detail-row\";\nvar FILTER_ROW_CLASS = \"filter-row\";\nvar CELL_UPDATED_ANIMATION_CLASS = \"cell-updated-animation\";\nvar HIDDEN_COLUMNS_WIDTH = \"0.0001px\";\nvar CELL_HINT_VISIBLE = \"dxCellHintVisible\";\nvar FORM_FIELD_ITEM_CONTENT_CLASS = \"dx-field-item-content\";\nvar appendElementTemplate = {\n  render: function (options) {\n    options.container.append(options.content);\n  }\n};\n\nvar subscribeToRowEvents = function (that, $table) {\n  var touchTarget;\n  var touchCurrentTarget;\n  var timeoutId;\n\n  function clearTouchTargets(timeout) {\n    return setTimeout(function () {\n      touchTarget = touchCurrentTarget = null;\n    }, timeout);\n  }\n\n  _events_engine2.default.on($table, \"touchstart touchend\", \".dx-row\", function (e) {\n    clearTimeout(timeoutId);\n\n    if (\"touchstart\" === e.type) {\n      touchTarget = e.target;\n      touchCurrentTarget = e.currentTarget;\n      timeoutId = clearTouchTargets(1e3);\n    } else {\n      timeoutId = clearTouchTargets();\n    }\n  });\n\n  _events_engine2.default.on($table, [_click2.default.name, _double_click2.default.name, _pointer2.default.down].join(\" \"), \".dx-row\", {\n    useNative: that._isNativeClick()\n  }, that.createAction(function (e) {\n    var event = e.event;\n\n    if (touchTarget) {\n      event.target = touchTarget;\n      event.currentTarget = touchCurrentTarget;\n    }\n\n    if (!(0, _renderer2.default)(event.target).closest(\"a\").length) {\n      e.rowIndex = that.getRowIndex(event.currentTarget);\n\n      if (e.rowIndex >= 0) {\n        e.rowElement = (0, _dom.getPublicElement)((0, _renderer2.default)(event.currentTarget));\n        e.columns = that.getColumns();\n\n        if (event.type === _pointer2.default.down) {\n          that._rowPointerDown(e);\n        } else {\n          if (event.type === _click2.default.name) {\n            that._rowClick(e);\n          } else {\n            that._rowDblClick(e);\n          }\n        }\n      }\n    }\n  }));\n};\n\nvar getWidthStyle = function (width) {\n  if (\"auto\" === width) {\n    return \"\";\n  }\n\n  return _type2.default.isNumeric(width) ? width + \"px\" : width;\n};\n\nvar setCellWidth = function (cell, column, width) {\n  cell.style.width = cell.style.maxWidth = \"auto\" === column.width ? \"\" : width;\n};\n\nvar copyAttributes = function (element, newElement) {\n  if (!element || !newElement) {\n    return;\n  }\n\n  var oldAttributes = element.attributes;\n  var newAttributes = newElement.attributes;\n  var i;\n\n  for (i = 0; i < oldAttributes.length; i++) {\n    var name = oldAttributes[i].nodeName;\n\n    if (!newElement.hasAttribute(name)) {\n      element.removeAttribute(name);\n    }\n  }\n\n  for (i = 0; i < newAttributes.length; i++) {\n    element.setAttribute(newAttributes[i].nodeName, newAttributes[i].nodeValue);\n  }\n};\n\nexports.ColumnsView = _uiGrid_core2.default.View.inherit(_uiGrid_core5.default).inherit({\n  _createScrollableOptions: function () {\n    var that = this;\n    var scrollingOptions = that.option(\"scrolling\");\n    var useNativeScrolling = that.option(\"scrolling.useNative\");\n    var options = (0, _extend.extend)({\n      pushBackValue: 0\n    }, scrollingOptions, {\n      direction: \"both\",\n      bounceEnabled: false,\n      useKeyboard: false\n    });\n\n    if (void 0 === useNativeScrolling) {\n      useNativeScrolling = true;\n    }\n\n    if (\"auto\" === useNativeScrolling) {\n      delete options.useNative;\n      delete options.useSimulatedScrollbar;\n    } else {\n      options.useNative = !!useNativeScrolling;\n      options.useSimulatedScrollbar = !useNativeScrolling;\n    }\n\n    return options;\n  },\n  _updateCell: function ($cell, parameters) {\n    if (parameters.rowType) {\n      this._cellPrepared($cell, parameters);\n    }\n  },\n  _createCell: function (options) {\n    var column = options.column;\n    var alignment = column.alignment || (0, _position.getDefaultAlignment)(this.option(\"rtlEnabled\"));\n\n    var cell = _dom_adapter2.default.createElement(\"td\");\n\n    cell.style.textAlign = alignment;\n    var $cell = (0, _renderer2.default)(cell);\n\n    if (\"data\" === options.rowType && column.headerId && !column.type) {\n      if (this.component.option(\"showColumnHeaders\")) {\n        this.setAria(\"describedby\", column.headerId, $cell);\n      }\n    }\n\n    if (column.cssClass) {\n      $cell.addClass(column.cssClass);\n    }\n\n    if (\"expand\" === column.command) {\n      $cell.addClass(column.cssClass);\n      $cell.addClass(this.addWidgetPrefix(GROUP_SPACE_CLASS));\n    }\n\n    if (column.colspan > 1) {\n      $cell.attr(\"colSpan\", column.colspan);\n    } else {\n      if (!column.isBand && \"auto\" !== column.visibleWidth && !this.option(\"legacyRendering\") && this.option(\"columnAutoWidth\")) {\n        if (column.width || column.minWidth) {\n          cell.style.minWidth = getWidthStyle(column.minWidth || column.width);\n        }\n\n        if (column.width) {\n          setCellWidth(cell, column, getWidthStyle(column.width));\n        }\n      }\n    }\n\n    return $cell;\n  },\n  _createRow: function (rowObject) {\n    var $element = (0, _renderer2.default)(\"<tr>\").addClass(ROW_CLASS);\n    this.setAria(\"role\", \"row\", $element);\n    return $element;\n  },\n  _isAltRow: function (row) {\n    return row && row.dataIndex % 2 === 1;\n  },\n  _createTable: function (columns, isAppend) {\n    var that = this;\n    var $table = (0, _renderer2.default)(\"<table>\").addClass(that.addWidgetPrefix(TABLE_CLASS)).addClass(that.addWidgetPrefix(TABLE_FIXED_CLASS));\n\n    if (columns && !isAppend) {\n      $table.append(that._createColGroup(columns));\n\n      if (_browser2.default.safari) {\n        $table.append((0, _renderer2.default)(\"<thead>\").append(\"<tr>\"));\n      }\n\n      that.setAria(\"role\", \"presentation\", $table);\n    } else {\n      that.setAria(\"hidden\", true, $table);\n    }\n\n    this.setAria(\"role\", \"presentation\", (0, _renderer2.default)(\"<tbody>\").appendTo($table));\n\n    if (isAppend) {\n      return $table;\n    }\n\n    if (_browser2.default.mozilla) {\n      _events_engine2.default.on($table, \"mousedown\", \"td\", function (e) {\n        if (e.ctrlKey) {\n          e.preventDefault();\n        }\n      });\n    }\n\n    if (that.option(\"cellHintEnabled\")) {\n      _events_engine2.default.on($table, \"mousemove\", \".dx-row > td\", this.createAction(function (args) {\n        var e = args.event;\n        var $element = (0, _renderer2.default)(e.target);\n        var $cell = (0, _renderer2.default)(e.currentTarget);\n        var $row = $cell.parent();\n        var isDataRow = $row.hasClass(\"dx-data-row\");\n        var isHeaderRow = $row.hasClass(\"dx-header-row\");\n        var isGroupRow = $row.hasClass(GROUP_ROW_CLASS);\n        var isMasterDetailRow = $row.hasClass(DETAIL_ROW_CLASS);\n        var isFilterRow = $row.hasClass(that.addWidgetPrefix(FILTER_ROW_CLASS));\n\n        var visibleColumns = that._columnsController.getVisibleColumns();\n\n        var rowOptions = $row.data(\"options\");\n        var columnIndex = $cell.index();\n        var cellOptions = rowOptions && rowOptions.cells && rowOptions.cells[columnIndex];\n        var column = cellOptions ? cellOptions.column : visibleColumns[columnIndex];\n        var msieCorrection = _browser2.default.msie ? 1 : 0;\n\n        if (!isMasterDetailRow && !isFilterRow && (!isDataRow || isDataRow && column && !column.cellTemplate) && (!isHeaderRow || isHeaderRow && column && !column.headerCellTemplate) && (!isGroupRow || isGroupRow && column && (void 0 === column.groupIndex || !column.groupCellTemplate))) {\n          if ($element.data(CELL_HINT_VISIBLE)) {\n            $element.removeAttr(\"title\");\n            $element.data(CELL_HINT_VISIBLE, false);\n          }\n\n          var difference = $element[0].scrollWidth - $element[0].clientWidth - msieCorrection;\n\n          if (difference > 0 && !_type2.default.isDefined($element.attr(\"title\"))) {\n            $element.attr(\"title\", $element.text());\n            $element.data(CELL_HINT_VISIBLE, true);\n          }\n        }\n      }));\n    }\n\n    var getOptions = function (event) {\n      var $cell = (0, _renderer2.default)(event.currentTarget);\n      var $fieldItemContent = (0, _renderer2.default)(event.target).closest(\".\" + FORM_FIELD_ITEM_CONTENT_CLASS);\n      var rowOptions = $cell.parent().data(\"options\");\n      var options = rowOptions && rowOptions.cells && rowOptions.cells[$cell.index()];\n\n      if (!$cell.closest(\"table\").is(event.delegateTarget)) {\n        return;\n      }\n\n      var resultOptions = (0, _extend.extend)({}, options, {\n        cellElement: (0, _dom.getPublicElement)($cell),\n        event: event,\n        eventType: event.type\n      });\n\n      if ($fieldItemContent.length) {\n        var formItemOptions = $fieldItemContent.data(\"dx-form-item\");\n\n        if (formItemOptions.column) {\n          resultOptions.column = formItemOptions.column;\n          resultOptions.columnIndex = that._columnsController.getVisibleIndex(resultOptions.column.index);\n        }\n      }\n\n      return resultOptions;\n    };\n\n    _events_engine2.default.on($table, \"mouseover\", \".dx-row > td\", function (e) {\n      var options = getOptions(e);\n      options && that.executeAction(\"onCellHoverChanged\", options);\n    });\n\n    _events_engine2.default.on($table, \"mouseout\", \".dx-row > td\", function (e) {\n      var options = getOptions(e);\n      options && that.executeAction(\"onCellHoverChanged\", options);\n    });\n\n    _events_engine2.default.on($table, _click2.default.name, \".dx-row > td\", function (e) {\n      var options = getOptions(e);\n      options && that.executeAction(\"onCellClick\", options);\n    });\n\n    _events_engine2.default.on($table, _double_click2.default.name, \".dx-row > td\", function (e) {\n      var options = getOptions(e);\n      options && that.executeAction(\"onCellDblClick\", options);\n    });\n\n    subscribeToRowEvents(that, $table);\n    return $table;\n  },\n  _isNativeClick: _common.noop,\n  _rowPointerDown: _common.noop,\n  _rowClick: _common.noop,\n  _rowDblClick: _common.noop,\n  _createColGroup: function (columns) {\n    var colgroupElement = (0, _renderer2.default)(\"<colgroup>\");\n\n    for (var i = 0; i < columns.length; i++) {\n      var colspan = columns[i].colspan || 1;\n\n      for (var j = 0; j < colspan; j++) {\n        colgroupElement.append(this._createCol(columns[i]));\n      }\n    }\n\n    return colgroupElement;\n  },\n  _createCol: function (column) {\n    var width = column.visibleWidth || column.width;\n\n    if (\"adaptiveHidden\" === width) {\n      width = HIDDEN_COLUMNS_WIDTH;\n    }\n\n    var col = (0, _renderer2.default)(\"<col>\");\n\n    _style2.default.setWidth(col, width);\n\n    return col;\n  },\n  renderDelayedTemplates: function () {\n    var delayedTemplates = this._delayedTemplates;\n    var syncTemplates = delayedTemplates.filter(function (template) {\n      return !template.async;\n    });\n    var asyncTemplates = delayedTemplates.filter(function (template) {\n      return template.async;\n    });\n    this._delayedTemplates = [];\n\n    this._renderDelayedTemplatesCore(syncTemplates);\n\n    this._renderDelayedTemplatesCoreAsync(asyncTemplates);\n  },\n  _renderDelayedTemplatesCoreAsync: function (templates) {\n    var that = this;\n\n    if (templates.length) {\n      (0, _window.getWindow)().setTimeout(function () {\n        that._renderDelayedTemplatesCore(templates, true);\n      });\n    }\n  },\n  _renderDelayedTemplatesCore: function (templates, isAsync) {\n    var date = new Date();\n\n    while (templates.length) {\n      var templateParameters = templates.shift();\n      var options = templateParameters.options;\n\n      var doc = _dom_adapter2.default.getDocument();\n\n      if (!isAsync || (0, _renderer2.default)(options.container).closest(doc).length) {\n        templateParameters.template.render(options);\n      }\n\n      if (isAsync && new Date() - date > 30) {\n        this._renderDelayedTemplatesCoreAsync(templates);\n\n        break;\n      }\n    }\n\n    if (!templates.length && this._delayedTemplates.length) {\n      this.renderDelayedTemplates();\n    }\n  },\n  _processTemplate: function (template) {\n    var that = this;\n    var renderingTemplate;\n\n    if (template && template.render && !_type2.default.isRenderer(template)) {\n      renderingTemplate = {\n        allowRenderToDetachedContainer: template.allowRenderToDetachedContainer,\n        render: function (options) {\n          template.render(options.container, options.model);\n          options.deferred && options.deferred.resolve();\n        }\n      };\n    } else {\n      if (_type2.default.isFunction(template)) {\n        renderingTemplate = {\n          render: function (options) {\n            var renderedTemplate = template((0, _dom.getPublicElement)(options.container), options.model);\n\n            if (renderedTemplate && (renderedTemplate.nodeType || _type2.default.isRenderer(renderedTemplate))) {\n              options.container.append(renderedTemplate);\n            }\n\n            options.deferred && options.deferred.resolve();\n          }\n        };\n      } else {\n        var templateID = _type2.default.isString(template) ? template : (0, _renderer2.default)(template).attr(\"id\");\n\n        if (!templateID) {\n          renderingTemplate = that.getTemplate(template);\n        } else {\n          if (!that._templatesCache[templateID]) {\n            that._templatesCache[templateID] = that.getTemplate(template);\n          }\n\n          renderingTemplate = that._templatesCache[templateID];\n        }\n      }\n    }\n\n    return renderingTemplate;\n  },\n  renderTemplate: function (container, template, options, allowRenderToDetachedContainer) {\n    var that = this;\n\n    var renderingTemplate = that._processTemplate(template, options);\n\n    var column = options.column;\n    var isDataRow = \"data\" === options.rowType;\n    var templateDeferred = new _deferred.Deferred();\n    var templateOptions = {\n      container: container,\n      model: options,\n      deferred: templateDeferred,\n      onRendered: function () {\n        templateDeferred.resolve();\n      }\n    };\n\n    if (renderingTemplate) {\n      options.component = that.component;\n      var async = column && (column.renderAsync && isDataRow || that.option(\"renderAsync\") && (false !== column.renderAsync && (column.command || column.showEditorAlways) && isDataRow || \"filter\" === options.rowType));\n\n      if ((renderingTemplate.allowRenderToDetachedContainer || allowRenderToDetachedContainer) && !async) {\n        renderingTemplate.render(templateOptions);\n      } else {\n        that._delayedTemplates.push({\n          template: renderingTemplate,\n          options: templateOptions,\n          async: async\n        });\n      }\n    } else {\n      templateDeferred.reject();\n    }\n\n    return templateDeferred.promise();\n  },\n  _getBodies: function (tableElement) {\n    return (0, _renderer2.default)(tableElement).children(\"tbody\").not(\".dx-header\").not(\".dx-footer\");\n  },\n  _wrapRowIfNeed: function ($table, $row) {\n    var $tBodies = this.option(\"rowTemplate\") && this._getBodies(this._tableElement || $table);\n\n    if ($tBodies && $tBodies.filter(\".\" + ROW_CLASS).length) {\n      var $tbody = (0, _renderer2.default)(\"<tbody>\").addClass($row.attr(\"class\"));\n      this.setAria(\"role\", \"presentation\", $tbody);\n      return $tbody.append($row);\n    }\n\n    return $row;\n  },\n  _appendRow: function ($table, $row, appendTemplate) {\n    appendTemplate = appendTemplate || appendElementTemplate;\n    appendTemplate.render({\n      content: $row,\n      container: $table\n    });\n  },\n  _resizeCore: function () {\n    var scrollLeft = this._scrollLeft;\n\n    if (scrollLeft >= 0) {\n      this._scrollLeft = 0;\n      this.scrollTo({\n        left: scrollLeft\n      });\n    }\n  },\n  _renderCore: function (e) {\n    var $root = this.element().parent();\n\n    if (!$root || $root.parent().length) {\n      this.renderDelayedTemplates(e);\n    }\n  },\n  _renderTable: function (options) {\n    options = options || {};\n    options.columns = this._columnsController.getVisibleColumns();\n    var changeType = options.change && options.change.changeType;\n\n    var $table = this._createTable(options.columns, \"append\" === changeType || \"prepend\" === changeType || \"update\" === changeType);\n\n    this._renderRows($table, options);\n\n    return $table;\n  },\n  _renderRows: function ($table, options) {\n    var that = this;\n\n    var rows = that._getRows(options.change);\n\n    var columnIndices = options.change && options.change.columnIndices || [];\n    var changeTypes = options.change && options.change.changeTypes || [];\n\n    for (var i = 0; i < rows.length; i++) {\n      that._renderRow($table, (0, _extend.extend)({\n        row: rows[i],\n        columnIndices: columnIndices[i],\n        changeType: changeTypes[i]\n      }, options));\n    }\n  },\n  _renderRow: function ($table, options) {\n    if (!options.columnIndices) {\n      options.row.cells = [];\n    }\n\n    var $row = this._createRow(options.row);\n\n    var $wrappedRow = this._wrapRowIfNeed($table, $row);\n\n    if (\"remove\" !== options.changeType) {\n      this._renderCells($row, options);\n    }\n\n    this._appendRow($table, $wrappedRow);\n\n    var rowOptions = (0, _extend.extend)({\n      columns: options.columns\n    }, options.row);\n\n    this._addWatchMethod(rowOptions, options.row);\n\n    this._rowPrepared($wrappedRow, rowOptions, options.row);\n  },\n  _needRenderCell: function (columnIndex, columnIndices) {\n    return !columnIndices || columnIndices.indexOf(columnIndex) >= 0;\n  },\n  _renderCells: function ($row, options) {\n    var that = this;\n    var columnIndex = 0;\n    var row = options.row;\n    var columns = options.columns;\n\n    for (var i = 0; i < columns.length; i++) {\n      if (this._needRenderCell(i, options.columnIndices)) {\n        that._renderCell($row, (0, _extend.extend)({\n          column: columns[i],\n          columnIndex: columnIndex,\n          value: row.values && row.values[columnIndex],\n          oldValue: row.oldValues && row.oldValues[columnIndex]\n        }, options));\n      }\n\n      if (columns[i].colspan > 1) {\n        columnIndex += columns[i].colspan;\n      } else {\n        columnIndex++;\n      }\n    }\n  },\n  _updateCells: function ($rowElement, $newRowElement, columnIndices) {\n    var $cells = $rowElement.children();\n    var $newCells = $newRowElement.children();\n    var highlightChanges = this.option(\"highlightChanges\");\n    var cellUpdatedClass = this.addWidgetPrefix(CELL_UPDATED_ANIMATION_CLASS);\n    columnIndices.forEach(function (columnIndex, index) {\n      var $cell = $cells.eq(columnIndex);\n      var $newCell = $newCells.eq(index);\n      $cell.replaceWith($newCell);\n\n      if (highlightChanges && !$newCell.hasClass(\"dx-command-expand\")) {\n        $newCell.addClass(cellUpdatedClass);\n      }\n    });\n    copyAttributes($rowElement.get(0), $newRowElement.get(0));\n  },\n  _setCellAriaAttributes: function ($cell, cellOptions) {\n    if (\"freeSpace\" !== cellOptions.rowType) {\n      this.setAria(\"selected\", false, $cell);\n      this.setAria(\"role\", \"gridcell\", $cell);\n      this.setAria(\"colindex\", cellOptions.columnIndex + 1, $cell);\n    }\n  },\n  _renderCell: function ($row, options) {\n    var cellOptions = this._getCellOptions(options);\n\n    if (options.columnIndices) {\n      if (options.row.cells) {\n        options.row.cells[cellOptions.columnIndex] = cellOptions;\n      }\n    } else {\n      options.row.cells.push(cellOptions);\n    }\n\n    var $cell = this._createCell(cellOptions);\n\n    this._setCellAriaAttributes($cell, cellOptions);\n\n    this._renderCellContent($cell, cellOptions);\n\n    $row.get(0).appendChild($cell.get(0));\n    return $cell;\n  },\n  _renderCellContent: function ($cell, options) {\n    var _this = this;\n\n    var template = this._getCellTemplate(options);\n\n    (0, _deferred.when)(!template || this.renderTemplate($cell, template, options)).done(function () {\n      _this._updateCell($cell, options);\n    });\n  },\n  _getCellTemplate: function () {},\n  _getRows: function () {\n    return [];\n  },\n  _getCellOptions: function (options) {\n    var cellOptions = {\n      column: options.column,\n      columnIndex: options.columnIndex,\n      rowType: options.row.rowType,\n      isAltRow: this._isAltRow(options.row)\n    };\n\n    this._addWatchMethod(cellOptions);\n\n    return cellOptions;\n  },\n  _addWatchMethod: function (options, source) {\n    if (!this.option(\"repaintChangesOnly\")) {\n      return;\n    }\n\n    var watchers = [];\n    source = source || options;\n\n    source.watch = source.watch || function (getter, updateFunc) {\n      var oldValue = getter(source.data);\n\n      var watcher = function (row) {\n        var newValue = getter(source.data);\n\n        if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\n          if (row) {\n            updateFunc(newValue, oldValue);\n          }\n\n          oldValue = newValue;\n        }\n      };\n\n      watchers.push(watcher);\n\n      var stopWatch = function () {\n        var index = watchers.indexOf(watcher);\n\n        if (index >= 0) {\n          watchers.splice(index, 1);\n        }\n      };\n\n      return stopWatch;\n    };\n\n    source.update = source.update || function (row) {\n      if (row) {\n        this.data = options.data = row.data;\n        this.rowIndex = options.rowIndex = row.rowIndex;\n        this.dataIndex = options.dataIndex = row.dataIndex;\n        this.isExpanded = options.isExpanded = row.isExpanded;\n\n        if (options.row) {\n          options.row = row;\n        }\n      }\n\n      watchers.forEach(function (watcher) {\n        watcher(row);\n      });\n    };\n\n    if (source !== options) {\n      options.watch = source.watch.bind(source);\n    }\n\n    return options;\n  },\n  _cellPrepared: function (cell, options) {\n    options.cellElement = (0, _dom.getPublicElement)((0, _renderer2.default)(cell));\n    this.executeAction(\"onCellPrepared\", options);\n  },\n  _rowPrepared: function ($row, options) {\n    _element_data2.default.data($row.get(0), \"options\", options);\n\n    options.rowElement = (0, _dom.getPublicElement)($row);\n    this.executeAction(\"onRowPrepared\", options);\n  },\n  _columnOptionChanged: function (e) {\n    var optionNames = e.optionNames;\n\n    if ((0, _uiGrid_core3.checkChanges)(optionNames, [\"width\", \"visibleWidth\"])) {\n      var visibleColumns = this._columnsController.getVisibleColumns();\n\n      var widths = _iterator2.default.map(visibleColumns, function (column) {\n        var width = column.visibleWidth || column.width;\n        return _type2.default.isDefined(width) ? width : \"auto\";\n      });\n\n      this.setColumnWidths({\n        widths: widths,\n        optionNames: optionNames\n      });\n      return;\n    }\n\n    if (!this._requireReady) {\n      this.render();\n    }\n  },\n  getCellIndex: function ($cell) {\n    var cellIndex = $cell.length ? $cell[0].cellIndex : -1;\n    return cellIndex;\n  },\n  getTableElements: function () {\n    return this._tableElement || (0, _renderer2.default)();\n  },\n  _getTableElement: function () {\n    return this._tableElement;\n  },\n  _setTableElement: function (tableElement) {\n    this._tableElement = tableElement;\n  },\n  optionChanged: function (args) {\n    this.callBase(args);\n\n    switch (args.name) {\n      case \"cellHintEnabled\":\n      case \"onCellPrepared\":\n      case \"onRowPrepared\":\n      case \"onCellHoverChanged\":\n        this._invalidate(true, true);\n\n        args.handled = true;\n    }\n  },\n  init: function () {\n    var that = this;\n    that._scrollLeft = -1;\n    that._columnsController = that.getController(\"columns\");\n    that._dataController = that.getController(\"data\");\n    that._delayedTemplates = [];\n    that._templatesCache = {};\n    that.createAction(\"onCellClick\");\n    that.createAction(\"onRowClick\");\n    that.createAction(\"onCellDblClick\");\n    that.createAction(\"onRowDblClick\");\n    that.createAction(\"onCellHoverChanged\", {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n    that.createAction(\"onCellPrepared\", {\n      excludeValidators: [\"disabled\", \"readOnly\"],\n      category: \"rendering\"\n    });\n    that.createAction(\"onRowPrepared\", {\n      excludeValidators: [\"disabled\", \"readOnly\"],\n      category: \"rendering\",\n      afterExecute: function (e) {\n        that._afterRowPrepared(e);\n      }\n    });\n\n    that._columnsController.columnsChanged.add(that._columnOptionChanged.bind(that));\n\n    that._dataController && that._dataController.changed.add(that._handleDataChanged.bind(that));\n  },\n  _afterRowPrepared: _common.noop,\n  _handleDataChanged: function () {},\n  callbackNames: function () {\n    return [\"scrollChanged\"];\n  },\n  scrollTo: function (pos) {\n    var $element = this.element();\n    var $scrollContainer = $element && $element.children(\".\" + this.addWidgetPrefix(SCROLL_CONTAINER_CLASS)).not(\".\" + this.addWidgetPrefix(CONTENT_FIXED_CLASS));\n\n    if (_type2.default.isDefined(pos) && _type2.default.isDefined(pos.left) && this._scrollLeft !== pos.left) {\n      this._scrollLeft = pos.left;\n      $scrollContainer && $scrollContainer.scrollLeft(pos.left);\n    }\n  },\n  _wrapTableInScrollContainer: function ($table) {\n    var _this2 = this;\n\n    var $scrollContainer = (0, _renderer2.default)(\"<div>\");\n\n    _events_engine2.default.on($scrollContainer, \"scroll\", function () {\n      var scrollLeft = $scrollContainer.scrollLeft();\n\n      if (scrollLeft !== _this2._scrollLeft) {\n        _this2.scrollChanged.fire({\n          left: scrollLeft\n        }, _this2.name);\n      }\n    });\n\n    $scrollContainer.addClass(this.addWidgetPrefix(CONTENT_CLASS)).addClass(this.addWidgetPrefix(SCROLL_CONTAINER_CLASS)).append($table).appendTo(this.element());\n    this.setAria(\"role\", \"presentation\", $scrollContainer);\n    return $scrollContainer;\n  },\n  _updateContent: function ($newTableElement) {\n    this._setTableElement($newTableElement);\n\n    this._wrapTableInScrollContainer($newTableElement);\n  },\n  _findContentElement: _common.noop,\n  _getWidths: function ($cellElements) {\n    var result = [];\n    var legacyRendering = this.option(\"legacyRendering\");\n    var width;\n\n    if ($cellElements) {\n      _iterator2.default.each($cellElements, function (index, item) {\n        width = item.offsetWidth;\n\n        if (item.getBoundingClientRect) {\n          var clientRect = (0, _position.getBoundingRect)(item);\n\n          if (clientRect.width > width - 1) {\n            width = legacyRendering ? Math.ceil(clientRect.width) : clientRect.width;\n          }\n        }\n\n        result.push(width);\n      });\n    }\n\n    return result;\n  },\n  getColumnWidths: function ($tableElement) {\n    var that = this;\n    var result = [];\n    var $rows;\n    var $cells;\n\n    (this.option(\"forceApplyBindings\") || _common.noop)();\n\n    $tableElement = $tableElement || that._getTableElement();\n\n    if ($tableElement) {\n      $rows = $tableElement.children(\"tbody\").children();\n\n      for (var i = 0; i < $rows.length; i++) {\n        var $row = $rows.eq(i);\n        var isRowVisible = \"none\" !== $row.get(0).style.display && !$row.hasClass(\"dx-state-invisible\");\n\n        if (!$row.is(\".\" + GROUP_ROW_CLASS) && !$row.is(\".\" + DETAIL_ROW_CLASS) && isRowVisible) {\n          $cells = $row.children(\"td\");\n          break;\n        }\n      }\n\n      result = that._getWidths($cells);\n    }\n\n    return result;\n  },\n  getVisibleColumnIndex: function (columnIndex, rowIndex) {\n    return columnIndex;\n  },\n  setColumnWidths: function (_ref) {\n    var widths = _ref.widths,\n        $tableElement = _ref.$tableElement,\n        columns = _ref.columns,\n        fixed = _ref.fixed;\n    var $cols;\n    var width;\n    var minWidth;\n    var columnIndex;\n    var columnAutoWidth = this.option(\"columnAutoWidth\");\n    var legacyRendering = this.option(\"legacyRendering\");\n    $tableElement = $tableElement || this._getTableElement();\n\n    if ($tableElement && $tableElement.length && widths) {\n      columnIndex = 0;\n      $cols = $tableElement.children(\"colgroup\").children(\"col\");\n\n      _style2.default.setWidth($cols, \"auto\");\n\n      columns = columns || this.getColumns(null, $tableElement);\n\n      for (var i = 0; i < columns.length; i++) {\n        if (!legacyRendering && columnAutoWidth && !fixed) {\n          width = columns[i].width;\n\n          if (width && !columns[i].command) {\n            width = columns[i].visibleWidth || width;\n            width = getWidthStyle(width);\n            minWidth = getWidthStyle(columns[i].minWidth || width);\n            var $rows = $rows || $tableElement.children().children(\".dx-row\").not(\".\" + GROUP_ROW_CLASS).not(\".\" + DETAIL_ROW_CLASS);\n\n            for (var rowIndex = 0; rowIndex < $rows.length; rowIndex++) {\n              var visibleIndex = this.getVisibleColumnIndex(i, rowIndex);\n              var cell = $rows[rowIndex].cells[visibleIndex];\n\n              if (cell) {\n                setCellWidth(cell, columns[i], width);\n                cell.style.minWidth = minWidth;\n              }\n            }\n          }\n        }\n\n        if (columns[i].colspan) {\n          columnIndex += columns[i].colspan;\n          continue;\n        }\n\n        width = widths[columnIndex];\n\n        if (\"adaptiveHidden\" === width) {\n          width = HIDDEN_COLUMNS_WIDTH;\n        }\n\n        if (\"number\" === typeof width) {\n          width = width.toFixed(3) + \"px\";\n        }\n\n        _style2.default.setWidth($cols.eq(columnIndex), _type2.default.isDefined(width) ? width : \"auto\");\n\n        columnIndex++;\n      }\n    }\n  },\n  getCellElements: function (rowIndex) {\n    return this._getCellElementsCore(rowIndex);\n  },\n  _getCellElementsCore: function (rowIndex) {\n    var $row = this._getRowElements().eq(rowIndex);\n\n    return $row.children();\n  },\n  _getCellElement: function (rowIndex, columnIdentifier) {\n    var that = this;\n    var $cell;\n    var $cells = that.getCellElements(rowIndex);\n\n    var columnVisibleIndex = that._getVisibleColumnIndex($cells, rowIndex, columnIdentifier);\n\n    if ($cells.length && columnVisibleIndex >= 0) {\n      $cell = $cells.eq(columnVisibleIndex);\n    }\n\n    if ($cell && $cell.length) {\n      return $cell;\n    }\n  },\n  _getRowElement: function (rowIndex) {\n    var that = this;\n    var $rowElement = (0, _renderer2.default)();\n    var $tableElements = that.getTableElements();\n\n    _iterator2.default.each($tableElements, function (_, tableElement) {\n      $rowElement = $rowElement.add(that._getRowElements((0, _renderer2.default)(tableElement)).eq(rowIndex));\n    });\n\n    if ($rowElement.length) {\n      return $rowElement;\n    }\n  },\n  getCellElement: function (rowIndex, columnIdentifier) {\n    return (0, _dom.getPublicElement)(this._getCellElement(rowIndex, columnIdentifier));\n  },\n  getRowElement: function (rowIndex) {\n    var $rows = this._getRowElement(rowIndex);\n\n    var elements = [];\n\n    if ($rows && !(0, _dom.getPublicElement)($rows).get) {\n      for (var i = 0; i < $rows.length; i++) {\n        elements.push($rows[i]);\n      }\n    } else {\n      elements = $rows;\n    }\n\n    return elements;\n  },\n  _getVisibleColumnIndex: function ($cells, rowIndex, columnIdentifier) {\n    if (_type2.default.isString(columnIdentifier)) {\n      var columnIndex = this._columnsController.columnOption(columnIdentifier, \"index\");\n\n      return this._columnsController.getVisibleIndex(columnIndex);\n    }\n\n    return columnIdentifier;\n  },\n  getColumnElements: function () {},\n  getColumns: function (rowIndex) {\n    return this._columnsController.getVisibleColumns(rowIndex);\n  },\n  getCell: function (cellPosition, rows) {\n    var $rows = rows || this._getRowElements();\n\n    var $cells;\n\n    if ($rows.length > 0 && cellPosition.rowIndex >= 0) {\n      if (\"virtual\" !== this.option(\"scrolling.mode\")) {\n        cellPosition.rowIndex = cellPosition.rowIndex < $rows.length ? cellPosition.rowIndex : $rows.length - 1;\n      }\n\n      $cells = this.getCellElements(cellPosition.rowIndex);\n\n      if ($cells && $cells.length > 0) {\n        return $cells.eq($cells.length > cellPosition.columnIndex ? cellPosition.columnIndex : $cells.length - 1);\n      }\n    }\n  },\n  getRowsCount: function () {\n    var tableElement = this._getTableElement();\n\n    if (tableElement && 1 === tableElement.length) {\n      return tableElement[0].rows.length;\n    }\n\n    return 0;\n  },\n  _getRowElementsCore: function (tableElement) {\n    tableElement = tableElement || this._getTableElement();\n\n    if (tableElement) {\n      var tBodies = this.option(\"rowTemplate\") && tableElement.find(\"> tbody.\" + ROW_CLASS);\n      return tBodies && tBodies.length ? tBodies : tableElement.find(\"> tbody > .\" + ROW_CLASS + \", > .\" + ROW_CLASS);\n    }\n\n    return (0, _renderer2.default)();\n  },\n  _getRowElements: function (tableElement) {\n    return this._getRowElementsCore(tableElement);\n  },\n  getRowIndex: function ($row) {\n    return this._getRowElements().index($row);\n  },\n  getBoundingRect: function () {},\n  getName: function () {},\n  setScrollerSpacing: function (width) {\n    var that = this;\n    var $element = that.element();\n    var rtlEnabled = that.option(\"rtlEnabled\");\n    $element && $element.css({\n      paddingLeft: rtlEnabled ? width : \"\",\n      paddingRight: !rtlEnabled ? width : \"\"\n    });\n  },\n  isScrollbarVisible: function (isHorizontal) {\n    var $element = this.element();\n    var $tableElement = this._tableElement;\n\n    if ($element && $tableElement) {\n      return isHorizontal ? $tableElement.outerWidth() - $element.width() > 0 : $tableElement.outerHeight() - $element.height() > 0;\n    }\n\n    return false;\n  }\n});","map":null,"metadata":{},"sourceType":"script"}