{"ast":null,"code":"/**\r\n * DevExtreme (ui/shared/filtering.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar typeUtils = require(\"../../core/utils/type\");\n\nvar inArray = require(\"../../core/utils/array\").inArray;\n\nvar iteratorUtils = require(\"../../core/utils/iterator\");\n\nvar DEFAULT_DATE_INTERVAL = [\"year\", \"month\", \"day\"];\nvar DEFAULT_DATETIME_INTERVAL = [\"year\", \"month\", \"day\", \"hour\", \"minute\"];\n\nmodule.exports = function () {\n  var getFilterSelector = function (column, target) {\n    var selector = column.dataField || column.selector;\n\n    if (\"search\" === target) {\n      selector = column.displayField || column.calculateDisplayValue || selector;\n    }\n\n    return selector;\n  };\n\n  var isZeroTime = function (date) {\n    return date.getHours() + date.getMinutes() + date.getSeconds() + date.getMilliseconds() < 1;\n  };\n\n  var isDateType = function (dataType) {\n    return \"date\" === dataType || \"datetime\" === dataType;\n  };\n\n  var getDateValues = function (dateValue) {\n    if (typeUtils.isDate(dateValue)) {\n      return [dateValue.getFullYear(), dateValue.getMonth(), dateValue.getDate(), dateValue.getHours(), dateValue.getMinutes(), dateValue.getSeconds()];\n    }\n\n    return iteratorUtils.map((\"\" + dateValue).split(\"/\"), function (value, index) {\n      return 1 === index ? Number(value) - 1 : Number(value);\n    });\n  };\n\n  var getFilterExpressionByRange = function (filterValue, target) {\n    var column = this;\n    var endFilterValue;\n    var startFilterExpression;\n    var endFilterExpression;\n    var selector = getFilterSelector(column, target);\n\n    if (Array.isArray(filterValue) && typeUtils.isDefined(filterValue[0]) && typeUtils.isDefined(filterValue[1])) {\n      startFilterExpression = [selector, \">=\", filterValue[0]];\n      endFilterExpression = [selector, \"<=\", filterValue[1]];\n\n      if (isDateType(column.dataType) && isZeroTime(filterValue[1])) {\n        endFilterValue = new Date(filterValue[1].getTime());\n\n        if (\"date\" === column.dataType) {\n          endFilterValue.setDate(filterValue[1].getDate() + 1);\n        }\n\n        endFilterExpression = [selector, \"<\", endFilterValue];\n      }\n\n      return [startFilterExpression, \"and\", endFilterExpression];\n    }\n  };\n\n  var getFilterExpressionForDate = function (filterValue, selectedFilterOperation, target) {\n    var column = this;\n    var dateStart;\n    var dateEnd;\n    var dateInterval;\n    var values = getDateValues(filterValue);\n    var selector = getFilterSelector(column, target);\n\n    if (\"headerFilter\" === target) {\n      dateInterval = module.exports.getGroupInterval(column)[values.length - 1];\n    } else {\n      if (\"datetime\" === column.dataType) {\n        dateInterval = \"minute\";\n      }\n    }\n\n    switch (dateInterval) {\n      case \"year\":\n        dateStart = new Date(values[0], 0, 1);\n        dateEnd = new Date(values[0] + 1, 0, 1);\n        break;\n\n      case \"month\":\n        dateStart = new Date(values[0], values[1], 1);\n        dateEnd = new Date(values[0], values[1] + 1, 1);\n        break;\n\n      case \"quarter\":\n        dateStart = new Date(values[0], 3 * values[1], 1);\n        dateEnd = new Date(values[0], 3 * values[1] + 3, 1);\n        break;\n\n      case \"hour\":\n        dateStart = new Date(values[0], values[1], values[2], values[3]);\n        dateEnd = new Date(values[0], values[1], values[2], values[3] + 1);\n        break;\n\n      case \"minute\":\n        dateStart = new Date(values[0], values[1], values[2], values[3], values[4]);\n        dateEnd = new Date(values[0], values[1], values[2], values[3], values[4] + 1);\n        break;\n\n      case \"second\":\n        dateStart = new Date(values[0], values[1], values[2], values[3], values[4], values[5]);\n        dateEnd = new Date(values[0], values[1], values[2], values[3], values[4], values[5] + 1);\n        break;\n\n      default:\n        dateStart = new Date(values[0], values[1], values[2]);\n        dateEnd = new Date(values[0], values[1], values[2] + 1);\n    }\n\n    switch (selectedFilterOperation) {\n      case \"<\":\n        return [selector, \"<\", dateStart];\n\n      case \"<=\":\n        return [selector, \"<\", dateEnd];\n\n      case \">\":\n        return [selector, \">=\", dateEnd];\n\n      case \">=\":\n        return [selector, \">=\", dateStart];\n\n      case \"<>\":\n        return [[selector, \"<\", dateStart], \"or\", [selector, \">=\", dateEnd]];\n\n      default:\n        return [[selector, \">=\", dateStart], \"and\", [selector, \"<\", dateEnd]];\n    }\n  };\n\n  var getFilterExpressionForNumber = function (filterValue, selectedFilterOperation, target) {\n    var column = this;\n    var selector = getFilterSelector(column, target);\n    var groupInterval = module.exports.getGroupInterval(column);\n\n    if (\"headerFilter\" === target && groupInterval && typeUtils.isDefined(filterValue)) {\n      var values = (\"\" + filterValue).split(\"/\");\n      var value = Number(values[values.length - 1]);\n      var interval = groupInterval[values.length - 1];\n      var startFilterValue = [selector, \">=\", value];\n      var endFilterValue = [selector, \"<\", value + interval];\n      var condition = [startFilterValue, \"and\", endFilterValue];\n      return condition;\n    }\n\n    return [selector, selectedFilterOperation || \"=\", filterValue];\n  };\n\n  return {\n    defaultCalculateFilterExpression: function (filterValue, selectedFilterOperation, target) {\n      var column = this;\n      var selector = getFilterSelector(column, target);\n      var isSearchByDisplayValue = column.calculateDisplayValue && \"search\" === target;\n      var dataType = isSearchByDisplayValue && column.lookup && column.lookup.dataType || column.dataType;\n      var filter = null;\n\n      if ((\"headerFilter\" === target || \"filterBuilder\" === target) && null === filterValue) {\n        filter = [selector, selectedFilterOperation || \"=\", null];\n\n        if (\"string\" === dataType) {\n          filter = [filter, \"=\" === selectedFilterOperation ? \"or\" : \"and\", [selector, selectedFilterOperation || \"=\", \"\"]];\n        }\n      } else {\n        if (\"string\" === dataType && (!column.lookup || isSearchByDisplayValue)) {\n          filter = [selector, selectedFilterOperation || \"contains\", filterValue];\n        } else {\n          if (\"between\" === selectedFilterOperation) {\n            return getFilterExpressionByRange.apply(column, [filterValue, target]);\n          } else {\n            if (isDateType(dataType) && typeUtils.isDefined(filterValue)) {\n              return getFilterExpressionForDate.apply(column, arguments);\n            } else {\n              if (\"number\" === dataType) {\n                return getFilterExpressionForNumber.apply(column, arguments);\n              } else {\n                if (\"object\" !== dataType) {\n                  filter = [selector, selectedFilterOperation || \"=\", filterValue];\n                }\n              }\n            }\n          }\n        }\n      }\n\n      return filter;\n    },\n    getGroupInterval: function (column) {\n      var index;\n      var result = [];\n      var dateIntervals = [\"year\", \"month\", \"day\", \"hour\", \"minute\", \"second\"];\n      var groupInterval = column.headerFilter && column.headerFilter.groupInterval;\n      var interval = \"quarter\" === groupInterval ? \"month\" : groupInterval;\n\n      if (isDateType(column.dataType) && null !== groupInterval) {\n        result = \"datetime\" === column.dataType ? DEFAULT_DATETIME_INTERVAL : DEFAULT_DATE_INTERVAL;\n        index = inArray(interval, dateIntervals);\n\n        if (index >= 0) {\n          result = dateIntervals.slice(0, index);\n          result.push(groupInterval);\n          return result;\n        }\n\n        return result;\n      } else {\n        if (typeUtils.isDefined(groupInterval)) {\n          return Array.isArray(groupInterval) ? groupInterval : [groupInterval];\n        }\n      }\n    }\n  };\n}();","map":null,"metadata":{},"sourceType":"script"}