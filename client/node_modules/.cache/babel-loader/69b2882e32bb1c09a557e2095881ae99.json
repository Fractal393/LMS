{"ast":null,"code":"/**\r\n * DevExtreme (core/utils/array_compare.js)\r\n * Version: 20.1.6\r\n * Build date: Fri Jul 17 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.findChanges = void 0;\n\nvar _type = require(\"./type\");\n\nvar getKeyWrapper = function (item, getKey) {\n  var key = getKey(item);\n\n  if ((0, _type.isObject)(key)) {\n    try {\n      return JSON.stringify(key);\n    } catch (e) {\n      return key;\n    }\n  }\n\n  return key;\n};\n\nvar getSameNewByOld = function (oldItem, newItems, newIndexByKey, getKey) {\n  var key = getKeyWrapper(oldItem, getKey);\n  return newItems[newIndexByKey[key]];\n};\n\nvar findChanges = exports.findChanges = function (oldItems, newItems, getKey, isItemEquals) {\n  var oldIndexByKey = {};\n  var newIndexByKey = {};\n  var addedCount = 0;\n  var removeCount = 0;\n  var result = [];\n  oldItems.forEach(function (item, index) {\n    var key = getKeyWrapper(item, getKey);\n    oldIndexByKey[key] = index;\n  });\n  newItems.forEach(function (item, index) {\n    var key = getKeyWrapper(item, getKey);\n    newIndexByKey[key] = index;\n  });\n  var itemCount = Math.max(oldItems.length, newItems.length);\n\n  for (var index = 0; index < itemCount + addedCount; index++) {\n    var newItem = newItems[index];\n    var oldNextIndex = index - addedCount + removeCount;\n    var nextOldItem = oldItems[oldNextIndex];\n    var isRemoved = !newItem || nextOldItem && !getSameNewByOld(nextOldItem, newItems, newIndexByKey, getKey);\n\n    if (isRemoved) {\n      if (nextOldItem) {\n        result.push({\n          type: \"remove\",\n          key: getKey(nextOldItem),\n          index: index,\n          oldItem: nextOldItem\n        });\n        removeCount++;\n        index--;\n      }\n    } else {\n      var key = getKeyWrapper(newItem, getKey);\n      var oldIndex = oldIndexByKey[key];\n      var oldItem = oldItems[oldIndex];\n\n      if (!oldItem) {\n        addedCount++;\n        result.push({\n          type: \"insert\",\n          data: newItem,\n          index: index\n        });\n      } else {\n        if (oldIndex === oldNextIndex) {\n          if (!isItemEquals(oldItem, newItem)) {\n            result.push({\n              type: \"update\",\n              data: newItem,\n              key: getKey(newItem),\n              index: index,\n              oldItem: oldItem\n            });\n          }\n        } else {\n          return;\n        }\n      }\n    }\n  }\n\n  return result;\n};","map":null,"metadata":{},"sourceType":"script"}